<!DOCTYPE HTML>
<html lang="zh_TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0369-num-reform - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-c5bb60c5.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Start Date: 2014-09-16</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/369">rust-lang/rfcs#369</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/18640">rust-lang/rust#18640</a></li>
</ul>
<h2 id="摘要"><a class="header" href="#摘要">摘要</a></h2>
<p>This RFC is preparation for API stabilization for the <code>std::num</code> module.  The proposal is to finish the simplification efforts started in <a href="https://github.com/rust-lang/rust/issues/10387">@bjz’s reversal of the numerics hierarchy</a>.</p>
<p>Broadly, the proposal is to collapse the remaining numeric hierarchy in <code>std::num</code>, and to provide only limited support for generic programming (roughly, only over primitive numeric types that vary based on size).  Traits giving detailed numeric hierarchy can and should be provided separately through the Cargo ecosystem.</p>
<p>Thus, this RFC proposes to flatten or remove most of the traits currently provided by <code>std::num</code>, and generally to simplify the module as much as possible in preparation for API stabilization.</p>
<h2 id="動機"><a class="header" href="#動機">動機</a></h2>
<h3 id="history"><a class="header" href="#history">History</a></h3>
<p>Starting in early 2013, there was <a href="https://github.com/rust-lang/rust/issues/4819">an effort</a> to design a comprehensive “numeric hierarchy” for Rust: a collection of traits classifying a wide variety of numbers and other algebraic objects. The intent was to allow highly-generic code to be written for algebraic structures and then instantiated to particular types.</p>
<p>This hierarchy covered structures like bigints, but also primitive integer and float types. It was an enormous and long-running community effort.</p>
<p>Later, <a href="https://github.com/rust-lang/rust/issues/10387">it was recognized</a> that building such a hierarchy within <code>libstd</code> was misguided:</p>
<blockquote>
<p>@bjz The API that resulted from #4819 attempted, like Haskell, to blend both the primitive numerics and higher level mathematical concepts into one API. This resulted in an ugly hybrid where neither goal was adequately met. I think the libstd should have a strong focus on implementing fundamental operations for the base numeric types, but no more. Leave the higher level concepts to libnum or future community projects.</p>
</blockquote>
<p>The <code>std::num</code> module has thus been slowly migrating <em>away</em> from a large trait hierarchy toward a simpler one providing just APIs for primitive data types: this is <a href="https://github.com/rust-lang/rust/issues/10387">@bjz’s reversal of the numerics hierarchy</a>.</p>
<p>Along side this effort, there are already external numerics packages like <a href="https://github.com/bjz/num-rs">@bjz’s num-rs</a>.</p>
<p>But we’re not finished yet.</p>
<h3 id="the-current-state-of-affairs"><a class="header" href="#the-current-state-of-affairs">The current state of affairs</a></h3>
<p>The <code>std::num</code> module still contains quite a few traits that subdivide out various features of numbers:</p>
<pre><code class="language-rust">pub trait Zero: Add&lt;Self, Self&gt; {
    fn zero() -&gt; Self;
    fn is_zero(&amp;self) -&gt; bool;
}

pub trait One: Mul&lt;Self, Self&gt; {
    fn one() -&gt; Self;
}

pub trait Signed: Num + Neg&lt;Self&gt; {
    fn abs(&amp;self) -&gt; Self;
    fn abs_sub(&amp;self, other: &amp;Self) -&gt; Self;
    fn signum(&amp;self) -&gt; Self;
    fn is_positive(&amp;self) -&gt; bool;
    fn is_negative(&amp;self) -&gt; bool;
}

pub trait Unsigned: Num {}

pub trait Bounded {
    fn min_value() -&gt; Self;
    fn max_value() -&gt; Self;
}

pub trait Primitive: Copy + Clone + Num + NumCast + PartialOrd + Bounded {}

pub trait Num: PartialEq + Zero + One + Neg&lt;Self&gt; + Add&lt;Self,Self&gt; + Sub&lt;Self,Self&gt;
             + Mul&lt;Self,Self&gt; + Div&lt;Self,Self&gt; + Rem&lt;Self,Self&gt; {}

pub trait Int: Primitive + CheckedAdd + CheckedSub + CheckedMul + CheckedDiv
             + Bounded + Not&lt;Self&gt; + BitAnd&lt;Self,Self&gt; + BitOr&lt;Self,Self&gt;
             + BitXor&lt;Self,Self&gt; + Shl&lt;uint,Self&gt; + Shr&lt;uint,Self&gt; {
    fn count_ones(self) -&gt; uint;
    fn count_zeros(self) -&gt; uint { ... }
    fn leading_zeros(self) -&gt; uint;
    fn trailing_zeros(self) -&gt; uint;
    fn rotate_left(self, n: uint) -&gt; Self;
    fn rotate_right(self, n: uint) -&gt; Self;
    fn swap_bytes(self) -&gt; Self;
    fn from_be(x: Self) -&gt; Self { ... }
    fn from_le(x: Self) -&gt; Self { ... }
    fn to_be(self) -&gt; Self { ... }
    fn to_le(self) -&gt; Self { ... }
}

pub trait FromPrimitive {
    fn from_i64(n: i64) -&gt; Option&lt;Self&gt;;
    fn from_u64(n: u64) -&gt; Option&lt;Self&gt;;

    // many additional defaulted methods
    // ...
}

pub trait ToPrimitive {
    fn to_i64(&amp;self) -&gt; Option&lt;i64&gt;;
    fn to_u64(&amp;self) -&gt; Option&lt;u64&gt;;

    // many additional defaulted methods
    // ...
}

pub trait NumCast: ToPrimitive {
    fn from&lt;T: ToPrimitive&gt;(n: T) -&gt; Option&lt;Self&gt;;
}

pub trait Saturating {
    fn saturating_add(self, v: Self) -&gt; Self;
    fn saturating_sub(self, v: Self) -&gt; Self;
}

pub trait CheckedAdd: Add&lt;Self, Self&gt; {
    fn checked_add(&amp;self, v: &amp;Self) -&gt; Option&lt;Self&gt;;
}

pub trait CheckedSub: Sub&lt;Self, Self&gt; {
    fn checked_sub(&amp;self, v: &amp;Self) -&gt; Option&lt;Self&gt;;
}

pub trait CheckedMul: Mul&lt;Self, Self&gt; {
    fn checked_mul(&amp;self, v: &amp;Self) -&gt; Option&lt;Self&gt;;
}

pub trait CheckedDiv: Div&lt;Self, Self&gt; {
    fn checked_div(&amp;self, v: &amp;Self) -&gt; Option&lt;Self&gt;;
}

pub trait Float: Signed + Primitive {
    // a huge collection of static functions (for constants) and methods
    ...
}

pub trait FloatMath: Float {
    // an additional collection of methods
}</code></pre>
<p>The <code>Primitive</code> traits are intended primarily to support a mechanism, <code>#[deriving(FromPrimitive)]</code>, that makes it easy to provide conversions from numeric types to C-like <code>enum</code>s.</p>
<p>The <code>Saturating</code> and <code>Checked</code> traits provide operations that provide special handling for overflow and other numeric errors.</p>
<p>Almost all of these traits are currently included in the prelude.</p>
<p>In addition to these traits, the <code>std::num</code> module includes a couple dozen free functions, most of which duplicate methods available though traits.</p>
<h3 id="where-we-want-to-go-a-summary"><a class="header" href="#where-we-want-to-go-a-summary">Where we want to go: a summary</a></h3>
<p>The goal of this RFC is to refactor the <code>std::num</code> hierarchy with the following goals in mind:</p>
<ul>
<li>
<p>Simplicity.</p>
</li>
<li>
<p><em>Limited</em> generic programming: being able to work generically over the natural classes of <em>primitive</em> numeric types that vary only by size.  There should be enough abstraction to support porting <code>strconv</code>, the generic string/number conversion code used in <code>std</code>.</p>
</li>
<li>
<p>Minimizing dependencies for <code>libcore</code>. For example, it should not require <code>cmath</code>.</p>
</li>
<li>
<p>Future-proofing for external numerics packages. The Cargo ecosystem should ultimately provide choices of sophisticated numeric hierarchies, and <code>std::num</code> should not get in the way.</p>
</li>
</ul>
<h2 id="詳細設計"><a class="header" href="#詳細設計">詳細設計</a></h2>
<h3 id="overview-the-new-hierarchy"><a class="header" href="#overview-the-new-hierarchy">Overview: the new hierarchy</a></h3>
<p>This RFC proposes to collapse the trait hierarchy in <code>std::num</code> to just the following traits:</p>
<ul>
<li><code>Int</code>, implemented by all primitive integer types (<code>u8</code> - <code>u64</code>, <code>i8</code>-<code>i64</code>)
<ul>
<li><code>UnsignedInt</code>, implemented by <code>u8</code> - <code>u64</code></li>
</ul>
</li>
<li><code>Signed</code>, implemented by all signed primitive numeric types (<code>i8</code>-<code>i64</code>, <code>f32</code>-<code>f64</code>)</li>
<li><code>Float</code>, implemented by <code>f32</code> and <code>f64</code>
<ul>
<li><code>FloatMath</code>, implemented by <code>f32</code> and <code>f64</code>, which provides functionality from <code>cmath</code></li>
</ul>
</li>
</ul>
<p>These traits inherit from all applicable overloaded operator traits (from <code>core::ops</code>).  They suffice for generic programming over several basic categories of primitive numeric types.</p>
<p>As designed, these traits include a certain amount of redundancy between <code>Int</code> and <code>Float</code>. The Alternatives section shows how this could be factored out into a separate <code>Num</code> trait. But doing so suggests a level of generic programming that these traits aren’t intended to support.</p>
<p>The main reason to pull out <code>Signed</code> into its own trait is so that it can be added to the prelude. (Further discussion below.)</p>
<h3 id="detailed-definitions"><a class="header" href="#detailed-definitions">Detailed definitions</a></h3>
<p>Below is the full definition of these traits. The functionality remains largely as it is today, just organized into fewer traits:</p>
<pre><code class="language-rust">pub trait Int: Copy + Clone + PartialOrd + PartialEq
             + Add&lt;Self,Self&gt; + Sub&lt;Self,Self&gt;
             + Mul&lt;Self,Self&gt; + Div&lt;Self,Self&gt; + Rem&lt;Self,Self&gt;
             + Not&lt;Self&gt; + BitAnd&lt;Self,Self&gt; + BitOr&lt;Self,Self&gt;
             + BitXor&lt;Self,Self&gt; + Shl&lt;uint,Self&gt; + Shr&lt;uint,Self&gt;
{
    // Constants
    fn zero() -&gt; Self;  // These should be associated constants when those are available
    fn one() -&gt; Self;
    fn min_value() -&gt; Self;
    fn max_value() -&gt; Self;

    // Deprecated:
    // fn is_zero(&amp;self) -&gt; bool;

    // Bit twiddling
    fn count_ones(self) -&gt; uint;
    fn count_zeros(self) -&gt; uint { ... }
    fn leading_zeros(self) -&gt; uint;
    fn trailing_zeros(self) -&gt; uint;
    fn rotate_left(self, n: uint) -&gt; Self;
    fn rotate_right(self, n: uint) -&gt; Self;
    fn swap_bytes(self) -&gt; Self;
    fn from_be(x: Self) -&gt; Self { ... }
    fn from_le(x: Self) -&gt; Self { ... }
    fn to_be(self) -&gt; Self { ... }
    fn to_le(self) -&gt; Self { ... }

    // Checked arithmetic
    fn checked_add(self, v: Self) -&gt; Option&lt;Self&gt;;
    fn checked_sub(self, v: Self) -&gt; Option&lt;Self&gt;;
    fn checked_mul(self, v: Self) -&gt; Option&lt;Self&gt;;
    fn checked_div(self, v: Self) -&gt; Option&lt;Self&gt;;
    fn saturating_add(self, v: Self) -&gt; Self;
    fn saturating_sub(self, v: Self) -&gt; Self;
}

pub trait UnsignedInt: Int {
    fn is_power_of_two(self) -&gt; bool;
    fn checked_next_power_of_two(self) -&gt; Option&lt;Self&gt;;
    fn next_power_of_two(self) -&gt; Self;
}

pub trait Signed: Neg&lt;Self&gt; {
    fn abs(&amp;self) -&gt; Self;
    fn signum(&amp;self) -&gt; Self;
    fn is_positive(&amp;self) -&gt; bool;
    fn is_negative(&amp;self) -&gt; bool;

    // Deprecated:
    // fn abs_sub(&amp;self, other: &amp;Self) -&gt; Self;
}

pub trait Float: Copy + Clone + PartialOrd + PartialEq + Signed
               + Add&lt;Self,Self&gt; + Sub&lt;Self,Self&gt;
               + Mul&lt;Self,Self&gt; + Div&lt;Self,Self&gt; + Rem&lt;Self,Self&gt;
{
    // Constants
    fn zero() -&gt; Self;  // These should be associated constants when those are available
    fn one() -&gt; Self;
    fn min_value() -&gt; Self;
    fn max_value() -&gt; Self;

    // Classification and decomposition
    fn is_nan(self) -&gt; bool;
    fn is_infinite(self) -&gt; bool;
    fn is_finite(self) -&gt; bool;
    fn is_normal(self) -&gt; bool;
    fn classify(self) -&gt; FPCategory;
    fn integer_decode(self) -&gt; (u64, i16, i8);

    // Float intrinsics
    fn floor(self) -&gt; Self;
    fn ceil(self) -&gt; Self;
    fn round(self) -&gt; Self;
    fn trunc(self) -&gt; Self;
    fn mul_add(self, a: Self, b: Self) -&gt; Self;
    fn sqrt(self) -&gt; Self;
    fn powi(self, n: i32) -&gt; Self;
    fn powf(self, n: Self) -&gt; Self;
    fn exp(self) -&gt; Self;
    fn exp2(self) -&gt; Self;
    fn ln(self) -&gt; Self;
    fn log2(self) -&gt; Self;
    fn log10(self) -&gt; Self;

    // Conveniences
    fn fract(self) -&gt; Self;
    fn recip(self) -&gt; Self;
    fn rsqrt(self) -&gt; Self;
    fn to_degrees(self) -&gt; Self;
    fn to_radians(self) -&gt; Self;
    fn log(self, base: Self) -&gt; Self;
}

// This lives directly in `std::num`, not `core::num`, since it requires `cmath`
pub trait FloatMath: Float {
    // Exactly the methods defined in today's version
}</code></pre>
<h3 id="float-constants-float-math-and-cmath"><a class="header" href="#float-constants-float-math-and-cmath">Float constants, float math, and <code>cmath</code></a></h3>
<p>This RFC proposes to:</p>
<ul>
<li>
<p>Remove all float constants from the <code>Float</code> trait. These constants are available directly from the <code>f32</code> and <code>f64</code> modules, and are not really useful for the kind of generic programming these new traits are intended to allow.</p>
</li>
<li>
<p>Continue providing various <code>cmath</code> functions as methods in the <code>FloatMath</code> trait. Putting this in a separate trait means that <code>libstd</code> depends on <code>cmath</code> but <code>libcore</code> does not.</p>
</li>
</ul>
<h3 id="free-functions"><a class="header" href="#free-functions">Free functions</a></h3>
<p>All of the free functions defined in <code>std::num</code> are deprecated.</p>
<h3 id="the-prelude"><a class="header" href="#the-prelude">The prelude</a></h3>
<p>The prelude will only include the <code>Signed</code> trait, as the operations it provides are widely expected to be available when they apply.</p>
<p>The reason for removing the rest of the traits is two-fold:</p>
<ul>
<li>
<p>The remaining operations are relatively uncommon. Note that various overloaded operators, like <code>+</code>, work regardless of this choice. Those doing intensive work with e.g. floats would only need to import <code>Float</code> and <code>FloatMath</code>.</p>
</li>
<li>
<p>Keeping this functionality out of the prelude means that the names of methods and associated items remain available for external numerics libraries in the Cargo ecosystem.</p>
</li>
</ul>
<h3 id="strconv-fromstr-tostr-fromstrradix-tostrradix"><a class="header" href="#strconv-fromstr-tostr-fromstrradix-tostrradix"><code>strconv</code>, <code>FromStr</code>, <code>ToStr</code>, <code>FromStrRadix</code>, <code>ToStrRadix</code></a></h3>
<p>Currently, traits for converting from <code>&amp;str</code> and to <code>String</code> are both included, in their own modules, in <code>libstd</code>. This is largely due to the desire to provide <code>impl</code>s for numeric types, which in turn relies on <code>std::num::strconv</code>.</p>
<p>This RFC proposes to:</p>
<ul>
<li>Move the <code>FromStr</code> trait into <code>core::str</code>.</li>
<li>Rename the <code>ToStr</code> trait to <code>ToString</code>, and move it to <code>collections::string</code>.</li>
<li>Break up and revise <code>std::num::strconv</code> into separate, <em>private</em> modules that provide the needed functionality for the <code>from_str</code> and <code>to_string</code> methods. (Some of this functionality has already migrated to <code>fmt</code> and been deprecated in <code>strconv</code>.)</li>
<li>Move the <code>FromStrRadix</code> into <code>core::num</code>.</li>
<li>Remove <code>ToStrRadix</code>, which is already deprecated in favor of <code>fmt</code>.</li>
</ul>
<h3 id="fromprimitive-and-friends"><a class="header" href="#fromprimitive-and-friends"><code>FromPrimitive</code> and friends</a></h3>
<p>Ideally, the <code>FromPrimitive</code>, <code>ToPrimitive</code>, <code>Primitive</code>, <code>NumCast</code> traits would all be removed in favor of a more principled way of working with C-like enums. However, such a replacement is outside of the scope of this RFC, so these traits are left (as <code>#[experimental]</code>) for now. A follow-up RFC proposing a better solution should appear soon.</p>
<p>In the meantime, see <a href="https://github.com/rust-lang/rust/issues/10418">this proposal</a> and the discussion on <a href="https://github.com/rust-lang/rust/issues/10272">this issue</a> about <code>Ordinal</code> for the rough direction forward.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<p>This RFC somewhat reduces the potential for writing generic numeric code with <code>std::num</code> traits. This is intentional, however: the new design represents “just enough” generics to cover differently-sized built-in types, without any attempt at general algebraic abstraction.</p>
<h2 id="替代方案"><a class="header" href="#替代方案">替代方案</a></h2>
<p>The status quo is clearly not ideal, and as explained above there was a long attempt at providing a more complete numeric hierarchy in <code>std</code>. So <em>some</em> collapse of the hierarchy seems desirable.</p>
<p>That said, there are other possible factorings. We could introduce the following <code>Num</code> trait to factor out commonalities between <code>Int</code> and <code>Float</code>:</p>
<pre><code class="language-rust">pub trait Num: Copy + Clone + PartialOrd + PartialEq
             + Add&lt;Self,Self&gt; + Sub&lt;Self,Self&gt;
             + Mul&lt;Self,Self&gt; + Div&lt;Self,Self&gt; + Rem&lt;Self,Self&gt;
{
    fn zero() -&gt; Self;  // These should be associated constants when those are available
    fn one() -&gt; Self;
    fn min_value() -&gt; Self;
    fn max_value() -&gt; Self;
}</code></pre>
<p>However, it’s not clear whether this factoring is worth having a more complex hierarchy, especially because the traits are not intended for generic programming at that level (and generic programming across integer and floating-point types is likely to be extremely rare)</p>
<p>The signed and unsigned operations could be offered on more types, allowing removal of more traits but a less clear-cut semantics.</p>
<h2 id="未解決的問題"><a class="header" href="#未解決的問題">未解決的問題</a></h2>
<p>This RFC does not propose a replacement for <code>#[deriving(FromPrimitive)]</code>, leaving the relevant traits in limbo status. (See <a href="https://github.com/rust-lang/rust/issues/10418">this proposal</a> and the discussion on <a href="https://github.com/rust-lang/rust/issues/10272">this issue</a> about <code>Ordinal</code> for the rough direction forward.)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="0356-no-module-prefixes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="0378-expr-macros.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="0356-no-module-prefixes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="0378-expr-macros.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
