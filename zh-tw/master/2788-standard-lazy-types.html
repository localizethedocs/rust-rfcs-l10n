<!DOCTYPE HTML>
<html lang="zh_TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2788-standard-lazy-types - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-c5bb60c5.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Feature Name: <code>once_cell</code></li>
<li>Start Date: 2019-10-17</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/2788">rust-lang/rfcs#2788</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/74465">rust-lang/rust#74465</a>, <a href="https://github.com/rust-lang/rust/issues/109736">rust-lang/rust#109736</a>, <a href="https://github.com/rust-lang/rust/issues/109737">rust-lang/rust#109737</a></li>
</ul>
<h2 id="摘要"><a class="header" href="#摘要">摘要</a></h2>
<p>Add support for lazy initialized values to standard library, effectively superseding the popular <a href="https://crates.io/crates/lazy_static"><code>lazy_static</code></a> crate.</p>
<pre><code class="language-rust">use std::sync::Lazy;

// `BACKTRACE` implements `Deref&lt;Target = Option&lt;String&gt;&gt;` and is initialized
// on the first access
static BACKTRACE: Lazy&lt;Option&lt;String&gt;&gt; = Lazy::new(|| {
    std::env::var("RUST_BACKTRACE").ok()
});</code></pre>
<h2 id="動機"><a class="header" href="#動機">動機</a></h2>
<p>Working with lazy initialized values is ubiquitous, <a href="https://crates.io/crates/lazy_static"><code>lazy_static</code></a> and <a href="https://crates.io/crates/lazycell"><code>lazycell</code></a> crates are used throughout the ecosystem. Although some of the popularity of <code>lazy_static</code> can be attributed to current limitations of constant evaluation in Rust, there are many cases when even perfect <code>const fn</code> can’t replace lazy values.</p>
<p>At the same time, working with lazy values in Rust is not easy:</p>
<ul>
<li>Implementing them requires moderately tricky unsafe code. Multiple soundness holes were found in the implementations from crates.io.</li>
<li>C++ and Java provide language-level delayed initialization for static values, while Rust requires explicit code to handle runtime-initialization.</li>
<li>Rust borrowing rules require a special pattern when implementing lazy fields.</li>
</ul>
<p><code>lazy_static</code> is implemented using macros, to work-around former language limitations. Since then, various language improvements have made it possible to  create runtime initialized (lazy) objects in a <code>static</code> scope, accomplishing the same goals without macros.</p>
<p>We can have a single canonical API for a commonly used tricky unsafe concept, so we probably should have it!</p>
<h2 id="guide-level-explanation"><a class="header" href="#guide-level-explanation">Guide-level explanation</a></h2>
<p>Lazy values are a form of interior mutability. The key observation is that restricting a cell to single assignment allows to safely return a shared reference to the contents of the cell. Such cell is called <code>OnceCell</code>, by analogy with <code>std::sync::Once</code> type. The core API is as follows:</p>
<pre><code class="language-rust">pub struct OnceCell&lt;T&gt; { ... }

impl&lt;T&gt; OnceCell&lt;T&gt; {
    /// Creates a new empty cell.
    pub const fn new() -&gt; OnceCell&lt;T&gt;;

    /// Gets the reference to the underlying value.
    ///
    /// Returns `None` if the cell is empty.
    pub fn get(&amp;self) -&gt; Option&lt;&amp;T&gt;;

    /// Sets the contents of this cell to `value`.
    ///
    /// Returns `Ok(())` if the cell was empty and `Err(value)` if it was
    /// full.
    pub fn set(&amp;self, value: T) -&gt; Result&lt;(), T&gt;;

    /// Gets the contents of the cell, initializing it with `f`
    /// if the cell was empty.
    ///
    /// # Panics
    ///
    /// If `f` panics, the panic is propagated to the caller, and the cell
    /// remains uninitialized.
    ///
    /// It is an error to reentrantly initialize the cell from `f`. Doing
    /// so results in a panic or a deadlock.
    pub fn get_or_init&lt;F&gt;(&amp;self, f: F) -&gt; &amp;T
    where
        F: FnOnce() -&gt; T,
    ;

    /// Gets the contents of the cell, initializing it with `f` if
    /// the cell was empty. If the cell was empty and `f` failed, an
    /// error is returned.
    ///
    /// # Panics
    ///
    /// If `f` panics, the panic is propagated to the caller, and the cell
    /// remains uninitialized.
    ///
    /// It is an error to reentrantly initialize the cell from `f`. Doing
    /// so results in a panic or a deadlock.
    pub fn get_or_try_init&lt;F, E&gt;(&amp;self, f: F) -&gt; Result&lt;&amp;T, E&gt;
    where
        F: FnOnce() -&gt; Result&lt;T, E&gt;,
    ;
}</code></pre>
<p>Notable features of the API:</p>
<ul>
<li><code>OnceCell</code> is created empty, by a const fn.</li>
<li>Initialization succeeds at most once.</li>
<li><code>get_or_init</code> and <code>get_or_try_init</code> methods can be used to conveniently initialize a cell.</li>
<li><code>get_</code> family of methods return <code>&amp;T</code>.</li>
</ul>
<p>Similarly to other interior mutability primitives, <code>OnceCell</code> comes in two flavors:</p>
<ul>
<li>Non thread-safe <code>std::cell::OnceCell</code>.</li>
<li>Thread-safe <code>std::sync::OnceLock</code>.</li>
</ul>
<p>Here’s how <code>OnceCell</code> can be used to implement lazy-initialized global data:</p>
<pre><code class="language-rust">use std::{sync::{Mutex, OnceCell}, collections::HashMap};

fn global_data() -&gt; &amp;'static Mutex&lt;HashMap&lt;i32, String&gt;&gt; {
    static INSTANCE: OnceCell&lt;Mutex&lt;HashMap&lt;i32, String&gt;&gt;&gt; = OnceCell::new();
    INSTANCE.get_or_init(|| {
        let mut m = HashMap::new();
        m.insert(13, "Spica".to_string());
        m.insert(74, "Hoyten".to_string());
        Mutex::new(m)
    })
}</code></pre>
<p>Here’s how <code>OnceCell</code> can be used to implement a lazy field:</p>
<pre><code class="language-rust">use std::{fs, io, path::PathBuf, cell::OnceCell};

struct Ctx {
    config_path: PathBuf,
    config: OnceCell&lt;String&gt;,
}

impl Ctx {
    pub fn get_config(&amp;self) -&gt; Result&lt;&amp;str, io::Error&gt; {
        let cfg = self.config.get_or_try_init(|| {
            fs::read_to_string(&amp;self.config_path)
        })?;
        Ok(cfg.as_str())
    }
}</code></pre>
<p>We also provide the more convenient but less powerful <code>Lazy&lt;T, F&gt;</code> and <code>LazyLock&lt;T, F&gt;</code> wrappers around <code>OnceCell&lt;T&gt;</code> and <code>OnceLock&lt;T&gt;</code>, which allows specifying the initializing closure at creation time:</p>
<pre><code class="language-rust">pub struct LazyCell&lt;T, F = fn() -&gt; T&gt; { ... }

impl&lt;T, F: FnOnce() -&gt; T&gt; LazyCell&lt;T, F&gt; {
    /// Creates a new lazy value with the given initializing function.
    pub const fn new(init: F) -&gt; LazyCell&lt;T, F&gt;;

    /// Forces the evaluation of this lazy value and returns a reference to
    /// the result.
    ///
    /// This is equivalent to the `Deref` impl, but is explicit.
    pub fn force(this: &amp;LazyCell&lt;T, F&gt;) -&gt; &amp;T;
}

impl&lt;T, F: FnOnce() -&gt; T&gt; Deref for LazyCell&lt;T, F&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;T;
}</code></pre>
<p><code>LazyLock</code> directly replaces <code>lazy_static!</code>:</p>
<pre><code class="language-rust">use std::{sync::{Mutex, LazyLock}, collections::HashMap};

static GLOBAL_DATA: LazyLock&lt;Mutex&lt;HashMap&lt;i32, String&gt;&gt;&gt; = LazyLock::new(|| {
    let mut m = HashMap::new();
    m.insert(13, "Spica".to_string());
    m.insert(74, "Hoyten".to_string());
    Mutex::new(m)
});</code></pre>
<p>Moreover, once <code>#[thread_local]</code> attribute is stable, <code>Lazy</code> might supplant <code>std::thread_local!</code> as well:</p>
<pre><code class="language-rust">use std::cell::{RefCell, Lazy};

#[thread_local]
pub static FOO: Lazy&lt;RefCell&lt;u32&gt;&gt; = Lazy::new(|| RefCell::new(1));</code></pre>
<p>Unlike <code>lazy_static!</code>, <code>Lazy</code> can be used for locals:</p>
<pre><code class="language-rust">use std::cell::LazyCell;

fn main() {
    let ctx = vec![1, 2, 3];
    let thunk = LazyCell::new(|| {
        ctx.iter().sum::&lt;i32&gt;()
    });
    assert_eq!(*thunk, 6);
}</code></pre>
<h2 id="reference-level-explanation"><a class="header" href="#reference-level-explanation">Reference-level explanation</a></h2>
<p>The proposed API is directly copied from <a href="https://crates.io/crates/once_cell"><code>once_cell</code></a> crate.</p>
<p>Altogether, this RFC proposes to add four types:</p>
<ul>
<li><code>std::cell::OnceCell</code>, <code>std::cell::LazyCell</code></li>
<li><code>std::sync::OnceLock</code>, <code>std::sync::LazyLock</code></li>
</ul>
<p><code>OnceCell</code> and <code>OnceLock</code> are important primitives. <code>LazyCell </code> and <code>LazyLock</code> can be stabilized separately from <code>OnceCell</code>, or optionally omitted from the standard library altogether. However, as they provide significantly nicer ergonomics for the common use case of static lazy values, it is worth developing in tandem.</p>
<p>Non thread-safe flavor is implemented by storing an <code>UnsafeCell&lt;Option&lt;T&gt;&gt;</code>:</p>
<pre><code class="language-rust">pub struct OnceCell&lt;T&gt; {
    // Invariant: written to at most once.
    inner: UnsafeCell&lt;Option&lt;T&gt;&gt;,
}</code></pre>
<p>The implementation is mostly straightforward. The only tricky bit is that reentrant initialization should be explicitly forbidden. That is, the following program panics:</p>
<pre><code class="language-rust">let x: OnceCell&lt;Box&lt;i32&gt;&gt; = OnceCell::new();
let dangling_ref: Cell&lt;Option&lt;&amp;i32&gt;&gt; = Cell::new(None);
x.get_or_init(|| {
    let r = x.get_or_init(|| Box::new(92));
    dangling_ref.set(Some(r));
    Box::new(62)
});
println!("would be use after free: {:?}", dangling_ref.get().unwrap());</code></pre>
<p>Non thread-safe flavor can be added to <code>core</code> as well.</p>
<p>The thread-safe variant is implemented similarly to <code>std::sync::Once</code>. Crucially, it has support for blocking: if many threads call <code>get_or_init</code> concurrently, only one will be able to execute the closure, while all other threads will block. For this reason, most of <code>std::sync::OnceLock</code> API can not be provided in <code>core</code>. In the <code>sync</code> case, reliably panicking on re-entrant initialization is not trivial. For this reason, the implementation would simply deadlock, with a note that a deadlock might be elevated to a panic in the future.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<ul>
<li>
<p>This is a moderately large addition to stdlib, there’s a chance we do something wrong. This can be mitigated by piece-wise stabilization (in particular, <code>LazyCell</code> convenience types are optional) and the fact that API is tested in the crates.io ecosystem via <code>once_cell</code> crate.</p>
</li>
<li>
<p>The design of <code>LazyCell</code> type uses default type-parameter as a workaround for the absence of type inference of statics.</p>
</li>
<li>
<p>We use the same name for unsync and sync types, which might be confusing.</p>
</li>
</ul>
<h2 id="rationale-and-alternatives"><a class="header" href="#rationale-and-alternatives">Rationale and alternatives</a></h2>
<h3 id="why-not-lazycell-as-a-primitive"><a class="header" href="#why-not-lazycell-as-a-primitive">Why not <code>LazyCell</code> as a primitive?</a></h3>
<p>On the first look, it may seem like we don’t need <code>OnceCell</code>, and should only provide <code>LazyCell</code>. The critical drawback of <code>LazyCell</code> is that it’s not always possible to provide the closure at creation time.</p>
<p>This is important for lazy fields:</p>
<pre><code class="language-rust">struct Ctx {
    config_path: PathBuf,
    config: Lazy&lt;String, ???&gt;,
}

impl Ctx {
    pub fn new(config_path: PathBuf) -&gt; Ctx {
        Ctx {
            config_path,
            config: Lazy::new(|| {
                // We would like to write something like
                // `fs::read_to_string(&amp;self.config_path)`
                // here, but we can't have access to `self`
                ???
            })
        }
    }
}</code></pre>
<p>Or for singletons, initialized with parameters:</p>
<pre><code class="language-rust">use std::{env, io, sync::OnceCell};

#[derive(Debug)]
pub struct Logger { ... }

static INSTANCE: OnceCell&lt;Logger&gt; = OnceCell::new();
impl Logger {
    pub fn global() -&gt; &amp;'static Logger {
        INSTANCE.get().expect("logger is not initialized")
    }
    fn from_cli(args: env::Args) -&gt; Result&lt;Logger, std::io::Error&gt; { ... }
}

fn main() {
    let logger = Logger::from_cli(env::args()).unwrap();

    // Note how we use locally-created value for initialization.
    INSTANCE.set(logger).unwrap();

    // use `Logger::global()` from now on
}</code></pre>
<h3 id="why-oncecell-as-a-primitive"><a class="header" href="#why-oncecell-as-a-primitive">Why <code>OnceCell</code> as a primitive?</a></h3>
<p>It is possible to imagine a type, slightly more general than <code>OnceCell</code>:</p>
<pre><code class="language-rust">struct OnceFlipCell&lt;U, V&gt; { ... }

impl&lt;U, V&gt; OnceFlipCell&lt;U, V&gt; {
    const fn new(initial_value: U) -&gt; OnceFlipCell&lt;U, V&gt;;

    fn get_or_init&lt;F: FnOnce(U) -&gt; V&gt;(&amp;self, f: F) -&gt; &amp;V;
}

type OnceCell&lt;T&gt; = OnceFlipCell&lt;(), T&gt;;</code></pre>
<p>That is, we can store some initial state in the cell and consume it during initialization. In practice, such flexibility seems to be rarely required. Even if we add a type, similar to <code>OnceFlipCell</code>, having a dedicated <code>OnceCell</code> (which <em>could</em> be implemented on top of <code>OnceFlipCell</code>) type simplifies a common use-case.</p>
<h3 id="variations-of-set"><a class="header" href="#variations-of-set">Variations of <code>set</code></a></h3>
<p>The RFC proposes “obvious” signature for the <code>set</code> method:</p>
<pre><code class="language-rust">fn set(&amp;self, value: T) -&gt; Result&lt;(), T&gt;;</code></pre>
<p>Note, however, that <code>set</code> establishes an invariant that the cell is initialized, so a more precise signature would be</p>
<pre><code class="language-rust">fn set(&amp;self, value: T) -&gt; (&amp;T, Option&lt;T&gt;);</code></pre>
<p>To be able to return a reference, <code>set</code> might need to block a thread. For example, if two threads call <code>set</code> concurrently, one of them needs to block while the other moves the value into the cell. It is possible to provide a non-blocking alternative to <code>set</code>:</p>
<pre><code class="language-rust">fn try_set(&amp;self, value: T) -&gt; Result&lt;&amp;T, (Option&lt;&amp;T&gt;, T)&gt;</code></pre>
<p>That is, if value is set successfully, a reference is returned. Otherwise, the cell is either fully initialized, and a reference is returned as well, or the cell is being initialized, and no valid reference exist yet.</p>
<h3 id="support-for-no_std"><a class="header" href="#support-for-no_std">Support for <code>no_std</code></a></h3>
<p>The RFC proposes to add <code>cell::OnceCell</code> and <code>cell::LazyCell</code> to <code>core</code>, while keeping <code>sync::OnceLock</code> and <code>sync::LazyLock</code> <code>std</code>-only. However, there’s a subset of <code>OnceLock</code> that can be provided in <code>core</code>:</p>
<pre><code class="language-rust">impl&lt;T&gt; OnceCell&lt;T&gt; {
    const fn new() -&gt; OnceCell&lt;T&gt;;
    fn get(&amp;self) -&gt; Option&lt;&amp;T&gt;;
    fn try_set(&amp;self, value: T) -&gt; Result&lt;&amp;T, (Option&lt;&amp;T&gt;, T)&gt;
}</code></pre>
<p>It is possible because, while <code>OnceCell</code> needs blocking for full API, its internal state can be implemented as a single <code>AtomicUsize</code>, so the <code>core</code> part does not need to know about blocking. It is unclear if this API would be significantly useful. In particular, the guarantees of non-blocking <code>set</code> are pretty weak, and are not enough to implement the <code>Lazy</code> wrapper.</p>
<p>While it is possible to implement blocking in <code>#[no_std]</code> via a spin lock, we explicitly choose not to do so. Spin locks are a sharp tool, which should only be used in specific circumstances (namely, when you have full control over thread scheduling). <code>#[no_std]</code> code might end up in user space applications with preemptive scheduling, where unbounded spin locks are inappropriate.</p>
<p>A spin-lock based implementation of <code>OnceCell</code> is provided on crates.io in <a href="https://github.com/oliver-giersch/conquer-once"><code>conquer-once</code></a> crate.</p>
<h3 id="poisoning"><a class="header" href="#poisoning">Poisoning</a></h3>
<p>As a cell can be empty or fully initialized, the proposed API does not use poisoning. If an initialization function panics, the cell remains uninitialized. An alternative would be to add poisoning, which will make all subsequent <code>get</code> calls to panic.</p>
<p>Similarly, because <code>OnceCell</code> provides strong exception safety guarantee, it implements <code>UnwindSafe</code>:</p>
<pre><code class="language-rust">impl&lt;T: UnwindSafe&gt;                    UnwindSafe for OnceCell&lt;T&gt; {}
impl&lt;T: UnwindSafe + RefUnwindSafe&gt; RefUnwindSafe for OnceCell&lt;T&gt; {}</code></pre>
<h3 id="default-type-parameter-on-lazy"><a class="header" href="#default-type-parameter-on-lazy">Default type parameter on <code>Lazy</code></a></h3>
<p><code>Lazy</code> is defined with default type parameter.</p>
<pre><code class="language-rust">pub struct Lazy&lt;T, F = fn() -&gt; T&gt; { ... }</code></pre>
<p>This is important to make using <code>Lazy</code> in static contexts convenient. Without this default, the user would have to type <code>T</code> type twice:</p>
<pre><code class="language-rust">static GLOBAL_DATA: Lazy&lt;Mutex&lt;HashMap&lt;i32, String&gt;&gt;, fn() -&gt; Mutex&lt;HashMap&lt;i32, String&gt;&gt;
    = Lazy::new(|| ... );</code></pre>
<p>If we allow type inference in statics, this could be shortened to</p>
<pre><code class="language-rust">static GLOBAL_DATA: Lazy&lt;Mutex&lt;HashMap&lt;i32, String&gt;&gt;, _&gt;
    = Lazy::new(|| ... );</code></pre>
<p>There are two drawbacks of using fn pointer type:</p>
<ul>
<li>fn pointers are not ZSTs, so we waste one pointer per static lazy value. Lazy locals will generally rely on type-inference and will use more specific closure type.</li>
<li>Specifying type for local lazy value might be tricky: <code>let x: Lazy&lt;i32&gt; = Lazy::new(|| closed_over_var)</code> fails with type error, the correct syntax is <code>let x: Lazy&lt;i32, _&gt; = Lazy::new(|| closed_over_var)</code>.</li>
</ul>
<h3 id="only-thread-safe-flavor"><a class="header" href="#only-thread-safe-flavor">Only thread-safe flavor</a></h3>
<p>It is possible to add only <code>sync</code> version of the types, as they are the most useful. However, this would be against zero cost abstractions spirit. Additionally, non thread-safe version is required to replace <code>thread_local!</code> macro without imposing synchronization.</p>
<h3 id="synchronization-guarantees"><a class="header" href="#synchronization-guarantees">Synchronization Guarantees</a></h3>
<p>In theory, it is possible to specify two different synchronization guarantees for <code>get</code> operation, release/acquire or release/consume. They differ in how they treat side effects. If thread <strong>A</strong> executes <code>get_or_init(f)</code>, and thread <strong>B</strong> executes <code>get</code> and observes the value, release/acquire guarantees that <strong>B</strong> also observes side-effects of <code>f</code>.</p>
<p>Here’s a program which allows to observe the difference:</p>
<pre><code class="language-rust">static FLAG: AtomicBool = AtomicBool::new(false);
static CELL: OnceCell&lt;()&gt; = OnceCell::new();

// thread1
CELL.get_or_init(|| FLAG.store(true, Relaxed));

// thread2
if CELL.get().is_some() {
  assert!(FLAG.load(Relaxed))
}</code></pre>
<p>Under release/acquire, the assert never fires. Under release/consume, it might fire.</p>
<p>Release/consume can potentially be implemented more efficiently on weak memory model architectures. However, the situation with <code>consume</code> ordering is cloudy right now:</p>
<ul>
<li><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0371r0.html">nobody knows what it actually means</a>,</li>
<li><a href="https://docs.rs/crossbeam-utils/0.7.0/crossbeam_utils/atomic/trait.AtomicConsume.html#tymethod.load_consume">but people rely on it in practice for performance</a>.</li>
</ul>
<p>Given the cost of <code>consume</code> ordering for minimal benefit, this crate proposes to specify and implement <code>acquire/release</code> ordering. If at some point Rust adds a <code>consume/release</code> option to <code>std::sync::atomic::Ordering</code>, the option of adding API methods that accept an <code>Ordering</code> can be considered.</p>
<h2 id="prior-art"><a class="header" href="#prior-art">Prior art</a></h2>
<p>The primary bit of prior art here is the <a href="https://crates.io/crates/once_cell"><code>once_cell</code></a> library, which itself draws on multiple sources:</p>
<ul>
<li><a href="https://crates.io/crates/double-checked-cell">double-checked-cell</a></li>
<li><a href="https://crates.io/crates/lazy-init">lazy-init</a></li>
<li><a href="https://crates.io/crates/lazycell">lazycell</a></li>
<li><a href="https://crates.io/crates/mitochondria">mitochondria</a></li>
<li><a href="https://crates.io/crates/lazy_static">lazy_static</a></li>
</ul>
<p>Many languages provide library-defined lazy values, for example <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/lazy.html#kotlin$lazy(kotlin.Function0((kotlin.lazy.T)))">Kotlin</a>. Typically, a lazy value is just a wrapper around closure. This design doesn’t always work in Rust, as closing over <code>self</code> runs afoul of the borrow checker, we need a more primitive <code>OnceCell</code> type.</p>
<h2 id="未解決的問題"><a class="header" href="#未解決的問題">未解決的問題</a></h2>
<ul>
<li>What is the best naming/place for these types?</li>
<li>What is the best naming scheme for methods? Is it <code>get_or_try_init</code> or <code>try_insert_with</code>?</li>
<li>Is the <code>F = fn() -&gt; T</code> hack worth it?</li>
<li>Which synchronization guarantee should we pick?</li>
</ul>
<h2 id="future-possibilities"><a class="header" href="#future-possibilities">Future possibilities</a></h2>
<ul>
<li>Once <code>#[thread_local]</code> attribute is stable, <code>cell::Lazy</code> can serve as a replacement for <code>std::thread_local!</code> macro.</li>
<li>Supporting type inference in constants might allow us to drop the default type parameter on <code>Lazy</code>.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="2730-cargo-token-from-process.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="2789-sparse-index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="2730-cargo-token-from-process.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="2789-sparse-index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
