<!DOCTYPE HTML>
<html lang="zh_TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2592-futures - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-c5bb60c5.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Feature Name: <code>futures_api</code></li>
<li>Start Date: 2018-11-09</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/2592">rust-lang/rfcs#2592</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/59113">rust-lang/rust#59113</a></li>
</ul>
<h2 id="摘要"><a class="header" href="#摘要">摘要</a></h2>
<p>This RFC proposes to stabilize the library component for the <a href="https://github.com/rust-lang/rfcs/pull/2394">first-class <code>async</code>/<code>await</code> syntax</a>. In particular, it would stabilize:</p>
<ul>
<li>All APIs of the <code>std</code>-level task system, i.e. <code>std::task::*</code>.</li>
<li>The core <code>Future</code> API, i.e. <code>core::future::Future</code> and <code>std::future::Future</code>.</li>
</ul>
<p>It does <em>not</em> propose to stabilize any of the <code>async</code>/<code>await</code> syntax itself, which will be proposed in a separate step. It also does not cover stabilization of the <code>Pin</code> APIs, which has <a href="https://github.com/rust-lang/rust/issues/55766">already been proposed elsewhere</a>.</p>
<p>This is a revised and slimmed down version of the <a href="https://github.com/rust-lang/rfcs/pull/2418">earlier futures RFC</a>, which was postponed until more experience was gained on nightly.</p>
<h2 id="動機"><a class="header" href="#動機">動機</a></h2>
<h3 id="why-futures-in-std"><a class="header" href="#why-futures-in-std">Why <code>Future</code>s in <code>std</code>?</a></h3>
<p>The core motivation for this RFC is to stabilize the supporting mechanisms for <code>async</code>/<code>await</code> syntax.  The syntax itself is motivated in the (already merged) <a href="https://github.com/rust-lang/rfcs/pull/2394">companion RFC</a>, and there is a <a href="https://aturon.github.io/tech/2018/04/24/async-borrowing/">blog post</a> that goes through its importance in greater detail.</p>
<p>As with closures, <code>async</code> syntax involves producing an anonymous type that implements a key trait: <code>Future</code>. Because <code>async</code>/<code>await</code> requires language-level support, the underlying trait must also be part of the standard library. Thus, the goal of this RFC is to stabilize this <code>Future</code> trait and the types it depends on. This is the last step needed before we are in a position to stabilize <code>async</code>/<code>await</code> itself.</p>
<h3 id="how-does-this-step-fit-into-the-bigger-picture"><a class="header" href="#how-does-this-step-fit-into-the-bigger-picture">How does this step fit into the bigger picture?</a></h3>
<p>The <code>async</code>/<code>await</code> syntax is one of the most eagerly desired features in Rust, and will have a major impact on the ecosystem. It, and the APIs described here, have been available on nightly and put into major use since late May 2018.</p>
<p>Stabilizing the futures API portion of this design makes it easier for libraries to both work on stable Rust <em>and</em> to seamlessly support use of <code>async</code>/<code>await</code> on nightly. It also allows us to finalize design debate on the API portion, and focus on the few remaining questions about <code>async</code> syntax before it, too, is stabilized.</p>
<h2 id="historical-context"><a class="header" href="#historical-context">Historical context</a></h2>
<p>The APIs proposed for stabilization have a lengthy history:</p>
<ul>
<li>
<p>The <code>Future</code> trait began with the futures crate; <a href="https://aturon.github.io/tech/2016/08/11/futures/">0.1 was released</a> in August of 2016. That release established the core ideas of the task/polling model, as well as many other aspects of the API that are retained here. The 0.1 series continues to be heavily used throughout the Rust ecosystem and in production systems.</p>
</li>
<li>
<p>In early 2018, as work began toward <code>async</code>/<code>await</code>, the futures team set up an RFC process and wrote <a href="https://github.com/rust-lang-nursery/futures-rfcs/pulls?q=is%3Apr+is%3Aclosed">several RFCs</a> to make revisions to the core APIs based on longstanding community feedback. These RFCs ultimately resulted in a <a href="https://aturon.github.io/tech/2018/02/27/futures-0-2-RC/">0.2le release</a>, which <a href="https://aturon.github.io/tech/2018/04/06/futures2/">shipped</a> in April.</p>
</li>
<li>
<p>During the same period, @withoutboats’s work on the pinning APIs supporting borrowing within <code>async</code> blocks <a href="https://boats.gitlab.io/blog/post/2018-04-06-async-await-final/">came to completion</a>. The <a href="https://github.com/rust-lang/rfcs/pull/2349">pinning APIs</a> were a game-changer, making it possible to support borrowing-across-yield <em>without</em> making the core future APIs unsafe.</p>
</li>
<li>
<p>In April 2018, a pair of RFCs formally proposed the <code>async</code>/<code>await</code> syntax as well as further revision of the futures API (to take advantage of the pinning APIs); the latter went through many revisions, including a <a href="https://github.com/rust-lang/rfcs/pull/2418">fresh RFC</a>. Ultimately, the <a href="https://github.com/rust-lang/rfcs/pull/2394#issuecomment-387550523">syntax RFC was merged</a> in May, while the API RFC was closed, with <a href="https://github.com/rust-lang/rfcs/pull/2418#issuecomment-415841459">the understanding</a> that further design iteration would occur on nightly, to be followed up by a stabilization RFC: this one!</p>
</li>
<li>
<p>The APIs <a href="https://github.com/rust-lang/rust/pull/51263">landed in <code>std</code></a> at the end of May.</p>
</li>
<li>
<p>Since then, the syntax, the <code>std</code> APIs, and the futures 0.3 crate have all evolved in tandem as we’ve gained experience with the APIs. A major driver in this experience has been Google’s Fuchsia project, which is using <em>all</em> of these features at large scale in an operating system setting.</p>
</li>
<li>
<p>The most recent revisions were in August, and involved <a href="https://boats.gitlab.io/blog/post/rethinking-pin/">some insights</a> into how to make the <code>Pin</code> APIs even cleaner. These APIs have been <a href="https://github.com/rust-lang/rust/issues/55766">proposed for stabilization</a>, as has <a href="https://github.com/rust-lang/rust/issues/55786">their use as <code>self</code> types</a>.</p>
</li>
<li>
<p>There are multiple compatibility layers available for using futures 0.1 and 0.3 simultaneously. That’s important, because it allows for <em>incremental</em> migration of existing production code.</p>
</li>
</ul>
<p>Since the initial futures 0.3 release, relatively little has changed about the core <code>Future</code> trait and task system, other than the refinements mentioned above. The actual <code>Future</code> trait has stayed essentially as it was back in April.</p>
<h2 id="guide-level-explanation"><a class="header" href="#guide-level-explanation">Guide-level explanation</a></h2>
<p>The <code>Future</code> trait represents an <em>asynchronous</em> and lazy computation that may eventually produce a final value, but doesn’t have to block the current thread to do so.</p>
<p>Futures can be constructed through <code>async</code> blocks or <code>async</code> functions, e.g.,</p>
<pre><code class="language-rust">async fn read_frame(socket: &amp;TcpStream) -&gt; Result&lt;Frame, io::Error&gt; { ... }</code></pre>
<p>This <code>async</code> function, when invoked, produces a future that represents the completion of reading a frame from the given socket. The function signature is equivalent to:</p>
<pre><code class="language-rust">fn read_frame&lt;'sock&gt;(socket: &amp;'sock TcpStream)
    -&gt; impl Future&lt;Output = Result&lt;Frame, io::Error&gt;&gt; + 'sock;</code></pre>
<p>Other async functions can <em>await</em> this future; see the <a href="https://github.com/rust-lang/rfcs/pull/2394">companion RFC</a> for full details.</p>
<p>In addition to <code>async fn</code> definitions, futures can be built using adapters, much like with <code>Iterator</code>s. Initially these adapters will be provided entirely “out of tree”, but eventually they will make their way into the standard library.</p>
<p>Ultimately asynchronous computations are executed in the form of <em>tasks</em>, which are comparable to lightweight threads. _executor_s provide the ability to create tasks from <code>()</code>-producing <code>Future</code>s. The executor will pin the <code>Future</code> and <code>poll</code> it until completion inside the task that it creates for it.</p>
<p>The implementation of an executor schedules the tasks it owns in a cooperative fashion. It is up to the implementation of an executor whether one or more operation system threads are used for this, as well as how many tasks can be spawned on it in parallel. Some executor implementations may only be able to drive a single <code>Future</code> to completion, while others can provide the ability to dynamically accept new <code>Future</code>s that are driven to completion inside tasks.</p>
<p>This RFC does not include any definition of an executor. It merely defines the interaction between executors, tasks and <code>Future</code>s, in the form of APIs that allow tasks to request getting scheduled again. The <code>task</code> module provides these APIs, which are required when manually implementing <code>Future</code>s or executors.</p>
<h2 id="reference-level-explanation"><a class="header" href="#reference-level-explanation">Reference-level explanation</a></h2>
<h3 id="coretask-module"><a class="header" href="#coretask-module"><code>core::task</code> module</a></h3>
<p>The fundamental mechanism for asynchronous computation in Rust is <em>tasks</em>, which are lightweight threads of execution; many tasks can be cooperatively scheduled onto a single operating system thread.</p>
<p>To perform this cooperative scheduling we use a technique sometimes referred to as a “trampoline”. When a task would otherwise need to block waiting for some event, instead it saves an object that allows it to get scheduled again later and <em>returns</em> to the executor running it, which can then run another task. Subsequent wakeups place the task back on the executors queue of ready tasks, much like a thread scheduler in an operating system.</p>
<p>Attempting to complete a task (or async value within it) is called <em>polling</em>, and always yields a <code>Poll</code> value back:</p>
<pre><code class="language-rust">/// Indicates whether a value is available, or if the current task has been
/// scheduled for later wake-up instead.
#[derive(Copy, Clone, Debug, PartialEq)]
pub enum Poll&lt;T&gt; {
    /// Represents that a value is immediately ready.
    Ready(T),

    /// Represents that a value is not ready yet.
    ///
    /// When a function returns `Pending`, the function *must* also
    /// ensure that the current task is scheduled to be awoken when
    /// progress can be made.
    Pending,
}</code></pre>
<p>When a task returns <code>Poll::Ready</code>, the executor knows the task has completed and can be dropped.</p>
<h4 id="waking-up"><a class="header" href="#waking-up">Waking up</a></h4>
<p>If a future cannot be directly fulfilled during execution and returns <code>Pending</code>, it needs a way to later on inform the executor that it needs to get polled again to make progress.</p>
<p>This functionality is provided through a set of <code>Waker</code> types.</p>
<p><code>Waker</code>s are objects which are passed as a parameter to the <code>Future::poll</code> call, and which can be stored by the implementation of those <code>Futures</code>s. Whenever a <code>Future</code> has the need to get polled again, it can use the <code>wake</code> method of the waker in order to inform the executor that the task which owns the <code>Future</code> should get scheduled and executed again.</p>
<p>The RFC defines a concrete <code>Waker</code> type with which implementors of <code>Futures</code> and asynchronous functions will interact. This type defines a <code>wake(&amp;self)</code> method which is used to schedule the task that is associated to the <code>Waker</code> to be polled again.</p>
<p>The mechanism through which tasks get scheduled again depends on the executor which is driving the task. Possible ways of waking up an executor include:</p>
<ul>
<li>If the executor is blocked on a condition variable, the condition variable needs to get notified.</li>
<li>If the executor is blocked on a system call like <code>select</code>, it might need to get woken up by a syscall like <code>write</code> to a pipe.</li>
<li>If the executor’s thread is parked, the wakeup call needs to unpark it.</li>
</ul>
<p>To allow executors to implement custom wakeup behavior, the <code>Waker</code> type contains a type called <code>RawWaker</code>, which consists of a  pointer to a custom wakeable object and a reference to a virtual function pointer table (vtable) which provides functions to <code>clone</code>, <code>wake</code>, and <code>drop</code> the underlying wakeable object.</p>
<p>This mechanism is chosen in favor of trait objects since it allows for more flexible memory management schemes. <code>RawWaker</code> can be implemented purely in terms of global functions and state, on top of reference counted objects, or in other ways. This strategy also makes it easier to provide different vtable functions that will perform different behaviors despite referencing the same underlying wakeable object type.</p>
<p>The relation between those <code>Waker</code> types is outlined in the following definitions:</p>
<pre><code class="language-rust">/// A `RawWaker` allows the implementor of a task executor to create a `Waker`
/// which provides customized wakeup behavior.
///
/// It consists of a data pointer and a virtual function pointer table (vtable) that
/// customizes the behavior of the `RawWaker`.
#[derive(PartialEq)]
pub struct RawWaker {
    /// A data pointer, which can be used to store arbitrary data as required
    /// by the executor. This could be e.g. a type-erased pointer to an `Arc`
    /// that is associated with the task.
    /// The value of this field gets passed to all functions that are part of
    /// the vtable as first parameter.
    pub data: *const (),
    /// Virtual function pointer table that customizes the behavior of this waker.
    pub vtable: &amp;'static RawWakerVTable,
}

/// A virtual function pointer table (vtable) that specifies the behavior
/// of a `RawWaker`.
///
/// The pointer passed to all functions inside the vtable is the `data` pointer
/// from the enclosing `RawWaker` object.
#[derive(PartialEq, Copy, Clone)]
pub struct RawWakerVTable {
    /// This function will be called when the `RawWaker` gets cloned, e.g. when
    /// the `Waker` in which the `RawWaker` is stored gets cloned.
    ///
    /// The implementation of this function must retain all resources that are
    /// required for this additional instance of a `RawWaker` and associated
    /// task. Calling `wake` on the resulting `RawWaker` should result in a wakeup
    /// of the same task that would have been awoken by the original `RawWaker`.
    pub clone: unsafe fn(*const ()) -&gt; RawWaker,

    /// This function will be called when `wake` is called on the `Waker`.
    /// It must wake up the task associated with this `RawWaker`.
    pub wake: unsafe fn(*const ()),

    /// This function gets called when a `RawWaker` gets dropped.
    ///
    /// The implementation of this function must make sure to release any
    /// resources that are associated with this instance of a `RawWaker` and
    /// associated task.
    pub drop_fn: unsafe fn(*const ()),
}

/// A `Waker` is a handle for waking up a task by notifying its executor that it
/// is ready to be run.
///
/// This handle encapsulates a `RawWaker` instance, which defines the
/// executor-specific wakeup behavior.
///
/// Implements `Clone`, `Send`, and `Sync`.
pub struct Waker {
    waker: RawWaker,
}

impl Waker {
    /// Wake up the task associated with this `Waker`.
    pub fn wake(&amp;self) {
        // The actual wakeup call is delegated through a virtual function call
        // to the implementation which is defined by the executor.
        unsafe { (self.waker.vtable.wake)(self.waker.data) }
    }

    /// Returns whether or not this `Waker` and other `Waker` have awaken the same task.
    ///
    /// This function works on a best-effort basis, and may return false even
    /// when the `Waker`s would awaken the same task. However, if this function
    /// returns `true`, it is guaranteed that the `Waker`s will awaken the same task.
    ///
    /// This function is primarily used for optimization purposes.
    pub fn will_wake(&amp;self, other: &amp;Waker) -&gt; bool {
        self.waker == other.waker
    }

    /// Creates a new `Waker` from `RawWaker`.
    ///
    /// The method cannot check whether `RawWaker` fulfills the required API
    /// contract to make it usable for `Waker` and is therefore unsafe.
    pub unsafe fn new_unchecked(waker: RawWaker) -&gt; Waker {
        Waker {
            waker: waker,
        }
    }
}

impl Clone for Waker {
    fn clone(&amp;self) -&gt; Self {
        Waker {
            waker: unsafe { (self.waker.vtable.clone)(self.waker.data) },
        }
    }
}

impl Drop for Waker {
    fn drop(&amp;mut self) {
        unsafe { (self.waker.vtable.drop_fn)(self.waker.data) }
    }
}</code></pre>
<p><code>Waker</code>s must fulfill the following requirements:</p>
<ul>
<li>They must be cloneable.</li>
<li>If all instances of a <code>Waker</code> have been dropped and their associated task had been driven to completion, all resources which had been allocated for the task must have been released.</li>
<li>It must be safe to call <code>wake()</code> on a <code>Waker</code> even if the associated task has already been driven to completion.</li>
<li><code>Waker::wake()</code> must wake up an executor even if it is called from an arbitrary thread.</li>
</ul>
<p>An executor that instantiates a <code>RawWaker</code> must therefore make sure that all these requirements are fulfilled.</p>
<h3 id="corefuture-module"><a class="header" href="#corefuture-module"><code>core::future</code> module</a></h3>
<p>With all of the above task infrastructure in place, defining <code>Future</code> is straightforward:</p>
<pre><code class="language-rust">pub trait Future {
    /// The type of value produced on completion.
    type Output;

    /// Attempt to resolve the future to a final value, registering
    /// the current task for wakeup if the value is not yet available.
    ///
    /// # Return value
    ///
    /// This function returns:
    ///
    /// - [`Poll::Pending`] if the future is not ready yet
    /// - [`Poll::Ready(val)`] with the result `val` of this future if it
    ///   finished successfully.
    ///
    /// Once a future has finished, clients should not `poll` it again.
    ///
    /// When a future is not ready yet, `poll` returns `Poll::Pending` and
    /// stores a clone of the [`Waker`] to be woken once the future can
    /// make progress. For example, a future waiting for a socket to become
    /// readable would call `.clone()` on the [`Waker`] and store it.
    /// When a signal arrives elsewhere indicating that the socket is readable,
    /// `[Waker::wake]` is called and the socket future's task is awoken.
    /// Once a task has been woken up, it should attempt to `poll` the future
    /// again, which may or may not produce a final value.
    ///
    /// Note that on multiple calls to `poll`, only the most recent
    /// [`Waker`] passed to `poll` should be scheduled to receive a
    /// wakeup.
    ///
    /// # Runtime characteristics
    ///
    /// Futures alone are *inert*; they must be *actively* `poll`ed to make
    /// progress, meaning that each time the current task is woken up, it should
    /// actively re-`poll` pending futures that it still has an interest in.
    ///
    /// The `poll` function is not called repeatedly in a tight loop-- instead,
    /// it should only be called when the future indicates that it is ready to
    /// make progress (by calling `wake()`). If you're familiar with the
    /// `poll(2)` or `select(2)` syscalls on Unix it's worth noting that futures
    /// typically do *not* suffer the same problems of "all wakeups must poll
    /// all events"; they are more like `epoll(4)`.
    ///
    /// An implementation of `poll` should strive to return quickly, and must
    /// *never* block. Returning quickly prevents unnecessarily clogging up
    /// threads or event loops. If it is known ahead of time that a call to
    /// `poll` may end up taking awhile, the work should be offloaded to a
    /// thread pool (or something similar) to ensure that `poll` can return
    /// quickly.
    ///
    /// # Panics
    ///
    /// Once a future has completed (returned `Ready` from `poll`),
    /// then any future calls to `poll` may panic, block forever, or otherwise
    /// cause bad behavior. The `Future` trait itself provides no guarantees
    /// about the behavior of `poll` after a future has completed.
    ///
    /// [`Poll::Pending`]: ../task/enum.Poll.html#variant.Pending
    /// [`Poll::Ready(val)`]: ../task/enum.Poll.html#variant.Ready
    /// [`Waker`]: ../task/struct.Waker.html
    /// [`Waker::wake`]: ../task/struct.Waker.html#method.wake
    fn poll(self: Pin&lt;&amp;mut Self&gt;, waker: &amp;Waker) -&gt; Poll&lt;Self::Output&gt;;
}</code></pre>
<p>Most of the explanation here follows what we’ve already said about the task system. The one twist is the use of <code>Pin</code>, which makes it possible to keep data borrowed across separate calls to <code>poll</code> (i.e., “borrowing over yield points”). The mechanics of pinning are explained in <a href="https://github.com/rust-lang/rfcs/pull/2349">the RFC that introduced it</a> and the <a href="https://boats.gitlab.io/blog/post/rethinking-pin/">blog post about the latest revisions</a>.</p>
<h3 id="relation-to-futures-01"><a class="header" href="#relation-to-futures-01">Relation to futures 0.1</a></h3>
<p>The various discussions outlined in the historical context section above cover the path to these APIs from futures 0.1. But, in a nutshell, there are three major shifts:</p>
<ul>
<li>
<p>The use of <code>Pin&lt;&amp;mut self&gt;</code> rather than just <code>&amp;mut self</code>, which is necessary to support borrowing within <code>async</code> blocks. The <code>Unpin</code> marker trait can be used to restore ergonomics and safety similar to futures 0.1 when writing futures by hand.</p>
</li>
<li>
<p>Dropping <em>built in</em> errors from <code>Future</code>, in favor of futures returning a <code>Result</code> when they can fail. The futures 0.3 crate provides a <code>TryFuture</code> trait that bakes in the <code>Result</code> to provide better ergonomics when working with <code>Result</code>-producing futures. Dropping the error type has been discussed in previous threads, but the most important rationale is to provide an orthogonal, compositional semantics for <code>async fn</code> that mirrors normal <code>fn</code>, rather than <em>also</em> baking in a particular style of error handling.</p>
</li>
<li>
<p>Passing a <code>Waker</code> explicitly, rather than stashing it in thread-local storage. This has been a hotly debated issue since futures 0.1 was released, and this RFC does not seek to relitigate it, but to summarize, the major advantages are (1) when working with manual futures (as opposed to <code>async</code> blocks) it’s much easier to tell where an ambient task is required, and (2) <code>no_std</code> compatibility is significantly smoother.</p>
</li>
</ul>
<p>To bridge the gap between futures 0.1 and 0.3, there are several compatibility shims, including one built into the futures crate itself, where you can shift between the two simply by using a <code>.compat()</code> combinator. These compatibility layers make it possible to use the existing ecosystem smoothly with the new futures APIs, and make it possible to transition large code bases incrementally.</p>
<h2 id="rationale-drawbacks-and-alternatives"><a class="header" href="#rationale-drawbacks-and-alternatives">Rationale, drawbacks, and alternatives</a></h2>
<p>This RFC is one of the most substantial additions to <code>std</code> proposed since 1.0. It commits us to including a particular task and polling model in the standard library, and ties us to <code>Pin</code>.</p>
<p>So far we’ve been able to push the task/polling model into virtually every niche Rust wishes to occupy, and the main downside has been, in essence, the lack of async/await syntax (and the <a href="https://aturon.github.io/tech/2018/04/24/async-borrowing/">borrowing it supports</a>).</p>
<p>This RFC does not attempt to provide a complete introduction to the task model that originated with the futures crate. A fuller account of the design rationale and alternatives can be found in the following two blog posts:</p>
<ul>
<li><a href="https://aturon.github.io/tech/2016/08/11/futures/">Zero-cost futures in Rust</a></li>
<li><a href="https://aturon.github.io/tech/2016/09/07/futures-design/">Designing futures for Rust</a></li>
</ul>
<p>To summarize, the main alternative model for futures is a callback-based approach, which was attempted for several months before the current approach was discovered. In our experience, the callback approach suffered from several drawbacks in Rust:</p>
<ul>
<li>It forced allocation almost everywhere, and hence was not compatible with no_std.</li>
<li>It made cancellation <em>extremely</em> difficult to get right, whereas with the proposed model it’s just “drop”.</li>
<li>Subjectively, the combinator code was quite hairy, while with the task-based model things fell into place quickly and easily.</li>
</ul>
<p>Some additional context and rationale for the overall async/await project is available in the <a href="https://github.com/rust-lang/rfcs/pull/2394">companion RFC</a>.</p>
<p>For the remainder of this section, we’ll dive into specific API design questions where this RFC differs from futures 0.2.</p>
<h3 id="rationale-drawbacks-and-alternatives-for-removing-built-in-errors"><a class="header" href="#rationale-drawbacks-and-alternatives-for-removing-built-in-errors">Rationale, drawbacks and alternatives for removing built-in errors</a></h3>
<p>There are an assortment of reasons to drop the built-in error type in the main trait:</p>
<ul>
<li>
<p><strong>Improved type checking and inference</strong>. The error type is one of the biggest pain points when working with futures combinators today, both in trying to get different types to match up, and in inference failures that result when a piece of code cannot produce an error. To be clear, many of these problems will become less pronounced when <code>async</code> syntax is available.</p>
</li>
<li>
<p><strong>Async functions</strong>. If we retain a built-in error type, it’s much less clear how <code>async fn</code> should work: should it always require the return type to be a <code>Result</code>? If not, what happens when a non-<code>Result</code> type is returned?</p>
</li>
<li>
<p><strong>Combinator clarity</strong>. Splitting up the combinators by whether they rely on errors or not clarifies the semantics. This is <em>especially</em> true for streams, where error handling is a common source of confusion.</p>
</li>
<li>
<p><strong>Orthogonality</strong>. In general, producing and handling errors is separable from the core polling mechanism, so all things being equal, it seems good to follow Rust’s general design principles and treat errors by <em>composing</em> with <code>Result</code>.</p>
</li>
</ul>
<p>All of that said, there are real downsides for error-heavy code, even with <code>TryFuture</code>:</p>
<ul>
<li>
<p>An extra import is needed (obviated if code imports the futures prelude, which we could perhaps more vocally encourage).</p>
</li>
<li>
<p>It can be confusing for code to <em>bound</em> by one trait but <em>implement</em> another.</p>
</li>
</ul>
<p>The error handling piece of this RFC is separable from the other pieces, so the main alternative would be to retain the built-in error type.</p>
<h3 id="rationale-drawbacks-and-alternatives-to-the-core-trait-design-wrt-pin"><a class="header" href="#rationale-drawbacks-and-alternatives-to-the-core-trait-design-wrt-pin">Rationale, drawbacks and alternatives to the core trait design (wrt <code>Pin</code>)</a></h3>
<p>Putting aside error handling, which is orthogonal and discussed above, the primary other big item in this RFC is the move to <code>Pin</code> for the core polling method, and how it relates to <code>Unpin</code>/manually-written futures. Over the course of RFC discussions, we’ve identified essentially three main approaches to this question:</p>
<ul>
<li>
<p><strong>One core trait</strong>. That’s the approach taken in the main RFC text: there’s just a single core <code>Future</code> trait, which works on <code>Pin&lt;&amp;mut Self&gt;</code>. Separately there’s a <code>poll_unpin</code> helper for working with <code>Unpin</code> futures in manual implementations.</p>
</li>
<li>
<p><strong>Two core traits</strong>. We can provide two traits, for example <code>MoveFuture</code> and <code>Future</code>, where one operates on <code>&amp;mut self</code> and the other on <code>Pin&lt;&amp;mut Self&gt;</code>. This makes it possible to continue writing code in the futures 0.2 style, i.e. without importing <code>Pin</code>/<code>Unpin</code> or otherwise talking about pins. A critical requirement is the need for interoperation, so that a <code>MoveFuture</code> can be used anywhere a <code>Future</code> is required. There are at least two ways to achieve such interop:</p>
<ul>
<li>
<p>Via a blanket impl of <code>Future</code> for <code>T: MoveFuture</code>. This approach currently blocks some <em>other</em> desired impls (around <code>Box</code> and <code>&amp;mut</code> specifically), but the problem doesn’t appear to be fundamental.</p>
</li>
<li>
<p>Via a subtrait relationship, so that <code>T: Future</code> is defined essentially as an alias for <code>for&lt;'a&gt; Pin&lt;&amp;mut 'a T&gt;: MoveFuture</code>. Unfortunately, such “higher ranked” trait relationships don’t currently work well in the trait system, and this approach also makes things more convoluted when implementing <code>Future</code> by hand, for relatively little gain.</p>
</li>
</ul>
</li>
</ul>
<p>The drawback of the “one core trait” approach taken by this RFC is its ergonomic hit when writing moveable futures by hand: you now need to import <code>Pin</code> and <code>Unpin</code>, invoke <code>poll_unpin</code>, and impl <code>Unpin</code> for your types. This is all pretty mechanical, but it’s a pain. It’s possible that improvements in <code>Pin</code> ergonomics will obviate some of these issues, but there are a lot of open questions there still.</p>
<p>On the other hand, a two-trait approach has downsides as well. If we <em>also</em> remove the error type, there’s a combinatorial explosion, since we end up needing <code>Try</code> variants of each trait (and this extends to related traits, like <code>Stream</code>, as well). More broadly, with the one-trait approach, <code>Unpin</code> acts as a kind of “independent knob” that can be applied orthogonally from other concerns; with the two-trait approach, it’s “mixed in”. And both of the two-trait approaches run up against compiler limitations at the moment, though of course that shouldn’t be taken as a deciding factor.</p>
<p><strong>The primary reason this RFC opts for the one-trait approach is that it’s the conservative, forward-compatible option, and has proven itself in practice</strong>. It’s possible to add <code>MoveFuture</code>, together with a blanket impl, at any point in the future. Thus, starting with just the single <code>Future</code> trait as proposed in this RFC keeps our options maximally open while we gain experience.</p>
<h3 id="rationale-drawbacks-and-alternatives-to-the-wakeup-design-waker"><a class="header" href="#rationale-drawbacks-and-alternatives-to-the-wakeup-design-waker">Rationale, drawbacks and alternatives to the wakeup design (<code>Waker</code>)</a></h3>
<p>Previous iterations of this proposal included a separate wakeup type, <code>LocalWaker</code>, which was <code>!Send + !Sync</code> and could be used to implement optimized executor behavior without requiring atomic reference counting or atomic wakeups. However, in practice, these same optimizations are available through the use of thread-local wakeup queues, carrying IDs rather than pointers to wakeup objects, and tracking an executor ID or thread ID to perform a runtime assertion that a <code>Waker</code> wasn’t sent across threads. For a simple example, a single thread-locked executor with zero atomics can be implemented as follows:</p>
<pre><code class="language-rust">struct Executor {
    // map from task id (usize) to task
    tasks: Slab&lt;Task&gt;,
    // list of woken tasks to poll
    work_queue: VecDeque&lt;usize&gt;,
}

thread_local! {
  pub static EXECUTOR: RefCell&lt;Option&lt;Executor&gt;&gt; = ...;
}

static VTABLE: &amp;RawWakerVTable = &amp;RawWakerVTable {
    clone: |data: *const ()| RawWaker { data, vtable: VTABLE, },
    wake: |data: *const ()| EXECUTOR.borrow_mut().as_mut().expect(...).work_queue.push(data as usize),
    drop,
};</code></pre>
<p>While this solution gives inferior error messages to the <code>LocalWaker</code> approach (since it can’t panic until <code>wake</code> occurs on the wrong thread, rather than panicking when <code>LocalWaker</code> is transformed into a <code>Waker</code>), it dramatically simplifies the user-facing API by de-duplicating the <code>LocalWaker</code> and <code>Waker</code> types.</p>
<p>In practice, it’s also likely that the most common executors in the Rust ecosystem will continue to be multithreaded-compatible (as they are today), so optimizing for the ergonomics of this case is prioritized over better error messages in the more heavily specialized case.</p>
<h2 id="prior-art"><a class="header" href="#prior-art">Prior art</a></h2>
<p>There is substantial prior art both with async/await notation and with futures (aka promises) as a basis. The proposed futures API was influenced by Scala’s futures in particular, and is broadly similar to APIs in a variety of other languages (in terms of the adapters provided).</p>
<p>What’s more unique about the model in this RFC is the use of tasks, rather than callbacks. The RFC author is not aware of other <em>futures</em> libraries using this technique, but it is a fairly well-known technique more generally in functional programming. For a recent example, see <a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2011/01/monad-par.pdf">this paper</a> on parallelism in Haskell. What seems to be perhaps new with this RFC is the idea of melding the “trampoline” technique with an explicit, open-ended task/wakeup model.</p>
<h2 id="未解決的問題"><a class="header" href="#未解決的問題">未解決的問題</a></h2>
<p>None at the moment.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="2591-exhaustive-integer-pattern-matching.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="2603-rust-symbol-name-mangling-v0.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="2591-exhaustive-integer-pattern-matching.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="2603-rust-symbol-name-mangling-v0.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
