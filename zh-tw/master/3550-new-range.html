<!DOCTYPE HTML>
<html lang="zh_TW" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>3550-new-range - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-c5bb60c5.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Feature Name: <code>new_range</code></li>
<li>Start Date: 2023-12-18</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/3550">rust-lang/rfcs#3550</a></li>
<li>Tracking Issue: <a href="https://github.com/rust-lang/rust/issues/123741">rust-lang/rust#123741</a></li>
</ul>
<h2 id="摘要"><a class="header" href="#摘要">摘要</a></h2>
<p>Change the range operators <code>a..b</code>, <code>a..</code>, and <code>a..=b</code> to resolve to new types <code>std::range::Range</code>, <code>std::range::RangeFrom</code>, and <code>std::range::RangeInclusive</code> in Edition 2024. These new types will not implement <code>Iterator</code>, instead implementing <code>Copy</code> and <code>IntoIterator</code>.</p>
<h2 id="動機"><a class="header" href="#動機">動機</a></h2>
<p>The current iterable range types (<a href="https://doc.rust-lang.org/stable/core/ops/struct.Range.html"><code>Range</code></a>, <a href="https://doc.rust-lang.org/stable/core/ops/struct.RangeFrom.html"><code>RangeFrom</code></a>, <a href="https://doc.rust-lang.org/stable/core/ops/struct.RangeInclusive.html"><code>RangeInclusive</code></a>) implement <code>Iterator</code> directly. This is now widely considered to be a mistake, because it makes implementing <code>Copy</code> for those types hazardous due to how the two traits interact.</p>
<pre><code class="language-rust">for x in it.take(3) {  // a *copy* of the iterator is used here
    // ..
}

match it.next() {  // the original iterator (not advanced) is used here
    // ..
}</code></pre>
<p>However, there is considerable demand for <code>Copy</code> range types for multiple reasons:</p>
<ul>
<li>ergonomic use without needing explicit <code>.clone()</code>s or rewriting the <code>a..b</code> syntax repeatedly</li>
<li>use in <code>Copy</code> types (currently people work around this by using a tuple instead)</li>
</ul>
<p>Another primary motivation is the extra size of <code>RangeInclusive</code>. It uses an extra <code>bool</code> field to keep track of when the upper bound has been yielded by the iterator, but this extra size is useless when the type is not used as an iterator.</p>
<h2 id="guide-level-explanation"><a class="header" href="#guide-level-explanation">Guide-level explanation</a></h2>
<p>Rust has several different types of “range” syntax, including the following:</p>
<ul>
<li>
<p><code>a..b</code> denotes a range from <code>a</code> (inclusive) to <code>b</code> (exclusive). It resolves to the type <code>std::range::Range</code>. The iterator for <code>Range</code> will yield values from <code>a</code> (inclusive) to <code>b</code> (exclusive) in steps of one.</p>
</li>
<li>
<p><code>a..=b</code> denotes a range from <code>a</code> (inclusive) to <code>b</code> (inclusive). It resolve to the type <code>std::range::RangeInclusive</code>. The iterator for <code>RangeInclusive</code> will yield values from <code>a</code> (inclusive) to <code>b</code> (inclusive) in steps of one.</p>
</li>
<li>
<p><code>a..</code> denotes a range from <code>a</code> (inclusive) with no upper bound. It resolves to the type <code>std::range::RangeFrom</code>. The iterator for <code>RangeFrom</code> will yield values starting with <code>a</code> and increasing in steps of one.</p>
</li>
</ul>
<p>These types implement the <code>IntoIterator</code> trait, enabling their use directly in a <code>for</code> loop:</p>
<pre><code class="language-rust">for n in 0..5 {
    // `n` = 0, 1, 2, 3, 4
}</code></pre>
<p>All range types are <code>Copy</code> when the bounds are <code>Copy</code>, allowing easy reuse:</p>
<pre><code class="language-rust">let range = 0..5;

if a_slice[range].contains(x) {
    // ...
}
if b_slice[range].contains(y) {
    // ...
}</code></pre>
<p>For convenience, several commonly-used methods from <code>Iterator</code> are present as inherent functions on the range types:</p>
<pre><code class="language-rust">for n in (1..).map(|x| x * 2) {
    // n = 2, 4, 6, 8, 10, ...
}
for n in (0..5).rev() {
    // n = 4, 3, 2, 1, 0
}</code></pre>
<h3 id="legacy-range-types"><a class="header" href="#legacy-range-types">Legacy Range Types</a></h3>
<p>In Rust editions prior to 2024, <code>a..b</code>, <code>a..=b</code>, and <code>a..</code> resolved to a different set of types (now found in <code>std::range::legacy</code>). These legacy range types did not implement <code>Copy</code>, and implemented <code>Iterator</code> directly (rather than <code>IntoIterator</code>).</p>
<p>This meant that any <code>Iterator</code> method could be called on those range types:</p>
<pre><code class="language-rust">let mut range = 0..5;
assert_eq!(range.next(), Some(0));
range.for_each(|n| {
    // n = 1, 2, 3, 4
});</code></pre>
<p>There exist <code>From</code> impls for converting from the new range types to the legacy range types.</p>
<h4 id="migrating"><a class="header" href="#migrating">Migrating</a></h4>
<p>In many cases, no changes need to be made at all. This includes most places where a <code>RangeBounds</code> or <code>IntoIterator</code> is expected:</p>
<pre><code class="language-rust">pub fn takes_range(range: impl std::ops::RangeBounds&lt;usize&gt;) { ... }
takes_range(0..5); // No changes necessary

pub fn takes_iter(range: impl IntoIterator&lt;usize&gt;) { ... }
takes_iter(0..5); // No changes necessary</code></pre>
<p>And most places where <code>Iterator</code> methods were used directly on the range:</p>
<pre><code class="language-rust">for n in (0..5).rev() { ... } // No changes necessary
for n in (0..5).map(|x| x * 2) { ... } // No changes necessary</code></pre>
<p>In other cases, <code>cargo fix --edition</code> will insert <code>.into_iter()</code> as necessary:</p>
<pre><code class="language-rust">pub fn takes_iter(range: impl Iterator&lt;usize&gt;) { ... }
takes_iter((0..5).into_iter()); // Add `.into_iter()`

// Before
(0..5).for_each(...);
// After
(0..5).into_iter().for_each(...); // Add `.into_iter()`

// Before
let mut range = 0..5;
assert_eq!(range.next(), Some(0));
range.for_each(|n| {
    // n = 1, 2, 3, 4
});
// After
let mut range = (0..5).into_iter();
assert_eq!(range.next(), Some(0));
range.for_each(|n| {
    // n = 1, 2, 3, 4
});</code></pre>
<p>Or fall back to converting to the legacy types:</p>
<pre><code class="language-rust">// Before
pub fn takes_range(range: std::ops::Range&lt;usize&gt;) { ... }
takes_range(0..5);
// After
pub fn takes_range(range: std::range::legacy::Range&lt;usize&gt;) { ... }
takes_range((0..5).into());</code></pre>
<h3 id="migrating-libraries"><a class="header" href="#migrating-libraries">Migrating Libraries</a></h3>
<p>Some libraries have range types in their public interface. To use the new range types with such a library, users will need to add explicit conversions.</p>
<p>To reduce the burden of explicit conversions, libraries should make the following backwards-compatible changes:</p>
<ul>
<li>Change any function parameters from legacy <code>Range*</code> types to <code>impl Into&lt;Range*&gt;</code> Or if applicable, <code>impl RangeBounds&lt;_&gt;</code></li>
</ul>
<pre><code class="language-rust">// Before
pub fn takes_range(range: std::ops::Range&lt;usize&gt;) { ... }

// After
pub fn takes_range(range: impl Into&lt;std::range::legacy::Range&lt;usize&gt;&gt;) { ... }
// Or
pub fn takes_range(range: impl std::ops::RangeBounds&lt;usize&gt;) { ... }</code></pre>
<ul>
<li>Change any trait bounds that assume <code>Range*: Iterator</code> to use <code>IntoIterator</code> instead This is fully backwards-compatible, thanks to the <a href="https://doc.rust-lang.org/stable/std/iter/trait.IntoIterator.html#impl-IntoIterator-for-I">blanket <code>impl&lt;I: Iterator&gt; IntoIterator for I</code></a></li>
</ul>
<pre><code class="language-rust">pub struct Wrapper&lt;T&gt; {
    range: Range&lt;T&gt;
};

// Before
impl&lt;T&gt; IntoIterator for Wrapper&lt;T&gt;
where Range&lt;T&gt;: Iterator
{
    type Item = &lt;Range&lt;T&gt; as Iterator&gt;::Item;
    type IntoIter = Range&lt;T&gt;;

    fn into_iter(self) -&gt; Self::IntoIter {
        self.range
    }
}
// After
impl&lt;T&gt; IntoIterator for Wrapper&lt;T&gt;
where Range&lt;T&gt;: IntoIterator
{
    type Item = &lt;Range&lt;T&gt; as IntoIterator&gt;::Item;
    type IntoIter = &lt;Range&lt;T&gt; as IntoIterator&gt;::IntoIter;

    fn into_iter(self) -&gt; Self::IntoIter {
        self.range.into_iter()
    }
}</code></pre>
<ul>
<li>When your library implements a trait involving ranges, such as <code>std::ops::Index</code>, add impls for the new range types</li>
</ul>
<pre><code class="language-rust">// Before
use std::ops::{Index, Range};
impl Index&lt;Range&lt;usize&gt;&gt; for Bar { ... }

// After
use std::ops::{Index, Range};
impl Index&lt;Range&lt;usize&gt;&gt; for Bar { ... }
impl Index&lt;std::range::Range&lt;usize&gt;&gt; for Bar { ... }</code></pre>
<p><strong>Note</strong></p>
<ul>
<li>These changes to libraries should happen when <em>users</em> of a given library transition to the new edition</li>
<li>These changes do not require the library itself to transition to the new edition</li>
</ul>
<h3 id="diagnostics"><a class="header" href="#diagnostics">Diagnostics</a></h3>
<p>There is a substantial amount of educational material in the wild which assumes the range types implement <code>Iterator</code>. If a user references this outdated material, it is important that compiler errors guide them to the new solution.</p>
<pre><code>error[E0599]: `Range&lt;usize&gt;` is not an iterator
 --&gt; src/main.rs:4:7
  |
4 |     a.sum()
  |       ^^^ `Range&lt;usize&gt;` is not an iterator
  |
  = note: the Edition 2024 range types implement `IntoIterator`, not `Iterator`
  = help: convert to an iterator first: `a.into_iter().sum()`
  = note: the following trait bounds were not satisfied:
          `Range&lt;usize&gt;: Iterator`
</code></pre>
<h2 id="reference-level-explanation"><a class="header" href="#reference-level-explanation">Reference-level explanation</a></h2>
<p><strong>Note:</strong> The exact names and module paths in this RFC are for demonstration purposes only, and can be finalized by <em>T-libs-api</em> after the proposal is accepted.</p>
<p>Add replacement types only for the current <code>Range</code>, <code>RangeFrom</code>, and <code>RangeInclusive</code>.</p>
<p>The <a href="https://doc.rust-lang.org/reference/expressions/range-expr.html"><strong>Range Expressions</strong> page in the Reference</a> will change to read as follows</p>
<blockquote>
<h3 id="edition-2024-and-later"><a class="header" href="#edition-2024-and-later">Edition 2024 and later</a></h3>
<p>The <code>..</code> and <code>..=</code> operators will construct an object of one of the <code>std::range::Range</code> (or <code>core::range::Range</code>) variants, according to the following table:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Production</th><th>Syntax</th><th>Type</th><th>Range</th></tr>
</thead>
<tbody>
<tr><td><em>RangeExpr</em></td><td>start<code>..</code>end</td><td>std::range::Range</td><td>start ≤ x &lt; end</td></tr>
<tr><td><em>RangeFromExpr</em></td><td>start<code>..</code></td><td>std::range::RangeFrom</td><td>start ≤ x</td></tr>
<tr><td><em>RangeToExpr</em></td><td><code>..</code>end</td><td>std::range::RangeTo</td><td>x &lt; end</td></tr>
<tr><td><em>RangeFullExpr</em></td><td><code>..</code></td><td>std::range::RangeFull</td><td>-</td></tr>
<tr><td><em>RangeInclusiveExpr</em></td><td>start<code>..=</code>end</td><td>std::range::RangeInclusive</td><td>start ≤ x ≤ end</td></tr>
<tr><td><em>RangeToInclusiveExpr</em></td><td><code>..=</code>end</td><td>std::range::RangeToInclusive</td><td>x ≤ end</td></tr>
</tbody>
</table>
</div>
<p><strong>Note:</strong> While <code>std::ops::RangeTo</code>, <code>std::ops::RangeFull</code>, and <code>std::ops::RangeToInclusive</code> are re-exports of <code>std::range::RangeTo</code>, <code>std::range::RangeFull</code>, and <code>std::ops::Range::RangeToInclusive</code> respectively, <code>std::ops::Range</code>, <code>std::ops::RangeFrom</code>, and <code>std::ops::RangeInclusive</code> are re-exports of the types under <code>std::range::legacy::</code> (NOT those directly under <code>std::range::</code>) for backwards-compatibility reasons.</p>
<p>Examples:</p>
<pre><code class="language-rust">1..2;   // std::range::Range
3..;    // std::range::RangeFrom
..4;    // std::range::RangeTo
..;     // std::range::RangeFull
5..=6;  // std::range::RangeInclusive
..=7;   // std::range::RangeToInclusive</code></pre>
<p>The following expressions are equivalent.</p>
<pre><code class="language-rust">let x = std::range::Range {start: 0, end: 10};
let y = 0..10;

assert_eq!(x, y);</code></pre>
<h3 id="prior-to-edition-2024"><a class="header" href="#prior-to-edition-2024">Prior to Edition 2024</a></h3>
<p>The <code>..</code> and <code>..=</code> operators will construct an object of one of the <code>std::range::legacy::Range</code> (or <code>core::range::legacy::Range</code>) variants, according to the following table:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Production</th><th>Syntax</th><th>Type</th><th>Range</th></tr>
</thead>
<tbody>
<tr><td><em>RangeExpr</em></td><td>start<code>..</code>end</td><td>std::range::legacy::Range</td><td>start ≤ x &lt; end</td></tr>
<tr><td><em>RangeFromExpr</em></td><td>start<code>..</code></td><td>std::range::legacy::RangeFrom</td><td>start ≤ x</td></tr>
<tr><td><em>RangeToExpr</em></td><td><code>..</code>end</td><td>std::range::RangeTo</td><td>x &lt; end</td></tr>
<tr><td><em>RangeFullExpr</em></td><td><code>..</code></td><td>std::range::RangeFull</td><td>-</td></tr>
<tr><td><em>RangeInclusiveExpr</em></td><td>start<code>..=</code>end</td><td>std::range::legacy::RangeInclusive</td><td>start ≤ x ≤ end</td></tr>
<tr><td><em>RangeToInclusiveExpr</em></td><td><code>..=</code>end</td><td>std::range::RangeToInclusive</td><td>x ≤ end</td></tr>
</tbody>
</table>
</div>
<p><strong>Note:</strong> <code>std::ops::Range</code>, <code>std::ops::RangeFrom</code>, and <code>std::ops::RangeInclusive</code> are re-exports of the respective types under <code>std::range::legacy::</code>. <code>std::ops::RangeTo</code>, <code>std::ops::RangeFull</code>, and <code>std::ops::RangeToInclusive</code> are re-exports of the respective types under <code>std::range::</code>.</p>
<p>Examples:</p>
<pre><code class="language-rust">1..2;   // std::range::legacy::Range
3..;    // std::range::legacy::RangeFrom
..4;    // std::range::RangeTo
..;     // std::range::RangeFull
5..=6;  // std::range::legacy::RangeInclusive
..=7;   // std::range::RangeToInclusive</code></pre>
<p>The following expressions are equivalent.</p>
<pre><code class="language-rust">let x = std::range::legacy::Range {start: 0, end: 10};
let y = std::ops::Range {start: 0, end: 10};
let z = 0..10;

assert_eq!(x, y);
assert_eq!(x, z);</code></pre>
</blockquote>
<h3 id="new-paths"><a class="header" href="#new-paths">New paths</a></h3>
<p>There is no language support for edition-dependent path resolution, so these types must continue to be accessible under their current paths. However, their canonical paths will change to live under <code>std::range::legacy</code>:</p>
<ul>
<li><code>std::ops::Range</code> will be a re-export of <code>std::range::legacy::Range</code></li>
<li><code>std::ops::RangeFrom</code> will be a re-export of <code>std::range::legacy::RangeFrom</code></li>
<li><code>std::ops::RangeInclusive</code> will be a re-export of <code>std::range::legacy::RangeFrom</code></li>
</ul>
<p>In order to not break existing links to the documentation for these types, the re-exports must remain <code>doc(inline)</code>.</p>
<p>The replacement types will live under <code>range</code>:</p>
<ul>
<li><code>std::range::Range</code> will be the Edition 2024 replacement for <code>std::range::legacy::Range</code></li>
<li><code>std::range::RangeFrom</code> will be the Edition 2024 replacement for <code>std::range::legacy::RangeFrom</code></li>
<li><code>std::range::RangeInclusive</code> will be the Edition 2024 replacement for <code>std::range::legacy::RangeFrom</code></li>
</ul>
<p>The <code>RangeFull</code>, <code>RangeTo</code>, and <code>RangeToInclusive</code> types will remain unchanged. But for consistency, their canonical paths will be changed to live under <code>range</code>:</p>
<ul>
<li><code>std::ops::RangeFull</code> will be a re-export of <code>std::range::RangeFull</code></li>
<li><code>std::ops::RangeTo</code> will be a re-export of <code>std::range::RangeTo</code></li>
<li><code>std::ops::RangeToInclusive</code> will be a re-export of <code>std::range::RangeToInclusive</code></li>
</ul>
<h3 id="iterator-types"><a class="header" href="#iterator-types">Iterator types</a></h3>
<p>Because the three new types will implement <code>IntoIterator</code> directly, they need three new respective <code>IntoIter</code> types:</p>
<ul>
<li><code>std::range::IterRange</code> will be <code>&lt;range::Range&lt;_&gt; as IntoIterator&gt;::IntoIter</code></li>
<li><code>std::range::IterRangeFrom</code> will be <code>&lt;range::RangeFrom&lt;_&gt; as IntoIterator&gt;::IntoIter</code></li>
<li><code>std::range::IterRangeInclusive</code> will be <code>&lt;range::RangeInclusive&lt;_&gt; as IntoIterator&gt;::IntoIter</code></li>
</ul>
<p>These iterator types will implement the same iterator traits (<code>DoubleEndedIterator</code>, <code>FusedIterator</code>, etc) as the legacy range types, with the following exceptions:</p>
<ul>
<li><code>std::range::IterRange</code> will not implement <code>ExactSizeIterator</code> for <code>u32</code> or <code>i32</code></li>
<li><code>std::range::IterRangeInclusive</code> will not implement <code>ExactSizeIterator</code> for <code>u16</code> or <code>i16</code></li>
</ul>
<p>Those <code>ExactSizeIterator</code> impls on the legacy range types are <a href="https://github.com/rust-lang/rust/blob/495203bf61efabecc2c460be38e1eb0f9952601b/library/core/src/iter/range.rs#L903-L936">known to be incorrect</a>.</p>
<p>These iterator types should each feature an associated function for getting the remaining range back:</p>
<pre><code class="language-rust">impl&lt;Idx&gt; IterRange&lt;Idx&gt; {
    pub fn remainder(self) -&gt; Range&lt;Idx&gt;;
}
impl&lt;Idx&gt; IterRangeFrom&lt;Idx&gt; {
    pub fn remainder(self) -&gt; RangeFrom&lt;Idx&gt;;
}
impl&lt;Idx&gt; IterRangeInclusive&lt;Idx&gt; {
    // `None` if the iterator was exhausted
    pub fn remainder(self) -&gt; Option&lt;RangeInclusive&lt;Idx&gt;&gt;;
}</code></pre>
<h3 id="changed-structure-and-api"><a class="header" href="#changed-structure-and-api">Changed structure and API</a></h3>
<p><code>std::range::Range</code> and <code>std::range::RangeFrom</code> will have identical structure to the existing types, with public fields for the bounds. However, <code>std::range::RangeInclusive</code> will be changed:</p>
<ul>
<li><code>start</code> and <code>end</code> will be changed to public fields</li>
<li><code>exhausted</code> field will be removed entirely</li>
</ul>
<p>This makes the new <code>RangeInclusive</code> the same size as <code>Range</code>.</p>
<p>All three new types will have the same trait implementations as the legacy types, with the following exceptions:</p>
<ul>
<li>NOT implement <code>Iterator</code></li>
<li>implement <code>IntoIterator</code> directly (when <code>Idx: Step</code>)</li>
<li>implement <code>Copy</code> (when <code>Idx: Copy</code>)</li>
</ul>
<p>The following conversions between the new and legacy types will be implemented:</p>
<pre><code class="language-rust">impl&lt;Idx&gt; From&lt;range::Range&lt;Idx&gt;&gt; for range::legacy::Range&lt;Idx&gt;
impl&lt;Idx&gt; From&lt;range::RangeFrom&lt;Idx&gt;&gt; for range::legacy::RangeFrom&lt;Idx&gt;
impl&lt;Idx&gt; From&lt;range::RangeInclusive&lt;Idx&gt;&gt; for range::legacy::RangeInclusive&lt;Idx&gt;

impl&lt;Idx&gt; From&lt;range::legacy::Range&lt;Idx&gt;&gt; for range::Range&lt;Idx&gt;
impl&lt;Idx&gt; From&lt;range::legacy::RangeFrom&lt;Idx&gt;&gt; for range::RangeFrom&lt;Idx&gt;
// Fallible because legacy RangeInclusive can be exhausted
impl&lt;Idx&gt; TryFrom&lt;range::legacy::RangeInclusive&lt;Idx&gt;&gt; for range::RangeInclusive&lt;Idx&gt;</code></pre>
<p>The new types should have inherent methods to match the most common usages of <code>Iterator</code> methods. <code>map</code> and <code>rev</code> are the bare minimum; we leave the exact set to be finalized by <em>T-libs-api</em> after the proposal is accepted.</p>
<pre><code class="language-rust">impl&lt;Idx&gt; Range&lt;Idx&gt; {
    /// Shorthand for `.into_iter().map(...)`
    pub fn map&lt;B, F&gt;(self, f: F) -&gt; iter::Map&lt;&lt;Self as IntoIterator&gt;::IntoIter, F&gt;
    where
        Self: IntoIterator,
        F: FnMut(Idx) -&gt; B,
    {
        self.into_iter().map(f)
    }

    /// Shorthand for `.into_iter().rev()`
    pub fn rev(self) -&gt; iter::Rev&lt;&lt;Self as IntoIterator&gt;::IntoIter&gt;
    where
        Self: IntoIterator,
        &lt;Self as IntoIterator&gt;::IntoIter: DoubleEndedIterator,
    {
        self.into_iter().rev()
    }
}</code></pre>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<p>This change has the potential to cause a significant amount of churn in the ecosystem. There are two main sources of churn:</p>
<ul>
<li>where ranges are assumed to be <code>Iterator</code></li>
<li>trait impls involving ranges, such as <code>Index&lt;legacy::Range&lt;_&gt;&gt;</code></li>
</ul>
<p>Changes will be required to support the new range types, even on older editions. See the <a href="#migrating">migrating section</a> for specifics.</p>
<h3 id="ranges-assumed-to-be-iterator"><a class="header" href="#ranges-assumed-to-be-iterator">Ranges assumed to be <code>Iterator</code></a></h3>
<p>This is not uncommon in the ecosystem. For instance, both <a href="https://github.com/pitaj/rustc-rayon/commit/e76e554512ce25abb48f4118576ede5d7a457918"><code>rustc-rayon</code></a> and <a href="https://github.com/pitaj/quote/commit/44feebf0594b255a511ff20890a7acbf4d6aeed1"><code>quote</code></a> needed patches for this during experimentation.</p>
<h3 id="impl-indexrange_-for-x"><a class="header" href="#impl-indexrange_-for-x"><code>impl Index&lt;Range&lt;_&gt;&gt; for X</code></a></h3>
<p>A <a href="https://github.com/search?type=code&amp;q=language%3Arust+NOT+is%3Afork+%28%22Index%3CRange%3C%22+OR+%22Index%3Cops%3A%3ARange%3C%22+OR+%22Index%3Cstd%3A%3Aops%3A%3ARange%3C%22+OR+%22Index%3Ccore%3A%3Aops%3A%3ARange%3C%22+OR+%22Index%3CRangeInclusive%3C%22+OR+%22Index%3Cops%3A%3ARangeInclusive%3C%22+OR+%22Index%3Cstd%3A%3Aops%3A%3ARangeInclusive%3C%22+OR+%22Index%3Ccore%3A%3Aops%3A%3ARangeInclusive%3C%22+OR+%22Index%3CRangeFrom%3C%22+OR+%22Index%3Cops%3A%3ARangeFrom%3C%22+OR+%22Index%3Cstd%3A%3Aops%3A%3ARangeFrom%3C%22+OR+%22Index%3Ccore%3A%3Aops%3A%3ARangeFrom%3C%22%29">Github search for this pattern</a> yields 784 files, almost all of which appear to be true matches. It’s hard to say how many of those are published libraries, but it does indicate that this could have a significant impact.</p>
<h3 id="mitigation"><a class="header" href="#mitigation">Mitigation</a></h3>
<p>To mitigate these drawbacks, we recommend introducing and stabilizing an MVP of the new types as soon as possible, well before Edition 2024 releases (even before the implementation of the syntax feature is complete). This will give libraries time to issue updates supporting the new range types.</p>
<p>Some users may depend on libraries that are not updated before Edition 2024. These users do not just have to accept adding explicit conversions to their code. They also have the option to stay on a prior edition.</p>
<h2 id="rationale-and-alternatives"><a class="header" href="#rationale-and-alternatives">Rationale and alternatives</a></h2>
<h3 id="just-implement-copy-on-the-types-as-is"><a class="header" href="#just-implement-copy-on-the-types-as-is">Just implement <code>Copy</code> on the types as-is</a></h3>
<p><code>Copy</code> iterators are a large footgun. It was decided to <a href="https://github.com/rust-lang/rust/pull/21809">remove <code>Copy</code> from all iterators back in 2015</a>, and that decision is unlikely to be reversed.</p>
<p>That said, there are a few possibilities:</p>
<ul>
<li>Sophisticated lint to catch when an iterator is problematically copied</li>
<li>Language or library feature to allow <code>Copy</code> structs to have certain non-<code>Copy</code> fields</li>
<li>Specialize <code>IntoIterator</code> on these range types and lint whenever the <code>Iterator</code> impl is used</li>
</ul>
<p>None of these approaches would resolve the following serious issues:</p>
<ul>
<li><code>RangeInclusive</code> being larger than necessary for range purposes</li>
<li>Incorrect <code>ExactSizeIterator</code> implementations</li>
</ul>
<h3 id="name-the-new-types-something-besides-range"><a class="header" href="#name-the-new-types-something-besides-range">Name the new types something besides <code>Range</code></a></h3>
<p>We could choose to introduce these new types with a name other than <code>Range</code>. Some alternatives that have been proposed:</p>
<ul>
<li>Interval</li>
<li>Span</li>
<li>Bounds</li>
</ul>
<p>We believe that it is best to keep the <code>Range</code> naming for several reasons:</p>
<ul>
<li>Existing <code>Range*</code> types that implement <code>Copy</code> and not <code>Iterator</code> that won’t be touched by this change</li>
<li>Large amount of legacy educational material and code using the <code>Range</code> naming</li>
<li>It’s best to match the name of the syntax (<a href="https://doc.rust-lang.org/reference/expressions/range-expr.html">“range expressions”</a>)</li>
</ul>
<h3 id="use-legacy-range-types-as-the-iterators-for-the-new-range-types"><a class="header" href="#use-legacy-range-types-as-the-iterators-for-the-new-range-types">Use legacy range types as the iterators for the new range types</a></h3>
<p>We could choose to make <code>new_range.into_iter()</code> resolve to a legacy range type. This would reduce the number of new types we need to add to the standard library.</p>
<p>But the legacy range types have a much larger API surface than other <code>Iterator</code>s in the standard library, which typically only implement the various iterator traits and maybe have a <code>remainder</code> method. Specifically, there are no iterator types in the standard library which have public fields. Nor do any implement <code>PartialEq</code>, <code>Eq</code>, <code>Hash</code>, <code>Index</code>, or <code>IndexMut</code>.</p>
<p><code>RangeInclusive</code> especially must take care with equality, hashing, and indexing because it can be exhausted. By removing those impls from the iterator for it, we can prevent that misuse entirely.</p>
<p>One of the strongest arguments for new types is the incorrect <code>ExactSizeIterator</code> implementations for <code>Range&lt;u32 | i32&gt;</code> and <code>RangeInclusive&lt;u16 | i16&gt;</code>. These can be excluded if new iterator types are introduced.</p>
<p>Finally, the cost of adding these iterator types is extremely low, given we’re already adding a set of new types for the ranges themselves.</p>
<h3 id="inherent-map-should-map-the-bounds-not-return-an-iterator"><a class="header" href="#inherent-map-should-map-the-bounds-not-return-an-iterator">Inherent <code>map</code> should map the bounds, not return an iterator</a></h3>
<p>Some argue that inherent <code>map</code> should not return an iterator. Some say that they may expect it to map each bound individually (<code>(1..11).map(|x| x*2)</code> -&gt; <code>2..22</code>). Others say these methods should return <code>IntoIterator</code> types instead.</p>
<p>However, making them return an iterator has many benefits:</p>
<ul>
<li>Matches existing behavior</li>
<li>Reduces code churn</li>
<li>Act as an entry point for other iterator methods</li>
</ul>
<p>Adding these convenience methods is unlikely to cause confusion because of how common this pattern already is (if anything, the opposite is true). Plus, it’s pretty easy to tell based on the function signature what is going on, and it’s simple to document.</p>
<p>Changing the meaning of <code>(1..11).map(...)</code> is a huge hazard. There is a lot of existing code, documentation, etc that uses it in the <code>Iterator</code> sense. It would be incredibly confusing, especially to a newcomer, to have it do something totally different between editions. Especially since in many cases it could silently change meaning:</p>
<pre><code class="language-rust">// Edition 2021
for n in (1..11).map(|n| n*2) {
    // n = 2, 4, 6, ...., 16, 18, 20
}
// Edition 2024?
for n in (1..11).map(|n| n*2) {
    // n = 2, 3, 4, 5, 6, 7, ...., 15, 16, 17, 18, 19, 20, 21
}</code></pre>
<p>If there is demand for a method that maps the bounds, it should be added under a different name, such as <code>map_bounds</code> , perhaps even as a method on <code>RangeBounds</code>.</p>
<h3 id="implicit-conversions-coercions"><a class="header" href="#implicit-conversions-coercions">Implicit conversions (coercions)</a></h3>
<p>This proposal specifically avoids involving any form of implicit conversion. Adding coercions from the new to legacy types would have a few benefits:</p>
<ul>
<li>Avoid explicit conversions when migrating automatically to Edition 2024</li>
<li>Few (if any) library changes needed to support the new types</li>
</ul>
<p>Coercions would effectively eliminate the main drawback of this RFC. However, adding implicit conversions has severe drawbacks of its own:</p>
<ul>
<li>Makes it harder to reason about code</li>
<li>Further blurs the line between language and library</li>
<li>Affects type inference</li>
</ul>
<p>In this specific case, the coercion would also need to be considered during trait resolution to be significantly useful, which is not currently done in other cases like deref coercion.</p>
<h4 id="range-literal"><a class="header" href="#range-literal">Range literal</a></h4>
<p>We could treat range expressions as a kind of literal, and only “coerce” them into the legacy range types at the point of the range syntax. Similar to integer literals, the concrete type would be chosen based on context, like how <code>4</code> can be used anywhere expecting any integer type.</p>
<p>This would have fewer serious downsides than coercions, but both approaches add a large cost for implementation in the compiler.</p>
<p>We don’t consider the downsides of either approach to be justified given the relative rarity of libraries needing changes in the first place, the ease of adding explicit conversions when necessary, and the option for users to continue to use prior editions while waiting for library support.</p>
<h2 id="prior-art"><a class="header" href="#prior-art">Prior art</a></h2>
<p>The <a href="https://docs.rs/copy-range">copy-range</a> crate provides types similar to those proposed here.</p>
<h2 id="未解決的問題"><a class="header" href="#未解決的問題">未解決的問題</a></h2>
<h3 id="ecosystem-disruption"><a class="header" href="#ecosystem-disruption">Ecosystem Disruption</a></h3>
<p>We must take into account the ecosystem impact of this change before stabilization.</p>
<ul>
<li>How do we properly document and execute the ecosystem transition?</li>
<li>How much time will it take to propagate this change throughout the ecosystem?</li>
<li>What degree of ecosystem saturation would we be satisfied with?</li>
<li>How much time do we need with stable library types before making the lang change?</li>
<li>What about libraries that wish to maintain a certain MSRV?</li>
<li>Taking into account all of the mitigations (diagnostics, migrations, and lints but NOT language-level changes), is the level of ecosystem disruption acceptable?</li>
<li>What is expected of new libraries? Should they continue to support both sets of ranges or only the new ones?</li>
<li>Will new Rust users need to learn about older editions because of downstream users of their code?</li>
</ul>
<h3 id="api"><a class="header" href="#api">API</a></h3>
<p>We leave the following items to be decided by the <strong>libs-api</strong> team after this proposal is accepted and before stabilization:</p>
<ul>
<li>The set of inherent methods copied from <code>Iterator</code> present on the new range types</li>
<li>The exact module paths and type names
<ul>
<li>Should the new types live at <code>std::ops::range::</code> instead?</li>
<li><code>IterRange</code>, <code>IterRangeInclusive</code> or just <code>Iter</code>, <code>IterInclusive</code>? Or <code>RangeIter</code>, <code>RangeInclusiveIter</code>, …?</li>
</ul>
</li>
<li>Should other range-related items (like <code>RangeBounds</code>) also be moved under the <code>range</code> module?</li>
<li>Should <code>RangeFrom</code> even implement <code>IntoIterator</code>, or should it require an explicit <code>.iter()</code> call? Using it as an iterator <a href="https://github.com/rust-lang/libs-team/issues/304">can be a footgun</a>, usually people want <code>start..=MAX</code> instead. Also, it is inconsistent with <code>RangeTo</code>, which doesn’t implement <code>IntoIterator</code> either.</li>
<li>Should there be a way to get an iterator that modifies the range in place, rather than taking the range by value? That would allow things like <code>range.by_ref().next()</code>.</li>
<li>Should there be an infallible conversion from legacy to new <code>RangeInclusive</code>?</li>
</ul>
<pre><code class="language-rust">impl&lt;Idx&gt; From&lt;legacy::RangeInclusive&lt;Idx&gt;&gt; for RangeInclusive&lt;Idx&gt; {
    // How do we handle the `exhausted` case, set `end &lt; start`?
}</code></pre>
<h2 id="future-possibilities"><a class="header" href="#future-possibilities">Future possibilities</a></h2>
<ul>
<li>Hide or deprecate range-related items directly under <code>ops</code> (without breaking existing links or triggering deprecation warnings on previous editions).</li>
<li><code>RangeTo(Inclusive)::rev()</code> that returns an iterator?</li>
<li><code>IterRangeInclusive</code> can be optimized to take advantage of the case where the bounds don’t occupy the full domain of the index type:</li>
</ul>
<pre><code class="language-rust">enum IterRangeInclusiveImpl&lt;Idx&gt; {
    // Used when `end &lt; Idx::MAX`
    // Works like `start..(end + 1)`
    Exclusive { start: Idx, end: Idx },
    // Used when `end == Idx::MAX &amp;&amp; start &gt; Idx::MIN`
    // Works like `((start - 1)..end).map(|i| i + 1)`
    ExclusiveOffset { start: Idx, end: Idx },
    // Only used when `start == Idx::MIN` and `end == Idx::MAX`
    // Works like `start..=end` does now
    // No need for `exhausted` flag, uses `start &lt; end` instead
    Inclusive { start: Idx, end: Idx },
}

pub struct IterRangeInclusive&lt;Idx&gt; {
    inner: IterRangeInclusiveImpl&lt;Idx&gt;,
}</code></pre>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=dc5a5009cd311a86d54d258a8471cf88">playground</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="3543-patchable-function-entry.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="3558-libtest-json.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="3543-patchable-function-entry.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="3558-libtest-json.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
