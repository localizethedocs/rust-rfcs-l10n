msgid ""
msgstr ""
"Project-Id-Version: The Rust RFC Book\n"
"POT-Creation-Date: 2025-12-22T09:04:43Z\n"
"PO-Revision-Date: \n"
"Last-Translator: \n"
"Language-Team: \n"
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"

#: src/1328-global-panic-handler.md:1
msgid "Feature Name: `panic_handler`"
msgstr ""

#: src/1328-global-panic-handler.md:2
msgid "Start Date: 2015-10-08"
msgstr ""

#: src/1328-global-panic-handler.md:3
msgid ""
"RFC PR: [rust-lang/rfcs#1328](https://github.com/rust-lang/rfcs/pull/1328)"
msgstr ""

#: src/1328-global-panic-handler.md:4
msgid ""
"Rust Issue: [rust-lang/rust#30449](https://github.com/rust-lang/rust/"
"issues/30449)"
msgstr ""

#: src/1328-global-panic-handler.md:6
msgid "Summary"
msgstr ""

#: src/1328-global-panic-handler.md:8
msgid ""
"When a thread panics in Rust, the unwinding runtime currently prints a "
"message to standard error containing the panic argument as well as the "
"filename and line number corresponding to the location from which the panic "
"originated. This RFC proposes a mechanism to allow user code to replace this "
"logic with custom handlers that will run before unwinding begins."
msgstr ""

#: src/1328-global-panic-handler.md:14
msgid "Motivation"
msgstr ""

#: src/1328-global-panic-handler.md:16
msgid "The default behavior is not always ideal for all programs:"
msgstr ""

#: src/1328-global-panic-handler.md:18
msgid ""
"Programs with command line interfaces do not want their output polluted by "
"random panic messages."
msgstr ""

#: src/1328-global-panic-handler.md:20
msgid ""
"Programs using a logging framework may want panic messages to be routed into "
"that system so that they can be processed like other events."
msgstr ""

#: src/1328-global-panic-handler.md:22
msgid ""
"Programs with graphical user interfaces may not have standard error attached "
"at all and want to be notified of thread panics to potentially display an "
"internal error dialog to the user."
msgstr ""

#: src/1328-global-panic-handler.md:26
msgid ""
"The standard library [previously supported](https://doc.rust-lang.org/1.3.0/"
"std/rt/unwind/fn.register.html) (in unstable code) the registration of a set "
"of panic handlers. This API had several issues:"
msgstr ""

#: src/1328-global-panic-handler.md:31
msgid ""
"The system supported a fixed but unspecified number of handlers, and a "
"handler could never be unregistered once added."
msgstr ""

#: src/1328-global-panic-handler.md:33
msgid "The callbacks were raw function pointers rather than closures."
msgstr ""

#: src/1328-global-panic-handler.md:34
msgid ""
"Handlers would be invoked on nested panics, which would result in a stack "
"overflow if a handler itself panicked."
msgstr ""

#: src/1328-global-panic-handler.md:36
msgid ""
"The callbacks were specified to take the panic message, file name and line "
"number directly. This would prevent us from adding more functionality in the "
"future, such as access to backtrace information. In addition, the presence "
"of file names and line numbers for all panics causes some amount of binary "
"bloat and we may want to add some avenue to allow for the omission of those "
"values in the future."
msgstr ""

#: src/1328-global-panic-handler.md:43
msgid "Detailed design"
msgstr ""

#: src/1328-global-panic-handler.md:45
msgid "A new module, `std::panic`, will be created with a panic handling API:"
msgstr ""

#: src/1328-global-panic-handler.md:48
msgid ""
"/// Unregisters the current panic handler, returning it.\n"
"///\n"
"/// If no custom handler is registered, the default handler will be "
"returned.\n"
"///\n"
"/// # Panics\n"
"///\n"
"/// Panics if called from a panicking thread. Note that this will be a "
"nested\n"
"/// panic and therefore abort the process.\n"
msgstr ""

#: src/1328-global-panic-handler.md:57
msgid ""
"/// Registers a custom panic handler, replacing any that was previously\n"
"/// registered.\n"
"///\n"
"/// # Panics\n"
"///\n"
"/// Panics if called from a panicking thread. Note that this will be a "
"nested\n"
"/// panic and therefore abort the process.\n"
msgstr ""

#: src/1328-global-panic-handler.md:66
msgid "/// A struct providing information about a panic.\n"
msgstr ""

#: src/1328-global-panic-handler.md:71
msgid ""
"/// Returns the payload associated with the panic.\n"
"    ///\n"
"    /// This will commonly, but not always, be a `&'static str` or "
"`String`.\n"
msgstr ""

#: src/1328-global-panic-handler.md:76
msgid ""
"/// Returns information about the location from which the panic originated,\n"
"    /// if available.\n"
msgstr ""

#: src/1328-global-panic-handler.md:80
msgid "/// A struct containing information about the location of a panic.\n"
msgstr ""

#: src/1328-global-panic-handler.md:85
msgid ""
"/// Returns the name of the source file from which the panic originated.\n"
msgstr ""

#: src/1328-global-panic-handler.md:88
msgid "/// Returns the line number from which the panic originated.\n"
msgstr ""

#: src/1328-global-panic-handler.md:93
msgid ""
"When a panic occurs, but before unwinding begins, the runtime will call the "
"registered panic handler. After the handler returns, the runtime will then "
"unwind the thread. If a thread panics while panicking (a \"double panic\"), "
"the panic handler will _not_ be invoked and the process will abort. Note "
"that the thread is considered to be panicking while the panic handler is "
"running, so a panic originating from the panic handler will result in a "
"double panic."
msgstr ""

#: src/1328-global-panic-handler.md:100
msgid ""
"The `take_handler` method exists to allow for handlers to \"chain\" by "
"closing over the previous handler and calling into it:"
msgstr ""

#: src/1328-global-panic-handler.md:106
msgid "\"uh oh!\""
msgstr ""

#: src/1328-global-panic-handler.md:111
msgid ""
"This is obviously a racy operation, but as a single global resource, the "
"global panic handler should only be adjusted by applications rather than "
"libraries, most likely early in the startup process."
msgstr ""

#: src/1328-global-panic-handler.md:115
msgid ""
"The implementation of `set_handler` and `take_handler` will have to be "
"carefully synchronized to ensure that a handler is not replaced while "
"executing in another thread. This can be accomplished in a manner similar to "
"[that used by the `log` crate](https://github.com/rust-lang-nursery/log/blob/"
"aa8618c840dd88b27c487c9fc9571d89751583f3/src/lib.rs). `take_handler` and "
"`set_handler` will wait until no other threads are currently running the "
"panic handler, at which point they will atomically swap the handler out as "
"appropriate."
msgstr ""

#: src/1328-global-panic-handler.md:124
msgid ""
"Note that `location` will always return `Some` in the current "
"implementation. It returns an `Option` to hedge against possible future "
"changes to the panic system that would allow a crate to be compiled with "
"location metadata removed to minimize binary size."
msgstr ""

#: src/1328-global-panic-handler.md:129
msgid "Prior Art"
msgstr ""

#: src/1328-global-panic-handler.md:131
msgid ""
"C++ has a [`std::set_terminate`](http://www.cplusplus.com/reference/"
"exception/set_terminate/) function which registers a handler for uncaught "
"exceptions, returning the old one. The handler takes no arguments."
msgstr ""

#: src/1328-global-panic-handler.md:136
msgid ""
"Python passes uncaught exceptions to the global handler [`sys.excepthook`]"
"(https://docs.python.org/2/library/sys.html#sys.excepthook) which can be set "
"by user code."
msgstr ""

#: src/1328-global-panic-handler.md:140
msgid ""
"In Java, uncaught exceptions [can be handled](http://docs.oracle.com/"
"javase/7/docs/api/java/lang/Thread.html#setUncaughtExceptionHandler(java."
"lang.Thread.UncaughtExceptionHandler)) by handlers registered on an "
"individual `Thread`, by the `Thread`'s, `ThreadGroup`, and by a handler "
"registered globally. The handlers are provided with the `Throwable` that "
"triggered the handler."
msgstr ""

#: src/1328-global-panic-handler.md:146
msgid "Drawbacks"
msgstr ""

#: src/1328-global-panic-handler.md:148
msgid ""
"The more infrastructure we add to interact with panics, the more attractive "
"it becomes to use them as a more normal part of control flow."
msgstr ""

#: src/1328-global-panic-handler.md:151
msgid "Alternatives"
msgstr ""

#: src/1328-global-panic-handler.md:153
msgid ""
"Panic handlers could be run after a panicking thread has unwound rather than "
"before. This is perhaps a more intuitive arrangement, and allows "
"`catch_panic` to prevent panic handlers from running. However, running "
"handlers before unwinding allows them access to more context, for example, "
"the ability to take a stack trace."
msgstr ""

#: src/1328-global-panic-handler.md:159
msgid ""
"`PanicInfo::location` could be split into `PanicInfo::file` and `PanicInfo::"
"line` to cut down on the API size, though that would require handlers to "
"deal with weird cases like a line number but no file being available."
msgstr ""

#: src/1328-global-panic-handler.md:164
msgid ""
"[RFC 1100](https://github.com/rust-lang/rfcs/pull/1100) proposed an API "
"based around thread-local handlers. While there are reasonable use cases for "
"the registration of custom handlers on a per-thread basis, most of the "
"common uses for custom handlers want to have a single set of behavior cover "
"all threads in the process. Being forced to remember to register a handler "
"in every thread spawned in a program is tedious and error prone, and not "
"even possible in many cases for threads spawned in libraries the author has "
"no control over."
msgstr ""

#: src/1328-global-panic-handler.md:172
msgid ""
"While out of scope for this RFC, a future extension could add thread-local "
"handlers on top of the global one proposed here in a straightforward manner."
msgstr ""

#: src/1328-global-panic-handler.md:175
msgid ""
"The implementation could be simplified by altering the API to store, and "
"`take_logger` to return, an `Arc<Fn(&PanicInfo) + 'static + Sync + Send>` or "
"a bare function pointer. This seems like a somewhat weirder API, however, "
"and the implementation proposed above should not end up complex enough to "
"justify the change."
msgstr ""

#: src/1328-global-panic-handler.md:181
msgid "Unresolved questions"
msgstr ""

#: src/1328-global-panic-handler.md:183
msgid "None at the moment."
msgstr ""
