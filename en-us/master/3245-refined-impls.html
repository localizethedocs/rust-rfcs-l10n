<!DOCTYPE HTML>
<html lang="en_US" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>3245-refined-impls - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-0060737d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h2 id="refined-trait-implementations"><a class="header" href="#refined-trait-implementations">Refined trait implementations</a></h2>
<ul>
<li>Feature Name: <code>refined_impls</code></li>
<li>Start Date: 2022-03-22</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/3245">rust-lang/rfcs#3245</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/100706">rust-lang/rust#100706</a></li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>This RFC generalizes the <a href="https://rust-lang.github.io/rfcs/2316-safe-unsafe-trait-methods.html"><code>safe_unsafe_trait_methods</code> RFC</a>, allowing implementations of traits to add type information about the API of their methods and constants which then become part of the API for that type. Specifically, lifetimes and where clauses are allowed to extend beyond what the trait provides.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p><a href="https://rust-lang.github.io/rfcs/2316-safe-unsafe-trait-methods.html">RFC 2316</a> introduced the notion of <em>safe implementations</em> of unsafe trait methods. This allows code that knows it is calling a safe implementation of an unsafe trait method to do so without using an unsafe block. In other words, this works under RFC 2316, which is not yet implemented:</p>
<pre><code class="language-rust">trait Foo {
    unsafe fn foo(&amp;self);
}

struct Bar;
impl Foo for Bar {
    fn foo(&amp;self) {
        println!("No unsafe in this impl!")
    }
}

fn main() {
    // Call Bar::foo without using an unsafe block.
    let bar = Bar;
    bar.foo();
}</code></pre>
<p>Unsafe is not the only area where we allow impl signatures to be “more specific” than the trait they’re implementing. Unfortunately, we do not handle these cases consistently today:</p>
<h3 id="associated-types"><a class="header" href="#associated-types">Associated types</a></h3>
<p>Associated types are a case where an impl is <em>required</em> to be “more specific” by specifying a concrete type.</p>
<pre><code class="language-rust">struct OnlyZero;

impl Iterator for OnlyZero {
    type Item = usize;
    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
        Some(0)
    }
}</code></pre>
<p>This concrete type is fully transparent to any code that can use the impl. Calling code is allowed to rely on the fact that <code>&lt;OnlyZero as Iterator&gt;::Item = usize</code>.</p>
<pre><code class="language-rust">let mut iter = OnlyZero;
assert_eq!(0usize, iter.next().unwrap());</code></pre>
<h3 id="types-in-method-signatures"><a class="header" href="#types-in-method-signatures">Types in method signatures</a></h3>
<p>We also allow method signatures to differ from the trait they implement.</p>
<pre><code class="language-rust">trait Log {
    fn log_all(iter: impl ExactSizeIterator);
}

struct OrderedLogger;

impl Log for OrderedLogger {
    // Don't need the exact size here; any iterator will do.
    fn log_all(iter: impl Iterator) { ... }
}</code></pre>
<p><strong>Unlike with <code>unsafe</code> and associated types, however, calling code <em>cannot</em> rely on the relaxed requirements on the <code>log_all</code> method implementation.</strong></p>
<pre><code class="language-rust">fn main() {
    let odds = (1..50).filter(|n| *n % 2 == 1);
    OrderedLogger::log_all(odds)
    // ERROR:              ^^^^ the trait `ExactSizeIterator` is not implemented
}</code></pre>
<p>This is a papercut: In order to make this API available to users the <code>OrderedLogger</code> type would have to bypass the <code>Log</code> trait entirely and provide an inherent method instead. Simply changing <code>impl Log for OrderedLogger</code> to <code>impl OrderedLogger</code> in the example above is enough to make this code compile, but it would no longer implement the trait.</p>
<p>The purpose of this RFC is to fix the inconsistency in the language and add flexibility by removing this papercut. Finally, it establishes a policy to prevent such inconsistencies in the future.</p>
<h2 id="guide-level-explanation"><a class="header" href="#guide-level-explanation">Guide-level explanation</a></h2>
<p>When implementing a trait, you can use function signatures that <em>refine</em> those in the trait by being more specific. For example,</p>
<pre><code class="language-rust">trait Error {
    fn description(&amp;self) -&gt; &amp;str;
}

impl Error for MyError {
    #[refine]
    fn description(&amp;self) -&gt; &amp;'static str {
        "My Error Message"
    }
}</code></pre>
<p>Here, the error description for <code>MyError</code> does not depend on the value of <code>MyError</code>. The <code>impl</code> includes this information by adding a <code>'static</code> lifetime to the return type.</p>
<p>Code that knows it is dealing with a <code>MyError</code> can then make use of this information. For example,</p>
<pre><code class="language-rust">fn attempt_with_status() -&gt; &amp;'static str {
    match do_something() {
        Ok(_) =&gt; "Success!",
        Err(e @ MyError) =&gt; e.description(),
    }
}</code></pre>
<p>This can be useful when using impl Trait in argument or return position.<sup class="footnote-reference" id="fr-rpitit-1"><a href="#footnote-rpitit">1</a></sup></p>
<pre><code class="language-rust">trait Iterable {
    fn iter(&amp;self) -&gt; impl Iterator;
}

impl&lt;T&gt; Iterable for MyVec&lt;T&gt; {
    #[refine]
    fn iter(&amp;self) -&gt; impl Iterator + ExactSizeIterator { ... }
}</code></pre>
<p>Note that when using impl Trait in argument position, the function signature is refined as bounds are <em>removed</em>, meaning this specific impl can accept a wider range of inputs than the general case. Where clauses work the same way: since where clauses always must be proven by the caller, it is okay to remove them in an impl and permit a wider range of use cases for your API.</p>
<pre><code class="language-rust">trait Sink {
    fn consume(&amp;mut self, input: impl Iterator + ExactSizeIterator);
}

impl Sink for SimpleSink {
    #[refine]
    fn consume(&amp;mut self, input: impl Iterator) { ... }
}</code></pre>
<p>Finally, methods marked <code>unsafe</code> in traits can be refined as safe APIs, allowing code to call them without using <code>unsafe</code> blocks.</p>
<h2 id="reference-level-explanation"><a class="header" href="#reference-level-explanation">Reference-level explanation</a></h2>
<h3 id="trait-implementations"><a class="header" href="#trait-implementations">Trait implementations</a></h3>
<p>The following text should be added after <a href="https://doc.rust-lang.org/nightly/reference/items/implementations.html#trait-implementations">this paragraph</a> from the Rust reference:</p>
<blockquote>
<p>A trait implementation must define all non-default associated items declared by the implemented trait, may redefine default associated items defined by the implemented trait, and cannot define any other items.</p>
</blockquote>
<p>Each associated item defined in the implementation meet the following conditions.</p>
<p><strong>Associated consts</strong></p>
<ul>
<li>Must be a subtype of the type in the corresponding trait item.</li>
</ul>
<p><strong>Associated types</strong></p>
<ul>
<li>Associated type values must satisfy all bounds on the trait item.</li>
<li>Each where clause must be implied by the where clauses on the trait itself and/or the associated type in the trait definition, where “implied” is limited to supertrait and outlives relations. <em>This would be expanded to all <a href="https://rust-lang.github.io/rfcs/2089-implied-bounds.html">implied bounds</a> when that feature is enabled.</em></li>
</ul>
<p><strong>Associated functions</strong></p>
<ul>
<li>Must return any subtype of the return type in the trait definition.</li>
<li>Each argument must accept any supertype of the corresponding argument type in the trait definition.</li>
<li>Each where clause must be implied by the where clauses on the trait itself and/or the associated function in the trait definition, where “implied” is limited to supertrait and outlives relations. <em>This would be expanded to all <a href="https://rust-lang.github.io/rfcs/2089-implied-bounds.html">implied bounds</a> when that feature is enabled.</em></li>
<li>Must not be marked <code>unsafe</code> unless the trait definition is also marked <code>unsafe</code>.</li>
</ul>
<p>When an item in an impl meets these conditions, we say it is a <em>valid refinement</em> of the trait item.</p>
<h4 id="using-refined-implementations"><a class="header" href="#using-refined-implementations">Using refined implementations</a></h4>
<p>Refined APIs are available anywhere knowledge of the impl being used is available. If the compiler can deduce a particular impl is being used, its API as written is available for use by the caller. This includes UFCS calls like <code>&lt;MyType as Trait&gt;::foo()</code>.</p>
<h3 id="transitioning-away-from-the-current-behavior"><a class="header" href="#transitioning-away-from-the-current-behavior">Transitioning away from the current behavior</a></h3>
<p>Because we allow writing impls that look refined, but are <a href="#types-in-method-signatures">not usable</a> as such, landing this feature could mean auto-stabilizing new ecosystem API surface. We should probably be conservative and require library authors to opt in to refined APIs with a <code>#[refine]</code> attribute. This can be done in two parts.</p>
<h4 id="lint-against-unmarked-refined-impls"><a class="header" href="#lint-against-unmarked-refined-impls">Lint against unmarked refined impls</a></h4>
<p>After this RFC is merged, we should warn when a user writes an impl that looks refined and suggest that they copy the exact API of the trait they are implementing. Once this feature stabilizes, we can suggest using <code>#[refine]</code> attribute to mark that an impl is intentionally refined.</p>
<h4 id="automatic-migration-for-the-next-edition"><a class="header" href="#automatic-migration-for-the-next-edition">Automatic migration for the next edition</a></h4>
<p>We may want to upgrade the above lint to an error in 2024 or make refinement the default without any attribute at all. In either case, we should have an automatic edition migration that rewrites users’ code to preserve its semantics. That means we will replace trait implementations that look refined with the original API of the trait items being implemented.</p>
<h4 id="documentation"><a class="header" href="#documentation">Documentation</a></h4>
<p>The following can be added to the reference to document the difference in editions.</p>
<h5 id="refine-attribute"><a class="header" href="#refine-attribute"><code>#[refine]</code> attribute</a></h5>
<p>Refinements of trait items that do not match the API of the trait exactly must be accompanied by a <code>#[refine]</code> attribute on the item in Rust 2021 and older editions.<sup class="footnote-reference" id="fr-refine-edition-1"><a href="#footnote-refine-edition">2</a></sup></p>
<p>For historical reasons, we allow valid refinements on the following features in Rust 2021 and earlier without a <code>#[refine]</code> attribute. However, no refinements are available to callers without this attribute; it will be as if the trait API was copied directly.</p>
<ul>
<li>Lifetimes</li>
<li>Where clauses</li>
<li>impl Trait in argument position</li>
<li>Lifetimes</li>
<li>Where clauses</li>
</ul>
<h3 id="preventing-future-ambiguity"><a class="header" href="#preventing-future-ambiguity">Preventing future ambiguity</a></h3>
<p>This RFC establishes a policy that anytime the signature of an associated item in a trait implementation is <em>allowed to differ</em> from the signature in the trait, the information in that signature should be usable by code that uses the implementation.</p>
<p>This RFC specifically does not specify that new language features involving traits <em>should</em> allow refined impls wherever possible. The language could choose not to accept refined implementation signatures for that feature. This should be decided on a case-by-case basis for each feature.</p>
<h3 id="rfc-2316"><a class="header" href="#rfc-2316">RFC 2316</a></h3>
<p><a href="https://rust-lang.github.io/rfcs/2316-safe-unsafe-trait-methods.html">RFC 2316</a> is amended by this RFC to require <code>#[refine]</code> on safe implementations of unsafe trait methods.</p>
<h3 id="interaction-with-other-features"><a class="header" href="#interaction-with-other-features">Interaction with other features</a></h3>
<h4 id="implied-bounds"><a class="header" href="#implied-bounds">Implied bounds</a></h4>
<p>When <a href="https://rust-lang.github.io/rfcs/2089-implied-bounds.html">implied bounds</a> is stabilized, the rules for valid refinements will be modified according to the italicized text above.</p>
<h4 id="specialization"><a class="header" href="#specialization">Specialization</a></h4>
<p><a href="https://rust-lang.github.io/rfcs/1210-impl-specialization.html">Specialization</a> allows trait impls to overlap. Whenever two trait impls overlap, one must take precedence according to the rules laid out in the specialization RFC. Each item in the impl taking precedence must be a valid refinement of the corresponding item in the overlapping impl.</p>
<h4 id="generic-associated-types"><a class="header" href="#generic-associated-types">Generic associated types</a></h4>
<p>These features mostly don’t interact. However, it’s worth noting that currently generic associated types <a href="https://github.com/rust-lang/rust/issues/87479">require extra bounds</a> on the trait definition if it is likely they will be needed by implementations. This feature would allow implementations that don’t need those bounds to elide them and remove that requirement on their types’ interface.</p>
<h4 id="const-polymorphism"><a class="header" href="#const-polymorphism"><code>const</code> polymorphism</a></h4>
<p>We may want to allow implementations to add <code>const</code> to their methods. This raises the question of whether we want <em>provided</em> methods of the trait to also become <code>const</code>. For example:</p>
<pre><code class="language-rust">impl Iterator for Foo {
    const fn next(&amp;mut self) -&gt; ...
}</code></pre>
<p>Should the <code>nth</code> method also be considered <code>const fn</code>?</p>
<h4 id="method-dispatch"><a class="header" href="#method-dispatch">Method dispatch</a></h4>
<p>The <a href="https://doc.rust-lang.org/stable/reference/expressions/method-call-expr.html">method dispatch rules</a> can be confusing when there are multiple candidates with the same name but that differ in their <code>self</code> type. Refinement on <code>impl Trait</code> return types can interact with this by adding new candidates for method dispatch. See <a href="https://github.com/rust-lang/rfcs/pull/3245#issuecomment-1105959958">this comment</a> for an example.</p>
<p>Method dispatch rules can be improved in a future edition, for example by making callers disambiguate the method they want to call in these situations.</p>
<h4 id="unsatisfiable-trait-members"><a class="header" href="#unsatisfiable-trait-members">Unsatisfiable trait members</a></h4>
<p>Today we <a href="https://github.com/rust-lang/rfcs/issues/2829">require trait members with unsatisfiable <code>where</code> clauses to be implemented</a>. This leads to dropping the unsatisfiable bounds in the impl (a form of refinement) and, in some cases, relying on the property that the item can never be used. See <a href="https://github.com/rust-lang/rfcs/pull/3245#issuecomment-1120097693">this comment</a> for an example. This RFC would relax that property.</p>
<p>It should be considered a bug for any code to rely on this unusability property for correctness purposes, though a panic may be necessary in some cases.</p>
<p>We should solve this problem separately and allow implementers to omit items like this, but that is out of the scope of this RFC.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<h3 id="accidental-stabilization"><a class="header" href="#accidental-stabilization">Accidental stabilization</a></h3>
<p>For library authors, it is possible for this feature to create situations where a more refined API is <em>accidentally</em> stabilized. Before stabilizing, we will need to gain some experience with the feature to determine if it is a good idea to allow refined impls without annotations.</p>
<h3 id="complexity"><a class="header" href="#complexity">Complexity</a></h3>
<p>Overall, we argue that this RFC reduces complexity by improving the consistency and flexibility of the language. However, this RFC proposes several things that can be considered added complexity to the language:</p>
<h4 id="adding-text-to-the-rust-reference"><a class="header" href="#adding-text-to-the-rust-reference">Adding text to the Rust reference</a></h4>
<p>Part of the reason that text is being added to the reference is that the reference doesn’t specify what makes an item in a trait implementation valid. The current behavior of allowing certain kinds of divergence and “ignoring” some of them is not specified anywhere, and would probably be just as verbose to describe.</p>
<h4 id="types-are-allowed-to-have-different-apis-for-the-same-trait"><a class="header" href="#types-are-allowed-to-have-different-apis-for-the-same-trait">Types are allowed to have different APIs for the same trait</a></h4>
<p>It is possible for a user to form an impression of a trait API by seeing its use in one type, then be surprised to find that that usage does not generalize to all implementations of the trait.</p>
<p>It’s rarely obvious, however, that a <em>trait</em> API is being used at a call site as opposed to an inherent API (which can be completely different from one type to the next). The one place it is obvious is in generic functions, which will typically only have access to the original trait API.</p>
<h3 id="refactoring"><a class="header" href="#refactoring">Refactoring</a></h3>
<p>When a trait API is refined by a type, users of that type may rely on refined details of that API without realizing it. This could come as a surprise when they then try to refactor their code to be generic over that type.</p>
<p>The general form of this problem isn’t specific to refined impls. Making code generic always loses type information (which is the point) and often requires you to tweak some details about your implementation to compensate. This feature would add another place where that can happen. Using a const or method that was defined in a trait, even when that trait is in your generic bounds, may not be enough – your non-generic code may have relied on a refined aspect of that item.</p>
<p>In some situations the user may realize they are relying on too many details of the concrete type and either don’t want to make their code generic, or need to refactor it to be more general. In other situations, however, they may want to add extra bounds so their code can be generic without significant modifications.</p>
<p>This problem can be solved or mitigated with new ways of adding bounds to the refined items, but those are out of scope for this RFC and not fully designed. They are described below in <a href="#bounding-refined-items">Bounding refined items</a>.</p>
<h2 id="rationale-and-alternatives"><a class="header" href="#rationale-and-alternatives">Rationale and alternatives</a></h2>
<p>This RFC attempts to be minimal in terms of its scope while accomplishing its stated goal to improve the consistency of Rust. It aims to do so in a way that makes Rust easier to learn and easier to use.</p>
<h3 id="do-nothing"><a class="header" href="#do-nothing">Do nothing</a></h3>
<p>Doing nothing preserves the status quo, which as shown in the <a href="#motivation">Motivation</a> section, is confusing and inconsistent. Allowing users to write function signatures that aren’t actually visible to calling code violates the principle of least surprise. It would be better to begin a transition out of this state sooner than later to make future edition migrations less disruptive.</p>
<h3 id="require-implementations-to-use-exactly-the-same-api-as-the-trait"><a class="header" href="#require-implementations-to-use-exactly-the-same-api-as-the-trait">Require implementations to use exactly the same API as the trait</a></h3>
<p>We could reduce the potential for confusion by disallowing “dormant refinements” with a warning in the current edition, as this RFC proposes, and an error in future editions. This approach is more conservative than the one in this RFC. However, it leaves Rust in a state of allowing some kinds of refinement (like safe impls of <code>unsafe</code> methods) but not others, without a clear reason for doing so.</p>
<p>While we could postpone the question of whether to allow this indefinitely, we argue that allowing such refinements will make Rust easier to learn and easier to use.</p>
<h3 id="allow-refine-at-levels-other-than-impl-items"><a class="header" href="#allow-refine-at-levels-other-than-impl-items">Allow <code>#[refine]</code> at levels other than impl items</a></h3>
<p>We could allow <code>#[refine]</code> on individual aspects of a function signature like the return type, where clauses, or argument types. This would allow users to scope refinement more narrowly and make sure that they aren’t refining other aspects of that function signature. However, it seems unlikely that API refinement would be such a footgun that such narrowly scoping is needed.</p>
<p>Going in the other direction, we could allow <code>#[refine]</code> on the impl itself. This would remove repetition in cases where an impl refines many items at once. It is unclear if this would be desired frequently enough to justify it.</p>
<h2 id="prior-art"><a class="header" href="#prior-art">Prior art</a></h2>
<h3 id="java-covariant-return-types"><a class="header" href="#java-covariant-return-types">Java covariant return types</a></h3>
<p>If you override a method in Java, the return type can be any subtype of the original type. When invoking the method on that type, you see the subtype.</p>
<h3 id="auto-traits"><a class="header" href="#auto-traits">Auto traits</a></h3>
<p>One piece of related prior art here is the <a href="https://rust-lang.github.io/rfcs/1522-conservative-impl-trait.html#oibit-transparency">leakage of auto traits</a> for return position <code>impl Trait</code>. Today it is possible for library authors to stabilize the auto traits of their return types without realizing it. Unlike in this proposal, there is no syntax corresponding to the stabilized API surface.</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved questions</a></h2>
<h3 id="should-refine-be-required-in-future-editions"><a class="header" href="#should-refine-be-required-in-future-editions">Should <code>#[refine]</code> be required in future editions?</a></h3>
<p>As discussed in <a href="#drawbacks">Drawbacks</a>, this feature could lead to library authors accidentally publishing refined APIs that they did not mean to stabilize. We could prevent that by requiring the <code>#[refine]</code> attribute on any refined item inside an implementation.</p>
<p>There are three main options:</p>
<ul>
<li><code>#[refine]</code> is <em>always required</em> for an impl to commit to a refined interface. In the next edition we could make it a hard error to write a refined interface without the <code>#[refine]</code> attribute, to reduce confusion.</li>
<li><code>#[refine]</code> is <em>recommended</em> in the next edition. Refined interfaces always work in future editions, but we warn or emit a deny-by-default lint if <code>#[refine]</code> is not used.</li>
<li><code>#[refine]</code> is <em>not recommended</em> in the next edition. Refined interfaces always work in future editions without any annotation at all.</li>
</ul>
<p>It would help to do an analysis of how frequently “dormant refinements” occur on crates.io today, and of a sample of those, how many look accidental and how many look like an extended API that a crate author might have meant to expose.</p>
<h2 id="future-possibilities"><a class="header" href="#future-possibilities">Future possibilities</a></h2>
<h3 id="return-position-impl-trait-in-traits"><a class="header" href="#return-position-impl-trait-in-traits">Return position <code>impl Trait</code> in traits</a></h3>
<p>One motivating use case for refined impls is return position impl trait in traits, which is not yet an accepted Rust feature. You can find more details about this feature in an <a href="https://github.com/rust-lang/rfcs/pull/3193">earlier RFC</a>. Its use is demonstrated in an <a href="#guide-level-explanation">example</a> at the beginning of this RFC.</p>
<p>This RFC is intended to stand alone, but it also works well with that proposal.</p>
<h4 id="equivalence-to-associated-types"><a class="header" href="#equivalence-to-associated-types">Equivalence to associated types</a></h4>
<p>One of the appealing aspects of this feature is that it can be desugared to a function returning an associated type.</p>
<pre><code class="language-rust">trait Foo {
    fn get_state(&amp;self) -&gt; impl Debug;
}

// Desugars to something like this:
trait Foo {
    type Foo = impl Debug;
    fn get_state(&amp;self) -&gt; Self::Foo;
}</code></pre>
<p>If a trait used associated types, implementers would be able to specify concrete values for those types and let their users depend on it.</p>
<pre><code class="language-rust">impl Foo for () {
    type Foo = String;
    fn get_state(&amp;self) -&gt; Self::Foo { "empty state".to_string() }
}

let _: String = ().foo();</code></pre>
<p>With refinement impls, we can say that this desugaring is equivalent because return position impl trait would give the same flexibility to implementers as associated types.</p>
<h3 id="bounding-refined-items"><a class="header" href="#bounding-refined-items">Bounding refined items</a></h3>
<p>As described in the <a href="#refactoring">Refactoring</a> drawbacks section, when making existing code generic a user may run into dependence on refined aspects of a concrete type not specified in the trait itself. In this case the user may want to add additional bounds so they can make their code generic without significant modifications.</p>
<p>This problem already exists for associated types, but bounds can be added for those. This implies a couple of ways to solve this problem.</p>
<h4 id="new-kinds-of-bounds"><a class="header" href="#new-kinds-of-bounds">New kinds of bounds</a></h4>
<p>We can make it possible to add bounds on all refine-able aspects of a trait API.</p>
<p>It is already likely we will want to allow bounding the return type of methods:</p>
<pre><code class="language-rust">trait Trait {
    fn foo() -&gt; impl Clone;
}

fn take_foo&lt;T: Foo&gt;(_: T) where T::foo: Copy { ... }</code></pre>
<p>The need for this arises both in <code>async</code> (e.g. needing to bound a future return type by <code>Send</code>) and in cases like <code>-&gt; impl Iterator</code> where additional properties are required. A mechanism for supplying these bounds could possibly be extended to bounding what <em>argument</em> types a method accepts.</p>
<p>There is no way to bound the type of a const today. It is possible one could be added, but since consts will only allow subtype refinement (i.e. a type with a longer lifetime than required by the trait) it is unlikely that this situation will come up often in practice.</p>
<h4 id="falling-back-to-associated-types"><a class="header" href="#falling-back-to-associated-types">Falling back to associated types</a></h4>
<p>As mentioned above, associated types can have bounds, either on their exact value or with other traits:</p>
<pre><code class="language-rust">fn foo&lt;T: Iterator&lt;Item = u32&gt;&gt;(_: T) { ... }
fn bar&lt;T: Iterator&gt;(_: T) where T::Item: Clone { ... }</code></pre>
<p>Because associated types are the most flexible option <strong>we may want to make it possible to add associated types to a trait backward-compatibly</strong>. For example, given the following trait:</p>
<pre><code class="language-rust">trait Trait {
    fn foo() -&gt; impl Clone;
}</code></pre>
<p>we want to be able to refactor to something like this:</p>
<pre><code class="language-rust">trait Trait {
    type Foo: Clone;
    fn foo() -&gt; Self::Foo;
}</code></pre>
<p>There are least a couple of things needed for this:</p>
<ol>
<li>Don’t require implementations to specify associated type values when they can be inferred. For example:
<pre><code class="language-rust">trait Trait {
    type Foo;
    fn foo() -&gt; Foo;
}

impl Trait for () {
    fn foo() -&gt; usize;
    // `type Foo = usize;` is not needed,
    // since it can be inferred from the above.
}</code></pre>
</li>
<li>Allow adding associated types without breaking existing usages of <code>dyn</code>. For example, let’s say we had support for return-position <code>impl Trait</code> with dynamic dispatch. With <a href="https://github.com/rust-lang/rust/issues/29661">associated type defaults</a> and type alias <code>impl Trait</code>, you could write:
<pre><code class="language-rust">trait Trait {
    type Foo: Clone = impl Clone;
    fn foo() -&gt; Foo;
}</code></pre>
and allow <code>dyn Trait</code> to mean <code>dyn Trait&lt;Foo = impl Clone&gt;</code>.</li>
</ol>
<h3 id="adding-generic-parameters"><a class="header" href="#adding-generic-parameters">Adding generic parameters</a></h3>
<p>This RFC allows implementers to replace return-position <code>impl Trait</code> with a concrete type. Conversely, sometimes it is desirable to <em>generalize</em> an argument from a concrete type to <code>impl Trait</code> or a new generic parameter.</p>
<pre><code class="language-rust">fn one_a(input: String) {}
fn one_b(input: impl Display) {}</code></pre>
<p>More generally, one way to refine an interface is to generalize it by introducing new generics. For instance, here are some more pairs of “unrefined” APIs <code>a</code> and refined versions of them <code>b</code>.</p>
<pre><code class="language-rust">fn two_a(input: String) {}
fn two_b&lt;T: Debug = String&gt;(input: T) {}

fn three_a&lt;'a&gt;(&amp;'a i32, &amp;'a i32) {}
fn three_b&lt;'a, 'b&gt;(&amp;'a i32, &amp;'b i32) {}</code></pre>
<p>It might also be desirable to turn an elided lifetime into a lifetime parameter so it can be named:</p>
<pre><code class="language-rust">fn four_a(&amp;self) -&gt; &amp;str {}
fn four_b&lt;'a&gt;(&amp;'a self) -&gt; &amp;'a str {}</code></pre>
<p>Adding generic parameters to a trait function is not allowed by this proposal, whether the parameters are named or created implicitly via argument-position <code>impl Trait</code>. In principle it could work for both cases, as long as named parameters are defaulted. Implementing this may introduce complexity to the compiler, however. We leave the question of whether this should be allowed out of scope for this RFC.</p>
<hr>
<ol class="footnote-definition">
<li id="footnote-rpitit">
<p>At the time of writing, return position impl Trait is not allowed in traits. The guide text written here is only for the purpose of illustrating how we would document this feature if it were allowed. <a href="#fr-rpitit-1">↩</a></p>
</li>
<li id="footnote-refine-edition">
<p>Depending on the outcome of the Unresolved Questions in this RFC, this may also be the case for future editions. <a href="#fr-refine-edition-1">↩</a></p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="3243-packages-as-optional-namespaces.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="3254-types-team.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="3243-packages-as-optional-namespaces.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="3254-types-team.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
