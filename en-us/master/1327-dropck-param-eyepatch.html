<!DOCTYPE HTML>
<html lang="en_US" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>1327-dropck-param-eyepatch - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-0060737d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Feature Name: dropck_eyepatch, generic_param_attrs</li>
<li>Start Date: 2015-10-19</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/1327">rust-lang/rfcs#1327</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/34761">rust-lang/rust#34761</a></li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Refine the unguarded-escape-hatch from <a href="https://github.com/rust-lang/rfcs/blob/master/text/1238-nonparametric-dropck.md">RFC 1238</a> (nonparametric
dropck) so that instead of a single attribute side-stepping <em>all</em>
dropck constraints for a type’s destructor, we instead have a more
focused system that specifies exactly which type and/or lifetime
parameters the destructor is guaranteed not to access.</p>
<p>Specifically, this RFC proposes adding the capability to attach
attributes to the binding sites for generic parameters (i.e. lifetime
and type parameters). Atop that capability, this RFC proposes adding a
<code>#[may_dangle]</code> attribute that indicates that a given lifetime or type
holds data that must not be accessed during the dynamic extent of that
<code>drop</code> invocation.</p>
<p>As a side-effect, enable adding attributes to the formal declarations
of generic type and lifetime parameters.</p>
<p>The proposal in this RFC is intended as a <em>temporary</em> solution (along
the lines of <code>#[fundamental]</code> and <em>will not</em> be stabilized
as-is. Instead, we anticipate a more comprehensive approach to be
proposed in a follow-up RFC.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>The unguarded escape hatch (UGEH) from <a href="https://github.com/rust-lang/rfcs/blob/master/text/1238-nonparametric-dropck.md">RFC 1238</a> is a blunt
instrument: when you use <code>unsafe_destructor_blind_to_params</code>, it is
asserting that your destructor does not access borrowed data whose
type includes <em>any</em> lifetime or type parameter of the type.</p>
<p>For example, the current destructor for <code>RawVec&lt;T&gt;</code> (in <code>liballoc/</code>)
looks like this:</p>
<pre><code class="language-rust">impl&lt;T&gt; Drop for RawVec&lt;T&gt; {
    #[unsafe_destructor_blind_to_params]
    /// Frees the memory owned by the RawVec *without* trying to Drop its contents.
    fn drop(&amp;mut self) {
        [... free memory using global system allocator ...]
    }
}</code></pre>
<p>The above is sound today, because the above destructor does not call
any methods that can access borrowed data in the values of type <code>T</code>,
and so we do not need to enforce the drop-ordering constraints imposed
when you leave out the <code>unsafe_destructor_blind_to_params</code> attribute.</p>
<p>While the above attribute suffices for many use cases today, it is not
fine-grain enough for other cases of interest. In particular, it
cannot express that the destructor will not access borrowed data
behind a <em>subset</em> of the type parameters.</p>
<p>Here are two concrete examples of where the need for this arises:</p>
<h3 id="example-checkedhashmap"><a class="header" href="#example-checkedhashmap">Example: <code>CheckedHashMap</code></a></h3>
<p>The original Sound Generic Drop proposal (<a href="https://github.com/rust-lang/rfcs/blob/master/text/0769-sound-generic-drop.md">RFC 769</a>)
had an <a href="https://github.com/rust-lang/rfcs/blob/master/text/0769-sound-generic-drop.md#appendix-a-why-and-when-would-drop-read-from-borrowed-data">appendix</a> with an example of a
<code>CheckedHashMap&lt;K, V&gt;</code> type that called the hashcode method
for all of the keys in the map in its destructor.
This is clearly a type where we <em>cannot</em> claim that we do not access
borrowed data potentially hidden behind <code>K</code>, so it would be unsound
to use the blunt <code>unsafe_destructor_blind_to_params</code> attribute on this
type.</p>
<p>However, the values of the <code>V</code> parameter to <code>CheckedHashMap</code> are, in
all likelihood, <em>not</em> accessed by the <code>CheckedHashMap</code> destructor. If
that is the case, then it should be sound to instantiate <code>V</code> with a
type that contains references to other parts of the map (e.g.,
references to the keys or to other values in the map). However, we
cannot express this today: There is no way to say that the
<code>CheckedHashMap</code> will not access borrowed data that is behind <em>just</em>
<code>V</code>.</p>
<h3 id="example-vect-aallocatordefaultallocator"><a class="header" href="#example-vect-aallocatordefaultallocator">Example: <code>Vec&lt;T, A:Allocator=DefaultAllocator&gt;</code></a></h3>
<p>The Rust developers have been talking for <a href="https://github.com/rust-lang/rfcs/issues/538">a long time</a>
about adding an <code>Allocator</code> trait that would allow users to override
the allocator used for the backing storage of collection types like
<code>Vec</code> and <code>HashMap</code>.</p>
<p>For example, we would like to generalize the <code>RawVec</code> given above as
follows:</p>
<pre><code class="language-rust">#[unsafe_no_drop_flag]
pub struct RawVec&lt;T, A:Allocator=DefaultAllocator&gt; {
    ptr: Unique&lt;T&gt;,
    cap: usize,
    alloc: A,
}

impl&lt;T, A:Allocator&gt; Drop for RawVec&lt;T, A&gt; {
    #[should_we_put_ugeh_attribute_here_or_not(???)]
    /// Frees the memory owned by the RawVec *without* trying to Drop its contents.
    fn drop(&amp;mut self) {
        [... free memory using self.alloc ...]
    }
}</code></pre>
<p>However, we <em>cannot</em> soundly add an allocator parameter to a
collection that today uses the <code>unsafe_destructor_blind_to_params</code>
UGEH attribute in the destructor that deallocates, because that blunt
instrument would allow someone to write this:</p>
<pre><code class="language-rust">// (`ArenaAllocator`, when dropped, automatically frees its allocated blocks)

// (Usual pattern for assigning same extent to `v` and `a`.)
let (v, a): (Vec&lt;Stuff, &amp;ArenaAllocator&gt;, ArenaAllocator);

a = ArenaAllocator::new();
v = Vec::with_allocator(&amp;a);

... v.push(stuff) ...

// at end of scope, `a` may be dropped before `v`, invalidating
// soundness of subsequent invocation of destructor for `v` (because
// that would try to free buffer of `v` via `v.buf.alloc` (== `&amp;a`)).</code></pre>
<p>The only way today to disallow the above unsound code would be to
remove <code>unsafe_destructor_blind_to_params</code> from <code>RawVec</code>/ <code>Vec</code>, which
would break other code (for example, code using <code>Vec</code> as the backing
storage for <a href="https://github.com/rust-lang/rust/blob/098a7a07ee6d11cf6d2b9d18918f26be95ee2f66/src/test/run-pass/dropck_legal_cycles.rs">cyclic graph structures</a>).</p>
<h2 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h2>
<p>First off: The proposal in this RFC is intended as a <em>temporary</em>
solution (along the lines of <code>#[fundamental]</code> and <em>will not</em> be
stabilized as-is. Instead, we anticipate a more comprehensive approach
to be proposed in a follow-up RFC.</p>
<p>Having said that, here is the proposed short-term solution:</p>
<ol>
<li>
<p>Add the ability to attach attributes to syntax that binds formal
lifetime or type parameters. For the purposes of this RFC, the only
place in the syntax that requires such attributes are <code>impl</code>
blocks, as in <code>impl&lt;T&gt; Drop for Type&lt;T&gt; { ... }</code></p>
</li>
<li>
<p>Add a new fine-grained attribute, <code>may_dangle</code>, which is attached
to the binding sites for lifetime or type parameters on an <code>Drop</code>
implementation.
This RFC will sometimes call this attribute the “eyepatch”,
since it does
not make dropck totally blind; just blind on one “side”.</p>
</li>
<li>
<p>Add a new requirement that any <code>Drop</code> implementation that uses the
<code>#[may_dangle]</code> attribute must be declared as an <code>unsafe impl</code>.
This reflects the fact that such <code>Drop</code> implementations have
an additional constraint on their behavior (namely that they cannot
access certain kinds of data) that will not be verified by the
compiler and thus must be verified by the programmer.</p>
</li>
<li>
<p>Remove <code>unsafe_destructor_blind_to_params</code>, since all uses of it
should be expressible via <code>#[may_dangle]</code>.</p>
</li>
</ol>
<h3 id="attributes-on-lifetime-or-type-parameters"><a class="header" href="#attributes-on-lifetime-or-type-parameters">Attributes on lifetime or type parameters</a></h3>
<p>This is a simple extension to the syntax.</p>
<p>It is guarded by the feature gate <code>generic_param_attrs</code>.</p>
<p>Constructions like the following will now become legal.</p>
<p>Example of eyepatch attribute on a single type parameter:</p>
<pre><code class="language-rust">unsafe impl&lt;'a, #[may_dangle] X, Y&gt; Drop for Foo&lt;'a, X, Y&gt; {
    ...
}</code></pre>
<p>Example of eyepatch attribute on a lifetime parameter:</p>
<pre><code class="language-rust">unsafe impl&lt;#[may_dangle] 'a, X, Y&gt; Drop for Bar&lt;'a, X, Y&gt; {
    ...
}</code></pre>
<p>Example of eyepatch attribute on multiple parameters:</p>
<pre><code class="language-rust">unsafe impl&lt;#[may_dangle] 'a, X, #[may_dangle] Y&gt; Drop for Baz&lt;'a, X, Y&gt; {
    ...
}</code></pre>
<p>These attributes are only written next to the formal binding
sites for the generic parameters. The <em>usage</em> sites, points
which refer back to the parameters, continue to disallow the use
of attributes.</p>
<p>So while this is legal syntax:</p>
<pre><code class="language-rust">unsafe impl&lt;'a, #[may_dangle] X, Y&gt; Drop for Foo&lt;'a, X, Y&gt; {
    ...
}</code></pre>
<p>the follow would be illegal syntax (at least for now):</p>
<pre><code class="language-rust">unsafe impl&lt;'a, X, Y&gt; Drop for Foo&lt;'a, #[may_dangle] X, Y&gt; {
    ...
}</code></pre>
<h3 id="the-eyepatch-attribute"><a class="header" href="#the-eyepatch-attribute">The “eyepatch” attribute</a></h3>
<p>Add a new attribute, <code>#[may_dangle]</code> (the “eyepatch”).</p>
<p>It is guarded by the feature gate <code>dropck_eyepatch</code>.</p>
<p>The eyepatch is similar to <code>unsafe_destructor_blind_to_params</code>: it is
part of the <code>Drop</code> implementation, and it is meant
to assert that a destructor is guaranteed not to access certain kinds
of data accessible via <code>self</code>.</p>
<p>The main difference is that the eyepatch is applied to a single
generic parameter: <code>#[may_dangle] ARG</code>.
This specifies exactly <em>what</em>
the destructor is blind to (i.e., what will dropck treat as
inaccessible from the destructor for this type).</p>
<p>There are two things one can supply as the <code>ARG</code> for a given eyepatch:
one of the type parameters for the type,
or one of the lifetime parameters
for the type.</p>
<p>When used on a type, e.g. <code>#[may_dangle] T</code>, the programmer is
asserting the only uses of values of that type will be to move or drop
them. Thus, no fields will be accessed nor methods called on values of
such a type (apart from any access performed by the destructor for the
type when the values are dropped). This ensures that no dangling
references (such as when <code>T</code> is instantiated with <code>&amp;'a u32</code>) are ever
accessed in the scenario where <code>'a</code> has the same lifetime as the value
being currently destroyed (and thus the precise order of destruction
between the two is unknown to the compiler).</p>
<p>When used on a lifetime, e.g. <code>#[may_dangle] 'a</code>, the programmer is
asserting that no data behind a reference of lifetime <code>'a</code> will be
accessed by the destructor. Thus, no fields will be accessed nor
methods called on values of type <code>&amp;'a Struct</code>, ensuring that again no
dangling references are ever accessed by the destructor.</p>
<h3 id="require-unsafe-on-drop-implementations-using-the-eyepatch"><a class="header" href="#require-unsafe-on-drop-implementations-using-the-eyepatch">Require <code>unsafe</code> on Drop implementations using the eyepatch</a></h3>
<p>The final detail is to add an additional check to the compiler
to ensure that any use of <code>#[may_dangle]</code> on a <code>Drop</code> implementation
imposes a requirement that that implementation block use
<code>unsafe impl</code>.<sup><a href="#footnote1">2</a></sup></p>
<p>This reflects the fact that use of <code>#[may_dangle]</code> is a
programmer-provided assertion about the behavior of the <code>Drop</code>
implementation that must be valided manually by the programmer.
It is analogous to other uses of <code>unsafe impl</code> (apart from the
fact that the <code>Drop</code> trait itself is not an <code>unsafe trait</code>).</p>
<h4 id="examples-adapted-from-the-rustonomicon"><a class="header" href="#examples-adapted-from-the-rustonomicon">Examples adapted from the Rustonomicon</a></h4>
<p>So, adapting some examples from the Rustonomicon
<a href="https://doc.rust-lang.org/nightly/nomicon/dropck.html">Drop Check</a> chapter, we would be able to write
the following.</p>
<p>Example of eyepatch on a lifetime parameter::</p>
<pre><code class="language-rust">struct InspectorA&lt;'a&gt;(&amp;'a u8, &amp;'static str);

unsafe impl&lt;#[may_dangle] 'a&gt; Drop for InspectorA&lt;'a&gt; {
    fn drop(&amp;mut self) {
        println!("InspectorA(_, {}) knows when *not* to inspect.", self.1);
    }
}</code></pre>
<p>Example of eyepatch on a type parameter:</p>
<pre><code class="language-rust">use std::fmt;

struct InspectorB&lt;T: fmt::Display&gt;(T, &amp;'static str);

unsafe impl&lt;#[may_dangle] T: fmt::Display&gt; Drop for InspectorB&lt;T&gt; {
    fn drop(&amp;mut self) {
        println!("InspectorB(_, {}) knows when *not* to inspect.", self.1);
    }
}</code></pre>
<p>Both of the above two examples are much the same as if we had used the
old <code>unsafe_destructor_blind_to_params</code> UGEH attribute.</p>
<h4 id="example-rawvec"><a class="header" href="#example-rawvec">Example: RawVec</a></h4>
<p>To generalize <code>RawVec</code> from the <a href="#motivation">motivation</a> with an
<code>Allocator</code> correctly (that is, soundly and without breaking existing
code), we would now write:</p>
<pre><code class="language-rust">unsafe impl&lt;#[may_dangle]T, A:Allocator&gt; Drop for RawVec&lt;T, A&gt; {
    /// Frees the memory owned by the RawVec *without* trying to Drop its contents.
    fn drop(&amp;mut self) {
        [... free memory using self.alloc ...]
    }
}</code></pre>
<p>The use of <code>#[may_dangle] T</code> here asserts that even
though the destructor may access borrowed data through <code>A</code> (and thus
dropck must impose drop-ordering constraints for lifetimes occurring
in the type of <code>A</code>), the developer is guaranteeing that no access to
borrowed data will occur via the type <code>T</code>.</p>
<p>The latter is not expressible today even with
<code>unsafe_destructor_blind_to_params</code>; there is no way to say that a
type will not access <code>T</code> in its destructor while also ensuring the
proper drop-ordering relationship between <code>RawVec&lt;T, A&gt;</code> and <code>A</code>.</p>
<h4 id="example-multiple-lifetimes"><a class="header" href="#example-multiple-lifetimes">Example; Multiple Lifetimes</a></h4>
<p>Example: The above <code>InspectorA</code> carried a <code>&amp;'static str</code> that was
always safe to access from the destructor.</p>
<p>If we wanted to generalize this type a bit, we might write:</p>
<pre><code class="language-rust">struct InspectorC&lt;'a,'b,'c&gt;(&amp;'a str, &amp;'b str, &amp;'c str);

unsafe impl&lt;#[may_dangle] 'a, 'b, #[may_dangle] 'c&gt; Drop for InspectorC&lt;'a,'b,'c&gt; {
    fn drop(&amp;mut self) {
        println!("InspectorA(_, {}, _) knows when *not* to inspect.", self.1);
    }
}</code></pre>
<p>This type, like <code>InspectorA</code>, is careful to only access the <code>&amp;str</code>
that it holds in its destructor; but now the borrowed string slice
does not have <code>'static</code> lifetime, so we must make sure that we do not
claim that we are blind to its lifetime (<code>'b</code>).</p>
<p>(This example also illustrates that one can attach multiple instances
of the eyepatch attribute to a destructor, each with a distinct input
for its <code>ARG</code>.)</p>
<p>Given the definition above, this code will compile and run properly:</p>
<pre><code class="language-rust">fn this_will_work() {
    let b; // ensure that `b` strictly outlives `i`.
    let (i,a,c);
    a = format!("a");
    b = format!("b");
    c = format!("c");
    i = InspectorC(a, b, c);
}</code></pre>
<p>while this code will be rejected by the compiler:</p>
<pre><code class="language-rust">fn this_will_not_work() {
    let (a,c);
    let (i,b); // OOPS: `b` not guaranteed to survive for `i`'s destructor.
    a = format!("a");
    b = format!("b");
    c = format!("c");
    i = InspectorC(a, b, c);
}</code></pre>
<h3 id="semantics"><a class="header" href="#semantics">Semantics</a></h3>
<p>How does this work, you might ask?</p>
<p>The idea is actually simple: the dropck rule stays mostly the same,
except for a small twist.</p>
<p>The Drop-Check rule at this point essentially says:</p>
<blockquote>
<p>if the type of <code>v</code> owns data of type <code>D</code>, where</p>
<p>(1.) the <code>impl Drop for D</code> is either type-parametric, or lifetime-parametric over <code>'a</code>, and
(2.) the structure of <code>D</code> can reach a reference of type <code>&amp;'a _</code>,</p>
<p>then <code>'a</code> must strictly outlive the scope of <code>v</code></p>
</blockquote>
<p>The main change we want to make is to the second condition.
Instead of just saying “the structure of <code>D</code> can reach a reference of type <code>&amp;'a _</code>”,
we want first to replace eyepatched lifetimes and types within <code>D</code> with <code>'static</code> and <code>()</code>,
respectively. Call this revised type <code>patched(D)</code>.</p>
<p>Then the new condition is:</p>
<blockquote>
<p>(2.) the structure of patched(D) can reach a reference of type <code>&amp;'a _</code>,</p>
</blockquote>
<p><em>Everything</em> else is the same.</p>
<p>In particular, the patching substitution is <em>only</em> applied with
respect to a particular destructor. Just because <code>Vec&lt;T&gt;</code> is blind to <code>T</code>
does not mean that we will ignore the actual type instantiated at <code>T</code>
in terms of drop-ordering constraints.</p>
<p>For example, in <code>Vec&lt;InspectorC&lt;'a,'name,'c&gt;&gt;</code>, even though <code>Vec</code>
itself is blind to the whole type <code>InspectorC&lt;'a, 'name, 'c&gt;</code> when we
are considering the <code>impl Drop for Vec</code>, we <em>still</em> honor the
constraint that <code>'name</code> must strictly outlive the <code>Vec</code> (because we
continue to consider all <code>D</code> that is data owned by a value <code>v</code>,
including when <code>D</code> == <code>InspectorC&lt;'a,'name,'c&gt;</code>).</p>
<h3 id="prototype"><a class="header" href="#prototype">Prototype</a></h3>
<p>pnkfelix has implemented a proof-of-concept
<a href="https://github.com/pnkfelix/rust/commits/dropck-eyepatch">implementation</a> of the <code>#[may_dangle]</code> attribute.
It uses the substitution machinery we already have in the compiler
to express the semantics above.</p>
<h3 id="limitations-of-prototype-not-part-of-design"><a class="header" href="#limitations-of-prototype-not-part-of-design">Limitations of prototype (not part of design)</a></h3>
<p>Here we note a few limitations of the current prototype. These
limitations are <em>not</em> being proposed as part of the specification of
the feature.</p>
<p><a name="footnote1">2.</a> The compiler does not yet enforce (or even
allow) the use of <code>unsafe impl</code> for <code>Drop</code> implementations that use
the <code>#[may_dangle]</code> attribute.</p>
<p>Fixing the above limitations should just be a matter of engineering,
not a fundamental hurdle to overcome in the feature’s design in the
context of the language.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<h3 id="ugliness"><a class="header" href="#ugliness">Ugliness</a></h3>
<p>This attribute, like the original <code>unsafe_destructor_blind_to_params</code>
UGEH attribute, is ugly.</p>
<h3 id="unchecked-assertions-boo"><a class="header" href="#unchecked-assertions-boo">Unchecked assertions boo</a></h3>
<p>It would be nicer if to actually change the language in a way where we
could check the assertions being made by the programmer, rather than
trusting them. (pnkfelix has some thoughts on this, which are mostly
reflected in what he wrote in the <a href="https://github.com/rust-lang/rfcs/blob/master/text/1238-nonparametric-dropck.md#continue-supporting-parametricity">RFC 1238 alternatives</a>.)</p>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<p>Note: The alternatives section for this RFC is particularly
note-worthy because the ideas here may serve as the basis for a more
comprehensive long-term approach.</p>
<h3 id="make-dropck-see-again-via-focused-where-clauses"><a class="header" href="#make-dropck-see-again-via-focused-where-clauses">Make dropck “see again” via (focused) where-clauses</a></h3>
<p>The idea is that we keep the UGEH attribute, blunt hammer that it is.
You first opt out of the dropck ordering constraints via that, and
then you add back in ordering constraints via <code>where</code> clauses.</p>
<p>(The ordering constraints in question would normally be <em>implied</em> by
the dropck analysis; the point is that UGEH is opting out of that
analysis, and so we are now adding them back in.)</p>
<p>Here is the allocator example expressed in this fashion:</p>
<pre><code class="language-rust">impl&lt;T, A:Allocator&gt; Drop for RawVec&lt;T, A&gt; {
    #[unsafe_destructor_blind_to_params]
    /// Frees the memory owned by the RawVec *without* trying to Drop its contents.
    fn drop&lt;'s&gt;(&amp;'s mut self) where A: 's {
    //                        ~~~~~~~~~~~
    //                             |
    //                             |
    // This constraint (that `A` outlives `'s`), and other conditions
    // relating `'s` and `Self` are normally implied by Rust's type
    // system, but `unsafe_destructor_blind_to_params` opts out of
    // enforcing them. This `where`-clause is opting back into *just*
    // the `A:'s` again.
    //
    // Note we are *still* opting out of `T: 's` via
    // `unsafe_destructor_blind_to_params`, and thus our overall
    // goal (of not breaking code that relies on `T` not having to
    // survive the destructor call) is accomplished.

        [... free memory using self.alloc ...]
    }
}</code></pre>
<p>This approach, if we can make it work, seems fine to me. It certainly
avoids a number of problems that the eyepatch attribute has.</p>
<p>Advantages of fn-drop-with-where-clauses:</p>
<ul>
<li>Since the eyepatch attribute is to be limited to type and lifetime
parameters, this approach is more expressive,
since it would allow one to put type-projections into the
constraints.</li>
</ul>
<p>Drawbacks of fn-drop-with-where-clauses:</p>
<ul>
<li>
<p>Its not 100% clear what our implementation strategy will be for it,
while the eyepatch attribute does have a <a href="#prototype">prototype</a>.</p>
<p>I actually do not give this drawback much weight; resolving this
may be merely a matter of just trying to do it: e.g., build up the
set of where-clauses when we make the ADT’s representations, and
then have <code>dropck</code> insert instantiate and insert them as needed.</p>
</li>
<li>
<p>It might have the wrong ergonomics for developers: It seems bad to
have the blunt hammer introduce all sorts of potential
unsoundness, and rely on the developer to keep the set of
<code>where</code>-clauses on the <code>fn drop</code> up to date.</p>
<p>This would be a pretty bad drawback, <em>if</em> the language and
compiler were to stagnate. But my intention/goal is to eventually
put in a <a href="#wait-for-proper-parametricity">sound compiler analysis</a>.
In other words, in the future, I will be more concerned about the
ergonomics of the code that uses the sound analysis. I will not be
concerned about “gotcha’s” associated with the UGEH escape hatch.</p>
</li>
</ul>
<p>(The most important thing I want to convey is that I believe that both
the eyepatch attribute and fn-drop-with-where-clauses are capable of
resolving the real issues that I face today, and I would be happy for
either proposal to be accepted.)</p>
<h3 id="wait-for-proper-parametricity"><a class="header" href="#wait-for-proper-parametricity">Wait for proper parametricity</a></h3>
<p>As alluded to in the <a href="#drawbacks">drawbacks</a>, in principle we could provide
similar expressiveness to that offered by the eyepatch (which is
acting as a fine-grained escape hatch from dropck) by instead offering
some language extension where the compiler would actually analyze the
code based on programmer annotations indicating which types and
lifetimes are not used by a function.</p>
<p>In my opinion I am of two minds on this (but they are both in favor
this RFC rather than waiting for a sound compiler analysis):</p>
<ol>
<li>
<p>We will always need an escape hatch. The programmer will always need
a way to assert something that she knows to be true, even if the compiler
cannot prove it. (A simple example: Calling a third-party API that has not
yet added the necessary annotations.)</p>
<p>This RFC is proposing that we keep an escape hatch, but we make it more
expressive.</p>
</li>
<li>
<p>If we eventually <em>do</em> have a sound compiler analysis, I see the
compiler changes and library annotations suggested by this RFC as
being in line with what that compiler analysis would end up using
anyway. In other words: Assume we <em>did</em> add some way for the programmer
to write that <code>T</code> is parametric (e.g. <code>T: ?Special</code> in the <a href="https://github.com/rust-lang/rfcs/blob/master/text/1238-nonparametric-dropck.md#continue-supporting-parametricity">RFC 1238 alternatives</a>).
Even then, we would still need the compiler changes suggested by this RFC,
and at that point hopefully the task would be for the programmer to mechanically
replace occurrences of <code>#[may_dangle] T</code> with <code>T: ?Special</code>
(and then see if the library builds).</p>
<p>In other words, I see the form suggested by this RFC as being a step <em>towards</em>
a proper analysis, in the sense that it is getting programmers used to thinking
about the individual parameters and their relationship with the container, rather
than just reasoning about the container on its own without any consideration
of each type/lifetime parameter.</p>
</li>
</ol>
<h3 id="do-nothing"><a class="header" href="#do-nothing">Do nothing</a></h3>
<p>If we do nothing, then we cannot add <code>Vec&lt;T, A:Allocator&gt;</code> soundly.</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved questions</a></h2>
<p>Is the definition of the drop-check rule sound with this <code>patched(D)</code>
variant?  (We have not proven any previous variation of the rule
sound; I think it would be an interesting student project though.)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="1317-ide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="1328-global-panic-handler.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="1317-ide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="1328-global-panic-handler.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
