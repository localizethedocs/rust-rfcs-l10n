<!DOCTYPE HTML>
<html lang="en_US" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0738-variance - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-0060737d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Start Date: 2014-12-19</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/738">rust-lang/rfcs#738</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/22212">rust-lang/rust#22212</a></li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<ul>
<li>Use inference to determine the <em>variance</em> of input type parameters.</li>
<li>Make it an error to have unconstrained type/lifetime parameters.</li>
<li>Revamp the variance markers to make them more intuitive and less numerous.
In fact, there are only two: <code>PhantomData</code> and <code>PhantomFn</code>.</li>
<li>Integrate the notion of <code>PhantomData</code> into other automated compiler
analyses, notably OIBIT, that can otherwise be deceived into yielding
incorrect results.</li>
</ul>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<h3 id="why-variance-is-good"><a class="header" href="#why-variance-is-good">Why variance is good</a></h3>
<p>Today, all type parameters are invariant. This can be problematic
around lifetimes. A particular common example of where problems
arise is in the use of <code>Option</code>. Here is a simple example. Consider
this program, which has a struct containing two references:</p>
<pre><code>struct List&lt;'l&gt; {
    field1: &amp;'l int,
    field2: &amp;'l int,
}

fn foo(field1: &amp;int, field2: &amp;int) {
    let list = List { field1: field1, field2: field2 };
    ...
}

fn main() { }
</code></pre>
<p>Here the function <code>foo</code> takes two references with distinct lifetimes.
The variable <code>list</code> winds up being instantiated with a lifetime that
is the intersection of the two (presumably, the body of <code>foo</code>).  This
is good.</p>
<p>If we modify this program so that one of those references is optional,
however, we will find that it gets a compilation error:</p>
<pre><code>struct List&lt;'l&gt; {
    field1: &amp;'l int,
    field2: Option&lt;&amp;'l int&gt;,
}

fn foo(field1: &amp;int, field2: Option&lt;&amp;int&gt;) {
    let list = List { field1: field1, field2: field2 };
        // ERROR: Cannot infer an appropriate lifetime
    ...
}

fn main() { }
</code></pre>
<p>The reason for this is that because <code>Option</code> is <em>invariant</em> with
respect to its argument type, it means that the lifetimes of <code>field1</code>
and <code>field2</code> must match <em>exactly</em>. It is not good enough for them to
have a common subset. This is not good.</p>
<h3 id="what-variance-is"><a class="header" href="#what-variance-is">What variance is</a></h3>
<p><a href="http://en.wikipedia.org/wiki/Covariance_and_contravariance_%28computer_science%29">Variance</a> is a general concept that comes up in all languages that
combine subtyping and generic types. However, because in Rust all
subtyping is related to the use of lifetimes parameters, Rust uses
variance in a very particular way. Basically, variance is a
determination of when it is ok for lifetimes to be approximated
(either made bigger or smaller, depending on context).</p>
<p>Let me give a few examples to try and clarify how variance works.
Consider this simple struct <code>Context</code>:</p>
<pre><code class="language-rust">struct Context&lt;'data&gt; {
    data: &amp;'data u32,
    ...
}</code></pre>
<p>Here the <code>Context</code> struct has one lifetime parameter, <code>data</code>, that
represents the lifetime of some data that it references. Now let’s
imagine that the lifetime of the data is some lifetime we call
<code>'x</code>. If we have a context <code>cx</code> of type <code>Context&lt;'x&gt;</code>, it is ok to
(for example) pass <code>cx</code> as an argument where a value of type
<code>Context&lt;'y&gt;</code> is required, so long as <code>'x : 'y</code> (“<code>'x</code> outlives
<code>'y</code>”). That is, it is ok to approximate <code>'x</code> as a shorter lifetime
like <code>'y</code>. This makes sense because by changing <code>'x</code> to <code>'y</code>, we’re
just pretending the data has a shorter lifetime than it actually has,
which can’t do any harm.  Here is an example:</p>
<pre><code class="language-rust">fn approx_context&lt;'long,'short&gt;(t: &amp;Context&lt;'long&gt;, data: &amp;'short Data)
    where 'long : 'short
{
    // here we approximate 'long as 'short, but that's perfectly safe.
    let u: &amp;Context&lt;'short&gt; = t;
    do_something(u, data)
}

fn do_something&lt;'x&gt;(t: &amp;Context&lt;'x&gt;, data: &amp;'x Data) {
   ...
}</code></pre>
<p>This case has been traditionally called “contravariant” by Rust,
though some argue (somewhat persuasively) that
<a href="https://github.com/rust-lang/rfcs/issues/391">“covariant” is the better terminology</a>.  In any case, this RFC
generally abandons the “variance” terminology in publicly exposed APIs
and bits of the language, making this a moot point (in this RFC,
however, I will stick to calling lifetimes which may be made smaller
“contravariant”, since that is what we have used in the past).</p>
<p>Next let’s consider a struct with interior mutability:</p>
<pre><code class="language-rust">struct Table&lt;'arg&gt; {
    cell: Cell&lt;&amp;'arg Foo&gt;
}</code></pre>
<p>In the case of <code>Table</code>, it is not safe for the compiler to approximate
the lifetime <code>'arg</code> at all. This is because <code>'arg</code> appears in a
mutable location (the interior of a <code>Cell</code>). Let me show you what
could happen if we did allow <code>'arg</code> to be approximated:</p>
<pre><code class="language-rust">fn innocent&lt;'long&gt;(t: &amp;Table&lt;'long&gt;) {
    {
        let foo: Foo = ..;
        evil(t, &amp;foo);
    }
    t.cell.get() // reads `foo`, which has been destroyed
}

fn evil&lt;'long,'short&gt;(t: &amp;Table&lt;'long&gt;, s: &amp;'short Foo)
    where 'long : 'short
{
    // The following assignment is not legal, but it would be legal
    let u: &amp;Table&lt;'short&gt; = t;
    u.cell.set(s);
}</code></pre>
<p>Here the function <code>evil()</code> changes contents of <code>t.cell</code> to point at
data with a shorter lifetime than <code>t</code> originally had. This is bad
because the caller still has the old type (<code>Table&lt;'long&gt;</code>) and doesn’t
know that data with a shorter lifetime has been inserted.  (This is
traditionally called “invariant”.)</p>
<p>Finally, there can be cases where it is ok to make a lifetime
<em>longer</em>, but not shorter. This comes up (for example) in a type like
<code>fn(&amp;'a u8)</code>, which may be safely treated as a <code>fn(&amp;'static u8)</code>.</p>
<h3 id="why-variance-should-be-inferred"><a class="header" href="#why-variance-should-be-inferred">Why variance should be inferred</a></h3>
<p>Actually, lifetime parameters already have a notion of variance, and
this variance is fully inferred. In fact, the proper variance for type
parameters is <em>also</em> being inferred, we’re just largely ignoring
it. (It’s not completely ignored; it informs the variance of
lifetimes.)</p>
<p>The main reason we chose inference over declarations is that variance
is rather tricky business. Most of the time, it’s annoying to have to
think about it, since it’s a purely mechanical thing. The main reason
that it pops up from time to time in Rust today (specifically, in
examples like the one above) is because we <em>ignore</em> the results of
inference and just make everything invariant.</p>
<p>But in fact there is another reason to prefer inference. When manually
specifying variance, it is easy to get those manual specifications
wrong. There is one example later on where the author did this, but
using the mechanisms described in this RFC to guide the inference
actually led to the correct solution.</p>
<h3 id="the-corner-case-unused-parameters-and-parameters-that-are-only-used-unsafely"><a class="header" href="#the-corner-case-unused-parameters-and-parameters-that-are-only-used-unsafely">The corner case: unused parameters and parameters that are only used unsafely</a></h3>
<p>Unfortunately, variance inference only works if type parameters are
actually <em>used</em>. Otherwise, there is no data to go on. You might think
parameters would always be used, but this is not true. In particular,
some types have “phantom” type or lifetime parameters that are not
used in the body of the type. This generally occurs with unsafe code:</p>
<pre><code>struct Items&lt;'vec, T&gt; { // unused lifetime parameter 'vec
    x: *mut T
}

struct AtomicPtr&lt;T&gt; { // unused type parameter T
    data: AtomicUint  // represents an atomically mutable *mut T, really
}
</code></pre>
<p>Since these parameters are unused, the inference can reasonably
conclude that <code>AtomicPtr&lt;int&gt;</code> and <code>AtomicPtr&lt;uint&gt;</code> are
interchangeable: after all, there are no fields of type <code>T</code>, so what
difference does it make what value it has? This is not good (and in
fact we have behavior like this today for lifetimes, which is a common
source of error).</p>
<p>To avoid this hazard, the RFC proposes to make it an error to have a
type or lifetime parameter whose variance is not constrained. Almost
always, the correct thing to do in such a case is to either remove the
parameter in question or insert a <em>marker type</em>. Marker types
basically inform the inference engine to pretend as if the type
parameter were used in particular ways. They are discussed in the next section.</p>
<h3 id="revamping-the-marker-types"><a class="header" href="#revamping-the-marker-types">Revamping the marker types</a></h3>
<h4 id="the-unsafecell-type"><a class="header" href="#the-unsafecell-type">The UnsafeCell type</a></h4>
<p>As today, the <code>UnsafeCell&lt;T&gt;</code> type is well-known to <code>rustc</code> and is
always considered invariant with respect to its type parameter <code>T</code>.</p>
<h4 id="phantom-data"><a class="header" href="#phantom-data">Phantom data</a></h4>
<p>This RFC proposes to replace the existing marker types
(<code>CovariantType</code>, <code>ContravariantLifetime</code>, etc) with a single type,
<code>PhantomData</code>:</p>
<pre><code class="language-rust">// Represents data of type `T` that is logically present, although the
// type system cannot see it. This type is covariant with respect to `T`.
struct PhantomData&lt;T&gt;;</code></pre>
<p>An instance of <code>PhantomData</code> is used to represent data that is
logically present, although the type system cannot see
it. <code>PhantomData</code> is covariant with respect to its type parameter <code>T</code>. Here are
some examples of uses of <code>PhantomData</code> from the standard library:</p>
<pre><code class="language-rust">struct AtomicPtr&lt;T&gt; {
    data: AtomicUint,

    // Act as if we could reach a `*mut T` for variance. This will
    // make `AtomicPtr` *invariant* with respect to `T` (because `T` appears
    // underneath the `mut` qualifier).
    marker: PhantomData&lt;*mut T&gt;,
}

pub struct Items&lt;'a, T: 'a&gt; {
    ptr: *const T,
    end: *const T,

    // Act as if we could reach a slice `[T]` with lifetime `'a`.
    // Induces covariance on `T` and suitable variance on `'a`
    // (covariance using the definition from rfcs#391).
    marker: marker::PhantomData&lt;&amp;'a [T]&gt;,
}</code></pre>
<p>Note that <code>PhantomData</code> can be used to induce covariance, invariance, or contravariance
as desired:</p>
<pre><code class="language-rust">PhantomData&lt;T&gt;         // covariance
PhantomData&lt;*mut T&gt;    // invariance, but see "unresolved question"
PhantomData&lt;Cell&lt;T&gt;&gt;   // invariance
PhantomData&lt;fn(T)&gt;     // contravariant</code></pre>
<p>Even better, the user doesn’t really have to understand the terms
covariance, invariance, or contravariance, but simply to accurately
model the kind of data that the type system should pretend is present.</p>
<p><strong>Other uses for phantom data.</strong> It turns out that phantom data is an
important concept for other compiler analyses. One example is the
OIBIT analysis, which decides whether certain traits (like <code>Send</code> and
<code>Sync</code>) are implemented by recursively examining the fields of structs
and enums. OIBIT should treat phantom data the same as normal
fields. Another example is the ongoing work for removing the
<code>#[unsafe_dtor]</code> annotation, which also sometimes requires a recursive
analysis of a similar nature.</p>
<h4 id="phantom-functions"><a class="header" href="#phantom-functions">Phantom functions</a></h4>
<p>One limitation of the marker type <code>PhantomData</code> is that it cannot be
used to constrain unused parameters appearing on traits. Consider
the following example:</p>
<pre><code class="language-rust">trait Dummy&lt;T&gt; { /* T is never used here! */ }</code></pre>
<p>Normally, the variance of a trait type parameter would be determined
based on where it appears in the trait’s methods: but in this case
there are no methods. Therefore, we introduce two special traits that
can be used to induce variance. Similarly to <code>PhantomData</code>, these
traits represent parts of the interface that are logically present, if
not actually present:</p>
<pre><code>// Act as if there were a method `fn foo(A) -&gt; R`. Induces contravariance on A
// and covariance on R.
trait PhantomFn&lt;A,R&gt;;
</code></pre>
<p>These traits should appear in the supertrait list. For example, the
<code>Dummy</code> trait might be modified as follows:</p>
<pre><code class="language-rust">trait Dummy&lt;T&gt; : PhantomFn() -&gt; T { }</code></pre>
<p>As you can see, the <code>()</code> notation can be used with <code>PhantomFn</code> as
well.</p>
<h4 id="designating-marker-traits"><a class="header" href="#designating-marker-traits">Designating marker traits</a></h4>
<p>In addition to phantom fns, there is a convenient trait <code>MarkerTrait</code>
that is intended for use as a supertrait for traits that designate
sets of types. These traits often have no methods and thus no actual
uses of <code>Self</code>. The builtin bounds are a good example:</p>
<pre><code class="language-rust">trait Copy : MarkerTrait { }
trait Sized : MarkerTrait { }
unsafe trait Send : MarkerTrait { }
unsafe trait Sync : MarkerTrait { }</code></pre>
<p><code>MarkerTrait</code> is not builtin to the language or specially understood
by the compiler, it simply encapsulates a common pattern. It is
implemented as follows:</p>
<pre><code class="language-rust">trait MarkerTrait for Sized? : PhantomFn(Self) -&gt; bool { }
impl&lt;Sized? T&gt; MarkerTrait for T { }</code></pre>
<p>Intuitively, <code>MarkerTrait</code> extends <code>PhantomFn(Self)</code> because it is “as
if” the traits were defined like:</p>
<pre><code class="language-rust">trait Copy {
    fn is_copyable(&amp;self) -&gt; bool { true }
}</code></pre>
<p>Here, the type parameter <code>Self</code> appears in argument position, which is
contravariant.</p>
<p><strong>Why contravariance?</strong> To see why contravariance is correct, you have
to consider what it means for <code>Self</code> to be contravariant for a marker
trait. It means that if I have evidence that <code>T : Copy</code>, then I can
use that as evidence to show that <code>U : Copy</code> if <code>U &lt;: T</code>. More formally:</p>
<pre><code>(T : Copy) &lt;: (U : Copy)   // I can use `T:Copy` where `U:Copy` is expected...
U &lt;: T                     // ...so long as `U &lt;: T`
</code></pre>
<p>More intuitively, it means that if a type <code>T</code> implements the marker,
than all of its subtypes must implement the marker.</p>
<p>Because subtyping is exclusively tied to lifetimes in Rust, and most
marker traits are orthogonal to lifetimes, it actually rarely makes a
difference what choice you make here. But imagine that we have a
marker trait that requires <code>'static</code> (such as <code>Send</code> today, though
this may change). If we made marker traits covariant with respect to
<code>Self</code>, then <code>&amp;'static Foo : Send</code> could be used as evidence that <code>&amp;'x Foo : Send</code> for any <code>'x</code>, because <code>&amp;'static Foo &lt;: &amp;'x Foo</code>:</p>
<pre><code>(&amp;'static Foo : Send) &lt;: (&amp;'x Foo : Send) // if things were covariant...
&amp;'static Foo &lt;: &amp;'x Foo                   // ...we'd have the wrong relation here
</code></pre>
<p><em>Interesting side story: the author thought that covariance would be
correct for some time. It was only when attempting to phrase the
desired behavior as a fn that I realized I had it backward, and
quickly found the counterexample I give above. This gives me
confidence that expressing variance in terms of data and fns is more
reliable than trying to divine the correct results directly.</em></p>
<h2 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h2>
<p>Most of the detailed design has already been covered in the motivation
section.</p>
<h3 id="summary-of-changes-required"><a class="header" href="#summary-of-changes-required">Summary of changes required</a></h3>
<ul>
<li>Use variance results to inform subtyping of nominal types
(structs, enums).</li>
<li>Use variance for the output type parameters on traits.</li>
<li>Input type parameters of traits are considered invariant.</li>
<li>Variance has no effect on the type parameters on an impl or fn;
rather those are freshly instantiated at each use.</li>
<li>Report an error if the inference does not find any use of a type or
lifetime parameter <em>and</em> that parameter is not bound in an
associated type binding in some where clause.</li>
</ul>
<p>These changes have largely been implemented. You can view the results,
and the impact on the standard library, in
<a href="https://github.com/nikomatsakis/rust/tree/variance-3">this branch on nikomatsakis’s repository</a>. Note though that as of
the time of this writing, the code is slightly outdated with respect
to this RFC in certain respects (which will clearly be rectified
ASAP).</p>
<h3 id="variance-inference-algorithm"><a class="header" href="#variance-inference-algorithm">Variance inference algorithm</a></h3>
<p>I won’t dive too deeply into the inference algorithm that we are using
here. It is based on Section 4 of the paper
<a href="http://people.cs.umass.edu/~yannis/variance-pldi11.pdf">“Taming the Wildcards: Combining Definition- and Use-Site Variance”</a>
published in PLDI’11 and written by Altidor et al. There is a fairly
detailed (and hopefully only slightly outdated) description in
<a href="https://github.com/nikomatsakis/rust/blob/variance-3/src/librustc_typeck/variance.rs#L11-L205">the code</a> as well.</p>
<h3 id="bivariance-yields-an-error"><a class="header" href="#bivariance-yields-an-error">Bivariance yields an error</a></h3>
<p>One big change from today is that if we compute a result of bivariance
as the variance for any type or lifetime parameter, we will report a
hard error. The error message explicitly suggests the use of a
<code>PhantomData</code> or <code>PhantomFn</code> marker as appropriate:</p>
<pre><code>type parameter `T` is never used; either remove it, or use a
marker such as `std::kinds::marker::PhantomData`"
</code></pre>
<p>The goal is to help users as concretely as possible. The documentation
on the phantom markers should also be helpful in guiding users to make
the right choice (the ability to easily attach documentation to the
marker type was in fact the major factor that led us to adopt marker
types in the first place).</p>
<h3 id="rules-for-associated-types"><a class="header" href="#rules-for-associated-types">Rules for associated types</a></h3>
<p>The only exception is when this type parameter is in fact
an output that is implied by where clauses declared on the type.  As
an example of why this distinction is important, consider the type
<code>Map</code> declared here:</p>
<pre><code class="language-rust">struct Map&lt;A,B,I,F&gt;
where I : Iterator&lt;Item=A&gt;, F : FnMut(A) -&gt; B
{
    iter: I,
    fn: F,
}</code></pre>
<p>Neither the type <code>A</code> nor <code>B</code> are reachable from the fields declared
within <code>Map</code>, and hence the variance inference for them results in
bivariance. However, they are nonetheless constrained. In the case of
the parameter <code>A</code>, its value is determined by the type <code>I</code>, and <code>B</code> is
determined by the type <code>F</code> (note that <a href="https://github.com/rust-lang/rfcs/blob/master/text/0587-fn-return-should-be-an-associated-type.md">RFC 587</a> makes the return
type of <code>FnMut</code> an associated type).</p>
<p>The analysis to decide when a type parameter is implied by other type
parameters is the same as that specified in <a href="https://github.com/rust-lang/rfcs/blob/master/text/0447-no-unused-impl-parameters.md#detailed-design">RFC 447</a>.</p>
<h2 id="future-possibilities"><a class="header" href="#future-possibilities">Future possibilities</a></h2>
<p><strong>Make phantom data and fns more first-class.</strong> One thing I would
consider in the future is to integrate phantom data and fns more
deeply into the language to improve usability. The idea would be to
add a phantom keyword and then permit the explicit declaration of
phantom fields and fns in structs and traits respectively:</p>
<pre><code class="language-rust">// Instead of
struct Foo&lt;T&gt; {
    pointer: *mut u8,
    _marker: PhantomData&lt;T&gt;
}
trait MarkerTrait : PhantomFn(Self) {
}

// you would write:
struct Foo&lt;T&gt; {
    pointer: *mut u8,
    phantom T
}
trait MarkerTrait {
    phantom fn(Self);
}</code></pre>
<p>Phantom fields would not need to be specified when creating an
instance of a type and (being anonymous) could never be named. They
exist solely to aid the analysis. This would improve the usability of
phantom markers greatly.</p>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<p><strong>Default to a particular variance when a type or lifetime parameter
is unused.</strong> A prior RFC advocated for this approach, mostly because
markers were seen as annoying to use. However, after some discussion,
it seems that it is more prudent to make a smaller change and retain
explicit declarations. Some factors that influenced this decision:</p>
<ul>
<li>The importance of phantom data for other analyses like OIBIT.</li>
<li>Many unused lifetime parameters (and some unused type parameters) are in
fact completely unnecessary. Defaulting to a particular variance would
not help in identifying these cases (though a better dead code lint might).</li>
<li>There is no default that is always correct but invariance, and
invariance is typically too strong.</li>
<li>Phantom type parameters occur relatively rarely anyhow.</li>
</ul>
<p><strong>Remove variance inference and use fully explicit declarations.</strong>
Variance inference is a rare case where we do non-local inference
across type declarations. It might seem more consistent to use
explicit declarations. However, variance declarations are notoriously
hard for people to understand. We were unable to come up with a
suitable set of keywords or other system that felt sufficiently
lightweight. Moreover, explicit annotations are error-prone when
compared to the phantom data and fn approach (see example in the
section regarding marker traits).</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved questions</a></h2>
<p>There is one significant unresolved question: the correct way to
handle a <code>*mut</code> pointer. It was revealed recently that while the
current treatment of <code>*mut T</code> is correct, it frequently yields overly
conservative inference results in practice. At present the inference
treats <code>*mut T</code> as invariant with respect to <code>T</code>: this is correct and
sound, because a <code>*mut</code> represents aliasable, mutable data, and indeed
the subtyping relation for <code>*mut T</code> is that <code>*mut T &lt;: *mut U if T=U</code>.</p>
<p>However, in practice, <code>*mut</code> pointers are often used to build safe
abstractions, the APIs of which do not in fact permit aliased
mutation. Examples are <code>Vec</code>, <code>Rc</code>, <code>HashMap</code>, and so forth. In all of
these cases, the correct variance is covariant – but because of the
conservative treatment of <code>*mut</code>, all of these types are being
inferred to an invariant result.</p>
<p>The complete solution to this seems to have two parts. First, for
convenience and abstraction, we should not be building safe
abstractions on raw <code>*mut</code> pointers anyway. We should have several
convenient newtypes in the standard library, like <code>ptr::Unique</code>, that
can be used, which would also help for handling OIBIT conditions and
<code>NonZero</code> optimizations. In my branch I have used the existing (but
unstable) type <code>ptr::Unique</code> for the primary role, which is kind of an
“unsafe box”. <code>Unique</code> should ensure that it is covariant with respect
to its argument.</p>
<p>However, this raises the question of how to implement <code>Unique</code> under
the hood, and what to do with <code>*mut T</code> in general. There are various
options:</p>
<ol>
<li>
<p>Change <code>*mut</code> so that it behaves like <code>*const</code>. This unfortunately
means that abstractions that introduce shared mutability have
a responsibility for add phantom data to that affect, something
like <code>PhantomData&lt;*const Cell&lt;T&gt;&gt;</code>. This seems non-obvious and
unnatural.</p>
</li>
<li>
<p>Rewrite safe abstractions to use <code>*const</code> (or even <code>usize</code>) instead
of <code>*mut</code>, casting to <code>*mut</code> only they have a <code>&amp;mut self</code>
method. This is probably the most conservative option.</p>
</li>
<li>
<p>Change variance to ignore <code>*mut</code> referents entirely. Add a lint to
detect types with a <code>*mut T</code> type and require some sort of explicit
marker that covers <code>T</code>. This is perhaps the most explicit
option. Like option 1, it creates the odd scenario that the
variance computation and subtyping relation diverge.</p>
</li>
</ol>
<p>Currently I lean towards option 2.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="0736-privacy-respecting-fru.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="0769-sound-generic-drop.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="0736-privacy-respecting-fru.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="0769-sound-generic-drop.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
