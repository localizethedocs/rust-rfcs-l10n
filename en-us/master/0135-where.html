<!DOCTYPE HTML>
<html lang="en_US" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0135-where - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-0060737d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Start Date: 2014-09-30</li>
<li>RFC PR #: https://github.com/rust-lang/rfcs/pull/135</li>
<li>Rust Issue #: https://github.com/rust-lang/rust/issues/17657</li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Add <code>where</code> clauses, which provide a more expressive means of
specifying trait parameter bounds. A <code>where</code> clause comes after a
declaration of a generic item (e.g., an impl or struct definition) and
specifies a list of bounds that must be proven once precise values are
known for the type parameters in question. The existing bounds
notation would remain as syntactic sugar for where clauses.</p>
<p>So, for example, the <code>impl</code> for <code>HashMap</code> could be changed from this:</p>
<pre><code>impl&lt;K:Hash+Eq,V&gt; HashMap&lt;K, V&gt;
{
    ..
}
</code></pre>
<p>to the following:</p>
<pre><code>impl&lt;K,V&gt; HashMap&lt;K, V&gt;
    where K : Hash + Eq
{
    ..
}
</code></pre>
<p>The full grammar can be found in the detailed design.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>The high-level bit is that the current bounds syntax does not scale to
complex cases. Introducing <code>where</code> clauses is a simple extension that
gives us a lot more expressive power. In particular, it will allow us
to refactor the operator traits to be in a convenient, multidispatch
form (e.g., so that user-defined mathematical types can be added to
<code>int</code> and vice versa). (It’s also worth pointing out that, once #5527
lands at least, implementing where clauses will be very little work.)</p>
<p>Here is a list of limitations with the current bounds syntax that are
overcome with the <code>where</code> syntax:</p>
<ul>
<li>
<p><strong>It cannot express bounds on anything other than type parameters.</strong>
Therefore, if you have a function generic in <code>T</code>, you can write
<code>T:MyTrait</code> to declare that <code>T</code> must implement <code>MyTrait</code>, but you
can’t write <code>Option&lt;T&gt; : MyTrait</code> or <code>(int, T) : MyTrait</code>. These
forms are less commonly required but still important.</p>
</li>
<li>
<p><strong>It does not work well with associated types.</strong> This is because
there is no space to specify the value of an associated type. Other
languages use <code>where</code> clauses (or something analogous) for this
purpose.</p>
</li>
<li>
<p><strong>It’s just plain hard to read.</strong> Experience has shown that as the
number of bounds grows, the current syntax becomes hard to read and
format.</p>
</li>
</ul>
<p>Let’s examine each case in detail.</p>
<h3 id="bounds-are-insufficiently-expressive"><a class="header" href="#bounds-are-insufficiently-expressive">Bounds are insufficiently expressive</a></h3>
<p>Currently bounds can only be declared on type parameters. But there
are situations where one wants to declare bounds not on the type
parameter itself but rather a type that includes the type parameter.</p>
<h4 id="partially-generic-types"><a class="header" href="#partially-generic-types">Partially generic types</a></h4>
<p>One situation where this occurs is when you want to write functions
where types are partially known and have those interact with other
functions that are fully generic. To explain the situation, let’s
examine some code adapted from rustc.</p>
<p>Imagine I have a table parameterized by a value type <code>V</code> and a key
type <code>K</code>. There are also two traits, <code>Value</code> and <code>Key</code>, that describe
the keys and values. Also, each type of key is linked to a specific
value:</p>
<pre><code>struct Table&lt;V:Value, K:Key&lt;V&gt;&gt; { ... }
trait Key&lt;V:Value&gt; { ... }
trait Value { ... }
</code></pre>
<p>Now, imagine I want to write some code that operates over all keys
whose value is an <code>Option&lt;T&gt;</code> for some <code>T</code>:</p>
<pre><code>fn example&lt;T,K:Key&lt;Option&lt;T&gt;&gt;&gt;(table: &amp;Table&lt;Option&lt;T&gt;, K&gt;) { ... }
</code></pre>
<p>This seems reasonable, but this code will not compile. The problem is
that the compiler needs to know that the value type implements
<code>Value</code>, but here the value type is <code>Option&lt;T&gt;</code>. So we’d need to
declare <code>Option&lt;T&gt; : Value</code>, which we cannot do.</p>
<p>There are workarounds. I might write a new trait <code>OptionalValue</code>:</p>
<pre><code>trait OptionalValue&lt;T&gt; {
    fn as_option&lt;'a&gt;(&amp;'a self) -&gt; &amp;'a Option&lt;T&gt;; // identity fn
}
</code></pre>
<p>and then I could write my example as:</p>
<pre><code>fn example&lt;T,O:OptionalValue&lt;T&gt;,K:Key&lt;O&gt;&gt;(table: &amp;Table&lt;O, K&gt;) { ... }
</code></pre>
<p>But this is making my example function, already a bit complicated,
become quite obscure.</p>
<h4 id="multidispatch-traits"><a class="header" href="#multidispatch-traits">Multidispatch traits</a></h4>
<p>Another situation where a similar problem is encountered is
<em>multidispatch traits</em> (aka, multiparameter type classes in Haskell).
The idea of a multidispatch trait is to be able to choose the impl
based not just on one type, as is the most common case, but on
multiple types (usually, but not always, two).</p>
<p>Multidispatch is rarely needed because the <em>vast</em> majority of traits
are characterized by a single type. But when you need it, you really
need it. One example that arises in the standard library is the traits
for binary operators like <code>+</code>. Today, the <code>Add</code> trait is defined using
only single-dispatch (like so):</p>
<pre><code>pub trait Add&lt;Rhs,Sum&gt; {
    fn add(&amp;self, rhs: &amp;Rhs) -&gt; Sum;
}
</code></pre>
<p>The expression <code>a + b</code> is thus sugar for <code>Add::add(&amp;a, &amp;b)</code>. Because
of how our trait system works, this means that only the type of the
left-hand side (the <code>Self</code> parameter) will be used to select the
impl. The type for the right-hand side (<code>Rhs</code>) along with the type of
their sum (<code>Sum</code>) are defined as trait parameters, which are always
<em>outputs</em> of the trait matching: that is, they are specified by the
impl and are not used to select which impl is used.</p>
<p>This setup means that addition is not as extensible as we would
like. For example, the standard library includes implementations of
this trait for integers and other built-in types:</p>
<pre><code>impl Add&lt;int,int&gt; for int { ... }
impl Add&lt;f32,f32&gt; for f32 { ... }
</code></pre>
<p>The limitations of this setup become apparent when we consider how a
hypothetical user library might integrate. Imagine a library L that
defines a type <code>Complex</code> representing complex numbers:</p>
<pre><code>struct Complex { ... }
</code></pre>
<p>Naturally, it should be possible to add complex numbers and integers.
Since complex number addition is commutative, it should be possible to
write both <code>1 + c</code> and <code>c + 1</code>. Thus one might try the following
impls:</p>
<pre><code>impl Add&lt;int,Complex&gt; for Complex { ... }     // 1. Complex + int
impl Add&lt;Complex,Complex&gt; for int { ... }     // 2. int + Complex
impl Add&lt;Complex,Complex&gt; for Complex { ... } // 3. Complex + Complex
</code></pre>
<p>Due to the coherence rules, however, this setup will not work. There
are in fact three errors. The first is that there are two impls of
<code>Add</code> defined for <code>Complex</code> (1 and 3). The second is that there are
two impls of <code>Add</code> defined for <code>int</code> (the one from the standard
library and 2). The final error is that impl 2 violates the orphan
rule, since the type <code>int</code> is not defined in the current crate.</p>
<p>This is not a new problem. Object-oriented languages, with their focus
on single dispatch, have long had trouble dealing with binary
operators. One common solution is double dispatch, an awkward but
effective pattern in which no type ever implements <code>Add</code>
directly. Instead, we introduce “indirection” traits so that, e.g.,
<code>int</code> is addable to anything that implements <code>AddToInt</code> and so
on. This is not my preferred solution so I will not describe it in
detail, but rather refer readers to <a href="http://smallcultfollowing.com/babysteps/blog/2012/10/04/refining-traits-slash-impls/">this blog post</a> where I
describe how it works.</p>
<p>An alternative to double dispatch is to define <code>Add</code> on tuple types
<code>(LHS, RHS)</code> rather than on a single value. Imagine that the <code>Add</code>
trait were defined as follows:</p>
<pre><code>trait Add&lt;Sum&gt; {
    fn add(self) -&gt; Sum;
}

impl Add&lt;int&gt; for (int, int) {
    fn add(self) -&gt; int {
        let (x, y) = self;
        x + y
    }
}
</code></pre>
<p>Now the expression <code>a + b</code> would be sugar for <code>Add::add((a, b))</code>.
This small change has several interesting ramifications. For one
thing, the library L can easily extend <code>Add</code> to cover complex numbers:</p>
<pre><code>impl Add&lt;Complex&gt; for (Complex, int)     { ... }
impl Add&lt;Complex&gt; for (int, Complex)     { ... }
impl Add&lt;Complex&gt; for (Complex, Complex) { ... }
</code></pre>
<p>These impls do not violate the coherence rules because they are all
applied to distinct types. Moreover, none of them violate the orphan
rule because each of them is a tuple involving at least one type local
to the library.</p>
<p>One downside of this <code>Add</code> pattern is that there is no way within the
trait definition to refer to the type of the left- or right-hand side
individually; we can only use the type <code>Self</code> to refer to the tuple of
both types. In the <em>Discussion</em> section below, I will introduce
an extended “multi-dispatch” pattern that addresses this particular
problem.</p>
<p>There is however another problem that where clauses help to
address. Imagine that we wish to define a function to increment
complex numbers:</p>
<pre><code>fn increment(c: Complex) -&gt; Complex {
    1 + c
}
</code></pre>
<p>This function is pretty generic, so perhaps we would like to
generalize it to work over anything that can be added to an int. We’ll
use our new version of the <code>Add</code> trait that is implemented over
tuples:</p>
<pre><code>fn increment&lt;T:...&gt;(c: T) -&gt; T {
    1 + c
}
</code></pre>
<p>At this point we encounter the problem. What bound should we give for
<code>T</code>?  We’d like to write something like <code>(int, T) : Add&lt;T&gt;</code> – that
is, <code>Add</code> is implemented for the tuple <code>(int, T)</code> with the sum type
<code>T</code>. But we can’t write that, because the current bounds syntax is too
limited.</p>
<p>Where clauses give us an answer. We can write a generic version of
<code>increment</code> like so:</p>
<pre><code>fn increment&lt;T&gt;(c: T) -&gt; T
    where (int, T) : Add&lt;T&gt;
{
    1 + c
}
</code></pre>
<h3 id="associated-types"><a class="header" href="#associated-types">Associated types</a></h3>
<p>It is unclear exactly what form associated types will have in Rust,
but it is <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.110.122">well documented</a> that our current design, in
which type parameters decorate traits, does not scale particularly
well. (For curious readers, there are <a href="http://www.smallcultfollowing.com/babysteps/blog/2013/04/02/associated-items/">several</a> <a href="http://www.smallcultfollowing.com/babysteps/blog/2013/04/03/associated-items-continued/">blog</a>
<a href="http://blog.pnkfx.org/blog/2013/04/22/designing-syntax-for-associated-items-in-rust/#background">posts</a> exploring the design space of associated types with
respect to Rust in particular.)</p>
<p>The high-level summary of associated types is that we can replace
a generic trait like <code>Iterator</code>:</p>
<pre><code>trait Iterator&lt;E&gt; {
    fn next(&amp;mut self) -&gt; Option&lt;E&gt;;
}
</code></pre>
<p>With a version where the type parameter is a “member” of the
<code>Iterator</code> trait:</p>
<pre><code>trait Iterator {
    type E;
    
    fn next(&amp;mut self) -&gt; Option&lt;E&gt;;
}
</code></pre>
<p>This syntactic change helps to highlight that, for any given type, the
type <code>E</code> is <em>fixed</em> by the impl, and hence it can be considered a
member (or output) of the trait. It also scales better as the number
of associated types grows.</p>
<p>One challenge with this design is that it is not clear how to convert
a function like the following:</p>
<pre><code>fn sum&lt;I:Iterator&lt;int&gt;&gt;(i: I) -&gt; int {
    ...    
}
</code></pre>
<p>With associated types, the reference <code>Iterator&lt;int&gt;</code> is no longer
valid, since the trait <code>Iterator</code> doesn’t have type parameters.</p>
<p>The usual solution to this problem is to employ a where clause:</p>
<pre><code>fn sum&lt;I:Iterator&gt;(i: I) -&gt; int
  where I::E == int
{
    ...    
}
</code></pre>
<p>We can also employ where clauses with object types via a syntax like
<code>&amp;Iterator&lt;where E=int&gt;</code> (admittedly somewhat wordy)</p>
<h3 id="readability"><a class="header" href="#readability">Readability</a></h3>
<p>When writing very generic code, it is common to have a large number of
parameters with a large number of bounds. Here is some example
function extracted from <code>rustc</code>:</p>
<pre><code>fn set_var_to_merged_bounds&lt;T:Clone + InferStr + LatticeValue,
                            V:Clone+Eq+ToStr+Vid+UnifyVid&lt;Bounds&lt;T&gt;&gt;&gt;(
                            &amp;self,
                            v_id: V,
                            a: &amp;Bounds&lt;T&gt;,
                            b: &amp;Bounds&lt;T&gt;,
                            rank: uint)
                            -&gt; ures;
</code></pre>
<p>Definitions like this are very difficult to read (it’s hard to even know
how to <em>format</em> such a definition).</p>
<p>Using a <code>where</code> clause allows the bounds to be separated from the list
of type parameters:</p>
<pre><code>fn set_var_to_merged_bounds&lt;T,V&gt;(&amp;self,
                                 v_id: V,
                                 a: &amp;Bounds&lt;T&gt;,
                                 b: &amp;Bounds&lt;T&gt;,
                                 rank: uint)
                                 -&gt; ures
    where T:Clone,         // it is legal to use individual clauses...
          T:InferStr,
          T:LatticeValue,
          V:Clone+Eq+ToStr+Vid+UnifyVid&lt;Bounds&lt;T&gt;&gt;, // ...or use `+`
{                                     
    ..
}
</code></pre>
<p>This helps to separate out the function signature from the extra
requirements that the function places on its types.</p>
<p>If I may step aside from the “impersonal voice” of the RFC for a
moment, I personally find that when writing generic code it is helpful
to focus on the types and signatures, and come to the bounds
later. Where clauses help to separate these distinctions. Naturally,
your mileage may vary. - nmatsakis</p>
<h2 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h2>
<h3 id="where-can-where-clauses-appear"><a class="header" href="#where-can-where-clauses-appear">Where can where clauses appear?</a></h3>
<p>Where clauses can be added to anything that can be parameterized with
type/lifetime parameters with the exception of trait method
definitions: <code>impl</code> declarations, <code>fn</code> declarations, and <code>trait</code> and
<code>struct</code> definitions. They appear as follows:</p>
<pre><code>impl Foo&lt;A,B&gt;
    where ...
{ }

impl Foo&lt;A,B&gt; for C
    where ...
{ }

impl Foo&lt;A,B&gt; for C
{
    fn foo&lt;A,B&gt; -&gt; C
        where ...
    { }
}

fn foo&lt;A,B&gt; -&gt; C
    where ...
{ }

struct Foo&lt;A,B&gt;
    where ...
{ }

trait Foo&lt;A,B&gt; : C
    where ...
{ }
</code></pre>
<h4 id="where-clauses-cannot-yet-appear-on-trait-methods"><a class="header" href="#where-clauses-cannot-yet-appear-on-trait-methods">Where clauses cannot (yet) appear on trait methods</a></h4>
<p>Note that trait method definitions were specifically excluded from the
list above. The reason is that including where clauses on a trait
method raises interesting questions for what it means to implement the
trait. Using where clauses it becomes possible to define methods that
do not necessarily apply to all implementations. We intend to enable
this feature but it merits a second RFC to delve into the details.</p>
<h3 id="where-clause-grammar"><a class="header" href="#where-clause-grammar">Where clause grammar</a></h3>
<p>The grammar for a <code>where</code> clause would be as follows (BNF):</p>
<pre><code>WHERE = 'where' BOUND { ',' BOUND } [,]
BOUND = TYPE ':' TRAIT { '+' TRAIT } [+]
TRAIT = Id [ '&lt;' [ TYPE { ',' TYPE } [,] ] '&gt;' ]
TYPE  = ... (same type grammar as today)
</code></pre>
<h3 id="semantics"><a class="header" href="#semantics">Semantics</a></h3>
<p>The meaning of a where clause is fairly straightforward. Each bound in
the where clause must be proven by the caller after substitution of
the parameter types.</p>
<p>One interesting case concerns trivial where clauses where the
self-type does not refer to any of the type parameters, such as the
following:</p>
<pre><code>fn foo()
    where int : Eq
{ ... }
</code></pre>
<p>Where clauses like these are considered an error. They have no
particular meaning, since the callee knows all types involved. This is
a conservative choice: if we find that we do desire a particular
interpretation for them, we can always make them legal later.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<p>This RFC introduces two ways to declare a bound.</p>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<p><strong>Remove the existing trait bounds.</strong> I decided against this both to
avoid breaking lots of existing code and because the existing syntax
is convenient much of the time.</p>
<p><strong>Embed where clauses in the type parameter list.</strong> One alternative
syntax that was proposed is to embed a where-like clause in the type
parameter list. Thus the <code>increment()</code> example</p>
<pre><code>fn increment&lt;T&gt;(c: T) -&gt; T
    where () : Add&lt;int,T,T&gt;
{
    1 + c
}
</code></pre>
<p>would become something like:</p>
<pre><code>fn increment&lt;T, ():Add&lt;int,T,T&gt;&gt;(c: T) -&gt; T
{
    1 + c
}
</code></pre>
<p>This is unfortunately somewhat ambiguous, since a bound like <code>T:Eq</code>
could either be declared a type parameter <code>T</code> or as a condition that
the (existing) type <code>T</code> implement <code>Eq</code>.</p>
<p><strong>Use a colon instead of the keyword.</strong> There is some precedent for
this from the type state days. Unfortunately, it doesn’t work with
traits due to the supertrait list, and it also doesn’t look good with
the use of <code>:</code> as a trait-bound separator:</p>
<pre><code>fn increment&lt;T&gt;(c: T) -&gt; T
    : () : Add&lt;int,T,T&gt;
{
    1 + c
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="0132-ufcs.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="0136-no-privates-in-public.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="0132-ufcs.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="0136-no-privates-in-public.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
