<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2535-or-patterns - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-b61d75f0.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Feature Name: <code>or_patterns</code></li>
<li>Start Date: 2018-08-29</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/2535">rust-lang/rfcs#2535</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/54883">rust-lang/rust#54883</a></li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Allow <code>|</code> to be arbitrarily nested within a pattern such that <code>Some(A(0) | B(1 | 2))</code> becomes a valid pattern.</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>Nothing this RFC proposes adds anything with respect to expressive power. Instead, the aim is to make the power we already have more easy to wield. For example, we wish to improve ergonomics, readability, and the mental model.</p>
<h3 id="dont-repeat-yourself"><a class="header" href="#dont-repeat-yourself">Don’t repeat yourself</a></h3>
<p>Consider an example match arm such as (1):</p>
<pre><code class="language-rust">Some(Enum::A) | Some(Enum::B) | Some(Enum::C) | Some(Enum::D) =&gt; ..</code></pre>
<p>Here, we are repeating <code>Some($pat)</code> three times.</p>
<p>Compare (1) to how we could have written this with this RFC (2):</p>
<pre><code class="language-rust">Some(Enum::A | Enum::B | Enum::C | Enum::D) =&gt; ..</code></pre>
<p>We can see that this is clearly shorter and that the amount of extra work we have to do scales linearly with the number of inner variants we mention. The ability to nest patterns in this way therefore results in improved writing ergonomics.</p>
<h3 id="mental-model"><a class="header" href="#mental-model">Mental model</a></h3>
<p>However, as we know, code is read more than it is written. So are we trading readability for increased ergonomics? We believe this is not the case. Instead, this RFC aims to improve the readability of code by reducing the amount of redundant information that needs to be scanned.</p>
<p>In addition, we aim to more closely align Rust with the mental model that <em>humans</em> have and how we usually speak and communicate.</p>
<p>Consider that you wanted to ask someone what the <em>colour</em> of their <em>car</em> was. Would you be more inclined to ask:</p>
<blockquote>
<p>Is your car red, white, or blue?</p>
</blockquote>
<p>Or would you instead ask:</p>
<blockquote>
<p>Is your car red, your car white, or your car blue?</p>
</blockquote>
<p>When researching for this RFC; many people were asked and all of them preferred the first alternative. This user testing was done on both programmers and non-programmers alike and included speakers of: English, German (2) Swedish (3), French (2), Portuguese (1), Spanish (2), Farsi (3), Finnish (1), Esperanto (1), and Japanese (1).</p>
<p>Thus, we conjecture that it’s more common for humans to not distribute and to instead use something akin to <em>conjunctive normal form</em> (<a href="https://en.wikipedia.org/wiki/Conjunctive_normal_form">CNF</a>) when communicating. A likely consequence of this is that a common way to understand snippet (1) formulated in <em>disjunctive normal form</em> (<a href="https://en.wikipedia.org/wiki/Disjunctive_normal_form">DNF</a>) is to first mentally reconstruct it into CNF and then understand the implications of the pattern.</p>
<p>By allowing users to encode their logic in the way they think instead of going through more indirect routes, we can improve the understandability of code.</p>
<h3 id="reducing-complexity-with-uniformity"><a class="header" href="#reducing-complexity-with-uniformity">Reducing complexity with uniformity</a></h3>
<p>A principal way in which programming languages accumulate complexity is by adding more and more rules that a programmer needs to keep in their head to write or understand what a program does. A consequence of this is that often times, caveats and corner cases make for a language that is harder to learn, understand, and write in. To avoid such caveats, it is thus imperative that we should try to keep the language more uniform rather than less. This is an important means through which it becomes possible to give users more expressiveness but at the same time limit the cost each feature takes from our complexity budget.</p>
<p>With this RFC, we try to reduce the complexity of the language by extending a feature which already exists, and which many users already know about, to another place. In a sense, giving the user more capabilities results in a negative increase in complexity.</p>
<p>In concrete terms, where before we only allowed a pattern of the form <code>pat | pat</code> at the top level of <code>match</code> and <a href="https://github.com/rust-lang/rfcs/pull/2175">similar constructs</a>, which special cased the language, we now allow <code>pat | pat</code> anywhere a pattern may occur whereby we simplify the ruleset of the language. In fact, there are already users that try this expecting it to work but then find out that it does not.</p>
<p>Furthermore, allowing <code>pat | pat</code> in the pattern grammar also allows macros to produce disjunctions such as <code>$p | $q</code>.</p>
<h3 id="real-world-use-cases"><a class="header" href="#real-world-use-cases">Real world use cases</a></h3>
<p>This RFC wouldn’t be complete without concrete use cases which it would facilitate. While there are not an overabundance of cases where <code>pat | pat</code> would help, there are some where it would. Let’s go through a few of them.</p>
<ol>
<li>
<p>One example which was raised in the <a href="https://github.com/rust-lang/rfcs/blob/de235887a80555427314c7eb25c6214523d50cce/text/0000-pipe-in-patterns.md">precursor</a> to this RFC was building a state machine which is iterating through <code>chars_indices</code>:</p>
<pre><code class="language-rust">match iter.next() {
    Some(_, ' ' | '\n' | '\r' | '\u{21A1}') =&gt; {
        // Change state
    }
    Some(index, ch) =&gt; {
        // Look at char
    }
    None =&gt; return Err(Eof),
}</code></pre>
</li>
<li>
<p>Other examples are listed in the equivalent <a href="https://github.com/osa1/ghc-proposals/blob/77ee8e615aa28fbf2d0ef2be876a852c4e63c53b/proposals/0000-or-patterns.rst#real-world-examples">GHC proposal</a>.</p>
</li>
<li>
<p>Another example which was provided in the <a href="https://github.com/rust-lang/rfcs/blob/de235887a80555427314c7eb25c6214523d50cce/text/0000-pipe-in-patterns.md">precursor</a> RFC was:</p>
<pre><code class="language-rust">for event in event_pump.poll_iter() {
    use sdl2::event::Event;
    use sdl2::keyboard::Keycode::{Escape, Q};
    match event {
        Event::KeyDown { keycode: Some(Escape | Q), ... } =&gt; break 'game,
        _ =&gt; {},
    }
    ...
}</code></pre>
</li>
<li>
<p>Other cases where this feature was requested include:</p>
<ul>
<li><a href="https://github.com/rust-lang/rust/issues/15219">https://github.com/rust-lang/rust/issues/15219</a></li>
<li><a href="https://github.com/rust-lang/rust/issues/14516">https://github.com/rust-lang/rust/issues/14516</a></li>
</ul>
</li>
<li>
<p>Another use case due to <a href="https://discordapp.com/channels/442252698964721669/448237931136679936/483325957130813440">@alercah</a> is:</p>
<pre><code class="language-rust">pub fn is_green(self) -&gt; bool {
    match self {
        | Tile::Suited(Suit::Souzu, 2 | 3 | 4 | 6 | 8)
        | Tile::Dragon(Dragon::Green) =&gt; true,
        _ =&gt; false,
    }
}</code></pre>
</li>
<li>
<p>Some further examples found with sourcegraph include:</p>
<p>From <a href="https://github.com/alexcrichton/cc-rs/blob/74ce606aa227a30a97d7c1990c1e8d322e01c6d8/src/lib.rs#L1307-L1319">cc-rs</a>:</p>
<pre><code class="language-rust"> match (self.cpp_set_stdlib.as_ref(), cmd.family) {
     (None, _) =&gt; {}
     (Some(stdlib), ToolFamily::Gnu | ToolFamily::Clang) =&gt; {
         cmd.push_cc_arg(format!("-stdlib=lib{}", stdlib).into());
     }
     _ =&gt; {
         ...
     }
 }</code></pre>
<p>From <a href="https://github.com/capnproto/capnproto-rust/blob/35027494bb6e741aa478597358bac8ac92108a30/capnp/src/private/layout.rs#L1979-L2002">capnproto</a>:</p>
<pre><code class="language-rust">// Check whether the size is compatible.
match expected_element_size {
    None | Some(Void | InlineComposite) =&gt; (),
    Some(Bit) =&gt; { ... }
    Some(Byte | TwoBytes | FourBytes | EightBytes) =&gt; { ... },
    ...
}</code></pre>
<p>From <a href="https://github.com/chronotope/chrono/blob/94b43fa2e8bd43e7f42bb5b67afd1c3415b27683/src/format/parsed.rs#L271-L308">chrono</a>:</p>
<pre><code class="language-rust">fn resolve_year(y: Option&lt;i32&gt;, q: Option&lt;i32&gt;,
                r: Option&lt;i32&gt;) -&gt; ParseResult&lt;Option&lt;i32&gt;&gt; {
    match (y, q, r) {
        (y, None, None) =&gt; Ok(y),
        (Some(y), q, r @ (Some(0...99) | None)) =&gt; { ... },
        ...
    }
}</code></pre>
<p>From maidsafe’s <a href="https://github.com/maidsafe/routing/blob/0081a48d59e4fe3fb86b20da1fceb8f757855112/src/states/node.rs#L2138-L2180">routing</a>:</p>
<pre><code class="language-rust">match self.peer_mgr.connection_info_received(...) {
    ...,
    Ok(IsProxy | IsClient | IsJoiningNode) =&gt; { ... },
    Ok(Waiting | IsConnected) | Err(_) =&gt; (),
}</code></pre>
<p>Also from <a href="https://github.com/maidsafe/routing/blob/0081a48d59e4fe3fb86b20da1fceb8f757855112/src/states/node.rs#L2215-L2245">routing</a>:</p>
<pre><code class="language-rust">     match self.peer_mgr.connection_info_received(...) {
         Ok(Ready(our_info, their_info)) =&gt; { ... }
         Ok(Prepare(_) | IsProxy | IsClient | IsJoiningNode) =&gt; { ... }
         Ok(Waiting | IsConnected) | Err(_) =&gt; (),
     }
</code></pre>
<p>From <a href="https://github.com/redox-os/termion/blob/d2945cd36c452824aeabd5d7c13980d9567eb8a2/src/input.rs#L143-L153">termion</a>:</p>
<pre><code class="language-rust">for c in self.bytes() {
    match c {
        Err(e) =&gt; return Err(e),
        Ok(0 | 3 | 4) =&gt; return Ok(None),
        Ok(0x7f) =&gt; { buf.pop(); }
        Ok(b'\n' | b'\r') =&gt; break,
        Ok(c) =&gt; buf.push(c),
    }
}</code></pre>
</li>
<li>
<p>Some other use cases are:</p>
<p>In code using git2-rs:</p>
<pre><code class="language-rust">match obj.kind() {
    Some(Commit | Tag | Tree) =&gt; ...
    Some(Blob) =&gt; ...
    None =&gt; ...
}</code></pre>
<p>From <a href="https://salsa.debian.org/rust-team/debcargo/blob/4355097810264644cb08ddaa8f7464d5887275f1/src/debian/dependency.rs#L234-291">debcargo</a>:</p>
<pre><code class="language-rust">match (op, &amp;mmp.clone()) {
    (&amp;Lt, &amp;(M(0) | MM(0, 0) | MMP(0, 0, 0))) =&gt; debcargo_bail!(
        "Unrepresentable dependency version predicate: {} {:?}",
        dep.name(),
        p
    ),
    (&amp;Tilde, &amp;(M(_) | MM(_, _))) =&gt; {
        vr.constrain_lt(mmp.inclast());
        vr.constrain_ge(mmp);
    }
    (&amp;Compatible, &amp;(MMP(0, minor, _) | MM(0, minor))) =&gt; {
        vr.constrain_lt(MM(0, minor + 1));
        vr.constrain_ge(mmp);
    }
    (&amp;Compatible, &amp;(MMP(major, _, _) | MM(major, _) | M(major))) =&gt; {
        vr.constrain_lt(M(major + 1));
        vr.constrain_ge(mmp);
    }
    ...,
}</code></pre>
</li>
<li>
<p>From rustc, we have:</p>
<p>In <code>src/librustc_mir/interpret/eval_context.rs</code>:</p>
<pre><code class="language-rust">Some(Def::Static(..) | Def::Const(..) | Def::AssociatedConst(..)) =&gt; {},</code></pre>
<p>In <code>src/librustc_mir/util/borrowck_errors.rs</code>:</p>
<pre><code class="language-rust">(&amp;ty::TyArray(_, _), Some(true) | None) =&gt; "array",</code></pre>
<p>In <code>src/librustc/middle/reachable.rs</code>:</p>
<pre><code class="language-rust">Some(Def::Local(node_id) | Def::Upvar(node_id, ..)) =&gt; { .. }</code></pre>
<p>In <code>src/librustc/infer/error_reporting/mod.rs</code>:</p>
<pre><code class="language-rust">Some(hir_map::NodeBlock(_) | hir_map::NodeExpr(_)) =&gt; "body",</code></pre>
<p>In <code>src/libfmt_macros/lib.rs</code>:</p>
<pre><code class="language-rust">Some((_, '&gt;' | '&lt;' | '^')) =&gt; { .. }</code></pre>
<p>In <code>src/librustc/traits/select.rs</code>:</p>
<pre><code class="language-rust">ty::TyInfer(ty::IntVar(_) | ty::FloatVar(_)) | .. =&gt; { .. }</code></pre>
<p>In <code>src/librustc_typeck/check/mod.rs</code>:</p>
<pre><code class="language-rust">ty::TyInt(ast::IntTy::I8 | ast::IntTy::I16) | ty::TyBool =&gt; { .. }

...

ty::TyUint(ast::UintTy::U8 | ast::UintTy::U16) =&gt; { .. }</code></pre>
<p>In <code>src/tools/cargo/src/cargo/sources/path.rs</code>:</p>
<pre><code class="language-rust">Some("Cargo.lock" | "target") =&gt; continue,</code></pre>
<p>In <code>src/libsyntax_ext/format_foreign.rs</code>:</p>
<pre><code class="language-rust">('h' | 'l' | 'L' | 'z' | 'j' | 't' | 'q', _) =&gt; {
    state = Type;
    length = Some(at.slice_between(next).unwrap());
    move_to!(next);
},

...

let width = match self.width {
    Some(Num::Next) =&gt; {
        // NOTE: Rust doesn't support this.
        return None;
    }
    w @ Some(Num::Arg(_) | Num::Num(_)) =&gt; w,
    None =&gt; None,
};</code></pre>
<p>In <code>src/libsyntax/parse/token.rs</code>:</p>
<pre><code class="language-rust">BinOp(Minus | Star | Or | And) | OrOr =&gt; true,</code></pre>
</li>
</ol>
<h2 id="guide-level-explanation"><a class="header" href="#guide-level-explanation">Guide-level explanation</a></h2>
<p>Simply put, <code>$p | $q</code> where <code>$p</code> and <code>$q</code> are some patterns is now itself a legal pattern.</p>
<p>This means that you may for example write:</p>
<pre><code class="language-rust">enum Foo&lt;T&gt; {
    Bar,
    Baz,
    Quux(T),
}

fn main() {
    match Some(Foo::Bar) {
        Some(Foo::Bar | Foo::Baz) =&gt; { .. },
        _ =&gt; { .. },
    }
}</code></pre>
<p>Because <code>$p | $q</code> is itself a pattern, this means that you can nest arbitrarily:</p>
<pre><code class="language-rust">fn main() {
    match Some(Foo::Bar) {
        Some(Foo::Bar | Foo::Quux(0 | 1 | 3)) =&gt; { .. },
        _ =&gt; { .. }
    }
}</code></pre>
<p>Note that the operator <code>|</code> has a low precedence. This means that if you want the same outcome as <code>foo @ 1 | foo @ 2 | foo @ 3</code>, you have to write <code>foo @ (1 | 2 | 3)</code> instead of writing <code>foo @ 1 | 2 | 3</code>. This is discussed in the <a href="#rationale-and-alternatives">rationale</a>.</p>
<p>You can also use <code>p | q</code> in:</p>
<ol>
<li>
<p><code>if let</code> expressions:</p>
<pre><code class="language-rust">if let Foo::Bar | Foo::Quux(1 | 2) = some_computation() {
    ...
}</code></pre>
</li>
<li>
<p><code>while let</code> expressions:</p>
<pre><code class="language-rust">while let Ok(1 | 2) | Err(3) = different_computation() {
    ...
}</code></pre>
</li>
<li>
<p><code>let</code> statements:</p>
<pre><code class="language-rust">let Ok(x) | Err(x) = another_computation();</code></pre>
<p>In this case, the pattern must be irrefutable as <code>Ok(x) | Err(x)</code> is.</p>
</li>
<li>
<p><code>fn</code> arguments:</p>
<pre><code class="language-rust">fn foo((Ok(x) | Err(x)): Result&lt;u8, u8&gt;) {
    ...
}</code></pre>
<p>Here too, the pattern must be irrefutable.</p>
</li>
<li>
<p>closure arguments:</p>
<pre><code class="language-rust">let closure = |(Ok(x) | Err(x))| x + 1;</code></pre>
<p>Notice that in this case, we have to wrap the pattern in parenthesis. This restriction is currently enforced to avoid backtracking but may possibly be lifted in the future based on other developments in the grammar.</p>
</li>
<li>
<p>macros by example:</p>
<pre><code class="language-rust">macro_rules! foo {
    ($p:pat) =&gt; { ... }
}

foo!((Ok(x) | Err(x)));</code></pre>
<p>Here we must wrap the pattern in parenthesis since <code>$p:pat | $q:pat</code> is already legal in patterns.</p>
</li>
</ol>
<h2 id="reference-level-explanation"><a class="header" href="#reference-level-explanation">Reference-level explanation</a></h2>
<h3 id="grammar"><a class="header" href="#grammar">Grammar</a></h3>
<p>We parameterize the <code>pat</code> grammar by the choice whether to allow top level <code>pat | pat</code>. We then change the pattern grammar to:</p>
<pre><code class="language-rust">pat&lt;allow_top_alt&gt;
: pat&lt;allow_top_alt&gt; '|' pat&lt;allow_top_alt&gt;
| ...
;

pat&lt;no_top_alt&gt;
: "(" pat&lt;allow_top_alt&gt; ")"
| ...
;</code></pre>
<p>Here <code>|</code> has the lowest precedence. In particular, the operator <code>@</code> binds more tightly than <code>|</code> does. Thus, <code>i @ p | q</code> associates as <code>(i @ p) | q</code> as opposed to <code>i @ (p | q)</code>.</p>
<p>Note: <code>pat&lt;T&gt;</code> does not entail that the grammar of Rust is context sensitive because we “monomorphize” the parameterization below.</p>
<p>We then introduce a production:</p>
<pre><code class="language-rust">top_pat : '|'? pat&lt;allow_top_alt&gt; ;</code></pre>
<p>We then change the grammar of <code>let</code> statements to (as compared to <a href="https://github.com/rust-lang/rfcs/pull/2175">RFC 2175</a>):</p>
<pre><code class="language-rust">let : LET top_pat maybe_ty_ascription maybe_init_expr ';' ;</code></pre>
<p>We change the grammar of <code>if let</code> expressions to:</p>
<pre><code class="language-rust">expr_if_let : IF LET top_pat '=' expr_nostruct block (ELSE block_or_if)? ;</code></pre>
<p>And for <code>while let</code> expressions:</p>
<pre><code class="language-rust">expr_while_let : maybe_label WHILE LET top_pat '=' expr_nostruct block ;</code></pre>
<p>For <code>for</code> loop expressions we now have:</p>
<pre><code class="language-rust">expr_for : maybe_label FOR top_pat IN expr_nostruct block ;</code></pre>
<p>For <code>match</code> expressions we now have:</p>
<pre><code class="language-rust">expr_match : MATCH expr_nostruct '{' match_clause* nonblock_match_clause? '}' ;
match_clause : nonblock_match_clause ',' | block_match_clause ','? ;
nonblock_match_clause : match_arm (nonblock_expr | block_expr_dot) ;
block_match_clause : match_arm (block | block_expr) ;

match_arm : maybe_outer_attrs top_pat (IF expr_nostruct)? FAT_ARROW ;</code></pre>
<p>In other words, in all of the contexts where a pattern is currently accepted, the compiler will now accept pattern alternations of form <code>p | q</code> where <code>p</code> and <code>q</code> are arbitrary patterns.</p>
<p>For the patterns of <code>fn</code> arguments we now have:</p>
<pre><code class="language-rust">param : pat&lt;no_top_alt&gt; ':' ty_sum ;</code></pre>
<p>For closures we now have:</p>
<pre><code class="language-rust">inferable_param : pat&lt;no_top_alt&gt; maybe_ty_ascription ;</code></pre>
<p>Finally, <code>pat</code> macro fragment specifiers will also match the <code>pat&lt;no_top_alt&gt;</code> production as opposed to <code>pat&lt;allow_top_alt&gt;</code>.</p>
<h4 id="error-messages"><a class="header" href="#error-messages">Error messages</a></h4>
<p>As previously noted, the precedence of the operator <code>|</code> is lower than that of the operator <code>@</code>. This results in <code>i @ p | q</code> being interpreted as <code>(i @ p) | q</code>. In turn, this would result in an error because <code>i</code> is not defined in all alternations. An example:</p>
<pre><code class="language-rust">fn main() {
    match 1 {
        i @ 0 | 1 =&gt; {},
    }
}</code></pre>
<p>This would result in:</p>
<pre><code class="language-rust">error[E0408]: variable `i` is not bound in all patterns
 --&gt; src/main.rs:3:17
  |
3 |         i @ 0 | 1 =&gt; {},
  |         -       ^ pattern doesn't bind `i`
  |         |
  |         variable not in all patterns</code></pre>
<p>However, it is quite likely that a user who wrote <code>i @ p | q</code> wanted the semantics of <code>i @ (p | q)</code> because it would be the only thing that would be a well formed pattern. To guide the user on the way, we recommend special casing the error message for such circumstances with for example:</p>
<pre><code class="language-rust">error[E0408]: variable `i` is not bound in all patterns
 --&gt; src/main.rs:3:17
  |
3 |         i @ 0 | 1 =&gt; {},
  |         -       ^ pattern doesn't bind `i`
  |         |
  |         variable not in all patterns
  |
  | hint: if you wanted `i` to cover both cases, try adding parentheses around:
  |
  |         i @ 0 | 1
  |             ^^^^^</code></pre>
<p>The particular design of such an error message is left open to implementations.</p>
<h3 id="static-semantics"><a class="header" href="#static-semantics">Static semantics</a></h3>
<ol>
<li>
<p>Given a pattern <code>p | q</code> at some depth for some arbitrary patterns <code>p</code> and <code>q</code>, the pattern is considered ill-formed if:</p>
<ul>
<li>the type inferred for <code>p</code> does not unify with the type inferred for <code>q</code>, or</li>
<li>the same set of bindings are not introduced in <code>p</code> and <code>q</code>, or</li>
<li>the type of any two bindings with the same name in <code>p</code> and <code>q</code> do not unify with respect to types or binding modes.
Unification of types is in all instances aforementioned exact and implicit <a href="https://doc.rust-lang.org/reference/type-coercions.html">type coercions</a> do not apply.</li>
</ul>
</li>
<li>
<p>When type checking an expression <code>match e_s { a_1 =&gt; e_1, ... a_n =&gt; e_n }</code>, for each match arm <code>a_i</code> which contains a pattern of form <code>p_i | q_i</code>, the pattern <code>p_i | q_i</code> is considered ill formed if, at the depth <code>d</code> where it exists the fragment of <code>e_s</code> at depth <code>d</code>, the type of the expression fragment does not unify with <code>p_i | q_i</code>.</p>
</li>
<li>
<p>With respect to exhaustiveness checking, a pattern <code>p | q</code> is considered to cover <code>p</code> as well as <code>q</code>. For some constructor <code>c(x, ..)</code> the distributive law applies such that <code>c(p | q, ..rest)</code> covers the same set of value as <code>c(p, ..rest) | c(q, ..rest)</code> does. This can be applied recursively until there are no more nested patterns of form <code>p | q</code> other than those that exist at the top level.</p>
<p>Note that by <em>“constructor”</em> we do not refer to tuple struct patterns, but rather we refer to a pattern for any product type. This includes enum variants, tuple structs, structs with named fields, arrays, tuples, and slices.</p>
</li>
</ol>
<h3 id="dynamic-semantics"><a class="header" href="#dynamic-semantics">Dynamic semantics</a></h3>
<ol>
<li>The dynamic semantics of pattern matching a scrutinee expression <code>e_s</code> against a pattern <code>c(p | q, ..rest)</code> at depth <code>d</code> where <code>c</code> is some constructor, <code>p</code> and <code>q</code> are arbitrary patterns, and <code>rest</code> is optionally any remaining potential factors in <code>c</code>, is defined as being the same as that of <code>c(p, ..rest) | c(q, ..rest)</code>.</li>
</ol>
<h3 id="implementation-notes"><a class="header" href="#implementation-notes">Implementation notes</a></h3>
<p>With respect to both static and dynamic semantics, it is always valid to first desugar a pattern <code>c(p | q)</code> in CNF to its equivalent form in DNF, i.e. <code>c(p) | c(q)</code>.</p>
<p>However, implementing <code>c(p | q)</code> in terms of a pure desugaring to <code>c(p) | c(q)</code> may not be optimal as the desugaring can result in multiplicative blow-up of patterns. An example of such blow up can be seen with:</p>
<pre><code class="language-rust">match expr {
    (0 | 1, 0 | 1, 0 | 1, 0 | 1) =&gt; { ... },
}</code></pre>
<p>If we expanded this naively to DNF we would get:</p>
<pre><code class="language-rust">match expr {
    | (0, 0, 0, 0)
    | (0, 0, 0, 1)
    | (0, 0, 1, 0)
    | (0, 0, 1, 1)
    | (0, 1, 0, 0)
    | (0, 1, 0, 1)
    | (0, 1, 1, 0)
    | (0, 1, 1, 1)
    | (1, 0, 0, 0)
    | (1, 0, 0, 1)
    | (1, 0, 1, 0)
    | (1, 0, 1, 1)
    | (1, 1, 0, 0)
    | (1, 1, 0, 1)
    | (1, 1, 1, 0)
    | (1, 1, 1, 1)
    =&gt; { ... },
}</code></pre>
<p>Instead, it is more likely that a one-step case analysis will be more efficient.</p>
<p>Which implementation technique to use is left open to each Rust compiler.</p>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<ol>
<li>Some parsers will have to be rewritten by a tiny bit; We do this with any syntactic change in the language so there should not be any problem.</li>
</ol>
<h2 id="rationale-and-alternatives"><a class="header" href="#rationale-and-alternatives">Rationale and alternatives</a></h2>
<p>As for why the change as proposed in this RFC should be done, it is discussed in the <a href="#motivation">motivation</a>.</p>
<h3 id="syntax"><a class="header" href="#syntax">Syntax</a></h3>
<p>Since we already use <code>|</code> for alternation at the top level, the only consistent operator syntax for alternations in nested patterns would be <code>|</code>. Therefore, there are not many design choices to make with respect to <em>how</em> this change should be done rather than <em>if</em>.</p>
<h3 id="precedence"><a class="header" href="#precedence">Precedence</a></h3>
<p>With respect to the precedence of <code>|</code>, we cannot interpret <code>i @ p | q</code> as <code>i @ (p | q)</code> because it is already legal to write <code>i @ p | j @ q</code> at the top level of a pattern. Therefore, if we say that <code>|</code> binds more tightly, then <code>i @ p | j @ q</code> will associate as <code>i @ (p | j @ q)</code> which as a different meaning than what we currently have, thus causing a breaking change.</p>
<p>And even if we could associate <code>i @ p | q</code> as <code>i @ (p | q)</code> there is a good reason why we should not. Simply put, we should understand <code>@</code> as a pattern / set intersection operator and the operator <code>|</code> as the union operator. This is analogous to multiplication and addition as well as conjunction and disjunction in logic. In these fields, it is customary for multiplication and conjunction to bind more tightly. That is, we interpret <code>a * b + c</code> as <code>(a * b) + c</code> and not <code>a * (b + c)</code>. Similarly, we interpret <code>p ∧ q ∨ r</code> as <code>(p ∧ q) ∨ r</code> and not <code>p ∧ (q ∨ r)</code>.</p>
<h3 id="leading-"><a class="header" href="#leading-">Leading <code>|</code></a></h3>
<p>The only real choice that we do have to make is whether the new addition to the pattern grammar should be <code>pat : .. | pat "|" pat ;</code> or if it instead should be <code>pat : .. | "|"? pat "|" pat ;</code>. We have chosen the former for 4 reasons:</p>
<ol>
<li>
<p>If we chose the former we can later change to the latter but not vice versa. This is thus the conservative choice.</p>
</li>
<li>
<p>There is precedent for such a decision due to <a href="#ocaml">OCaml</a>.</p>
</li>
<li>
<p>The benefit to macros is dubious as they don’t have to produce leading alternations.</p>
</li>
<li>
<p>Leading alternations inside patterns is considered poor style.</p>
</li>
</ol>
<p>However, there is one notable advantage to permitting leading <code>|</code> in nested pattern:</p>
<ol>
<li>Libraries or tools such as <code>syn</code> will have <em>slightly</em> easier time parsing the grammar of Rust.</li>
</ol>
<h3 id="fn-arguments"><a class="header" href="#fn-arguments"><code>fn</code> arguments</a></h3>
<p>In this RFC, we allow <code>p | q</code> inside patterns of <code>fn</code> arguments. The rationale for this is simply consistency with <code>let</code> which also permit these and did so before this RFC at the top level with <a href="https://github.com/rust-lang/rfcs/pull/2175">RFC 2175</a>.</p>
<h3 id="macros-and-closures"><a class="header" href="#macros-and-closures">Macros and closures</a></h3>
<p>See the section on <a href="#unresolved-questions">unresolved</a> questions for a brief discussion.</p>
<h2 id="prior-art"><a class="header" href="#prior-art">Prior art</a></h2>
<h3 id="css4-selectors"><a class="header" href="#css4-selectors">CSS4 selectors</a></h3>
<p>In <a href="https://drafts.csswg.org/selectors/#matches">CSS4</a> (draft proposal), it is possible to write a selector <code>div &gt; *:matches(ul, ol)</code> which is equivalent to <code>div &gt; ul, div &gt; ol</code>. The moral equivalent of this in Rust would be: <code>Div(Ul | Ol)</code>.</p>
<h3 id="regular-expressions"><a class="header" href="#regular-expressions">Regular expressions</a></h3>
<p>Most <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expression</a> formalisms support at least the following operations (where <code>a</code>, <code>b</code>, and <code>c</code> are arbitrary regexes):</p>
<ul>
<li>
<p>Concatenation: <em>“<code>a</code> followed by <code>b</code>”</em>. Commonly written by just saying <code>ab</code>.</p>
</li>
<li>
<p>Alternation: <em>“first match <code>a</code> or otherwise match <code>b</code>”</em> Commonly written as <code>a | b</code>. <code>|</code> binds more loosely than concatenation.</p>
</li>
<li>
<p>Grouping: used to define the scope of what operators apply to. Commonly written as <code>(a)</code>.</p>
</li>
</ul>
<p>Formally, the minimal formalism we need is:</p>
<pre><code class="language-rust">pat : terminal | pat pat | pat "|" pat | "(" pat ")" ;</code></pre>
<p>Given this formalism, it is then possible to encode a regex:</p>
<pre><code class="language-rust">a(b | c)</code></pre>
<p>By the law of distributivity, we can rewrite this as:</p>
<pre><code class="language-rust">ab | ac</code></pre>
<h3 id="ocaml"><a class="header" href="#ocaml">OCaml</a></h3>
<p><a href="https://caml.inria.fr/pub/docs/manual-ocaml/patterns.html#sec108">This is supported</a> in OCaml. An example from “Real World OCaml” is:</p>
<pre><code class="language-ocaml">let is_ocaml_source s =
  match String.rsplit2 s ~on:'.' with
  | Some (_, ("ml" | "mli")) -&gt; true
  | _ -&gt; false
</code></pre>
<p>While OCaml will permit the following:</p>
<pre><code class="language-ocaml">let foo =
  match Some(1) with
  | Some(1 | 2) -&gt; true
  | _ -&gt; false
</code></pre>
<p>the OCaml compiler will reject:</p>
<pre><code class="language-ocaml">let foo =
  match Some(1) with
  | Some(| 1 | 2) -&gt; true (* Note in particular the leading | in Some(..). *)
  | _ -&gt; false
</code></pre>
<p>We have chosen to impose the same restriction as OCaml here with respect to not allowing leading <code>|</code> in nested pattern alternations.</p>
<h3 id="f"><a class="header" href="#f">F#</a></h3>
<p>A language which is quite similar to OCaml is F#. With respect to <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/pattern-matching">pattern matching</a>, we may write:</p>
<pre><code class="language-fsharp">let detectZeroOR point =
    match point with
    | (0, 0) | (0, _) | (_, 0) -&gt; printfn "Zero found."
    | _ -&gt; printfn "Both nonzero."
</code></pre>
<p>F# calls these “OR pattern“s and includes <code>pattern1 | pattern2</code> in the pattern grammar.</p>
<h3 id="haskell"><a class="header" href="#haskell">Haskell</a></h3>
<p>The <a href="https://github.com/ghc-proposals/ghc-proposals/pull/43">equivalent proposal</a> is currently being discussed for inclusion in Haskell.</p>
<h3 id="lisp"><a class="header" href="#lisp">Lisp</a></h3>
<p>There is support for or-patterns in <a href="https://stackoverflow.com/a/3798659/1063961">various lisp libraries</a>.</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved questions</a></h2>
<ol>
<li>
<p>Should we allow <code>top_pat</code> or <code>pat&lt;allow_top_alt&gt;</code> in <code>inferable_param</code> such that closures permit <code>|Ok(x) | Err(x)|</code> without first wrapping in parenthesis?</p>
<p>We defer this decision to stabilization as it may depend on experimentation. Our current inclination is to keep the RFC as-is because the ambiguity is not just for the compiler; for humans, it is likely also ambiguous and thus harder to read.</p>
<p>This also applies to functions which, although do not look as ambiguous, benefit from better consistency with closures. With respect to function arguments there’s also the issue that not disambiguating with parenthesis makes it less clear whether the type ascription applies to the or-pattern as a whole or just the last alternative.</p>
</li>
<li>
<p>Should the <code>pat</code> macro fragment specifier match <code>top_pat</code> in different Rust editions or should it match <code>pat&lt;no_top_alt&gt;</code> as currently specified? We defer such decisions to stabilization because it depends on the outcome of crater runs to see what the extent of the breakage would be.</p>
</li>
</ol>
<p>The benefit of avoiding <code>pat&lt;no_top_alt&gt;</code> in as many places as possible would both be grammatical consistency and fewer surprises for uses. The drawbacks would be possible ambiguity or backtracking for closures and breakage for macros.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="2532-associated-type-defaults.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="2539-cfg_attr-multiple-attrs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="2532-associated-type-defaults.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="2539-cfg_attr-multiple-attrs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
