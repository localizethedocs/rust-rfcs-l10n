<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0019-opt-in-builtin-traits - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-b61d75f0.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Start Date: 2014-09-18</li>
<li>RFC PR #: <a href="https://github.com/rust-lang/rfcs/pull/19">rust-lang/rfcs#19</a>, <a href="https://github.com/rust-lang/rfcs/pull/127">rust-lang/rfcs#127</a></li>
<li>Rust Issue #: <a href="https://github.com/rust-lang/rust/issues/13231">rust-lang/rust#13231</a></li>
</ul>
<p><strong>Note:</strong> The <code>Share</code> trait described in this RFC was later <a href="0123-share-to-threadsafe.html">renamed to <code>Sync</code></a>.</p>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>The high-level idea is to add language features that simultaneously achieve three goals:</p>
<ol>
<li>move <code>Send</code> and <code>Share</code> out of the language entirely and into the standard library, providing mechanisms for end users to easily implement and use similar “marker” traits of their own devising;</li>
<li>make “normal” Rust types sendable and sharable by default, without the need for explicit opt-in; and,</li>
<li>continue to require “unsafe” Rust types (those that manipulate unsafe pointers or implement special abstractions) to “opt-in” to sendability and sharability with an unsafe declaration.</li>
</ol>
<p>These goals are achieved by two changes:</p>
<ol>
<li>
<p><strong>Unsafe traits:</strong> An <em>unsafe trait</em> is a trait that is unsafe to implement, because it represents some kind of trusted assertion. Note that unsafe traits are perfectly safe to <em>use</em>. <code>Send</code> and <code>Share</code> are examples of unsafe traits: implementing these traits is effectively an assertion that your type is safe for threading.</p>
</li>
<li>
<p><strong>Default and negative impls:</strong> A <em>default impl</em> is one that applies to all types, except for those types that explicitly <em>opt out</em>. For example, there would be a default impl for <code>Send</code>, indicating that all types are <code>Send</code> “by default”.</p>
<p>To counteract a default impl, one uses a <em>negative impl</em> that explicitly opts out for a given type <code>T</code> and any type that contains <code>T</code>. For example, this RFC proposes that unsafe pointers <code>*T</code> will opt out of <code>Send</code> and <code>Share</code>. This implies that unsafe pointers cannot be sent or shared between threads by default. It also implies that any structs which contain an unsafe pointer cannot be sent. In all examples encountered thus far, the set of negative impls is fixed and can easily be declared along with the trait itself.</p>
<p>Safe wrappers like <code>Arc</code>, <code>Atomic</code>, or <code>Mutex</code> can opt to implement <code>Send</code> and <code>Share</code> explicitly. This will then make them be considered sendable (or sharable) even though they contain unsafe pointers etc.</p>
</li>
</ol>
<p>Based on these two mechanisms, we can remove the notion of <code>Send</code> and <code>Share</code> as builtin concepts. Instead, these would become unsafe traits with default impls (defined purely in the library). The library would explicitly <em>opt out</em> of <code>Send</code>/<code>Share</code> for certain types, like unsafe pointers (<code>*T</code>) or interior mutability (<code>Unsafe&lt;T&gt;</code>). Any type, therefore, which contains an unsafe pointer would be confined (by default) to a single thread. Safe wrappers around those types, like <code>Arc</code>, <code>Atomic</code>, or <code>Mutex</code>, can then opt back in by explicitly implementing <code>Send</code> (these impls would have to be designed as unsafe).</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>Since proposing opt-in builtin traits, I have become increasingly concerned about the notion of having <code>Send</code> and <code>Share</code> be strictly opt-in. There are two main reasons for my concern:</p>
<ol>
<li>Rust is very close to being a language where computations can be parallelized by default. Making <code>Send</code>, and <em>especially</em> <code>Share</code>, opt-in makes that harder to achieve.</li>
<li>The model followed by <code>Send</code>/<code>Share</code> cannot easily be extended to other traits in the future nor can it be extended by end-users with their own similar traits. It is worrisome that I have come across several use cases already which might require such extension (described below).</li>
</ol>
<p>To elaborate on those two points: With respect to parallelization: for the most part, Rust types are threadsafe “by default”. To make something non-threadsafe, you must employ unsynchronized interior mutability (e.g., <code>Cell</code>, <code>RefCell</code>) or unsynchronized shared ownership (<code>Rc</code>). In both cases, there are also synchronized variants available (<code>Mutex</code>, <code>Arc</code>, etc). This implies that we can make APIs to enable intra-task parallelism and they will work ubiquitously, so long as people avoid <code>Cell</code> and <code>Rc</code> when not needed. Explicit opt-in threatens that future, however, because fewer types will implement <code>Share</code>, even if they are in fact threadsafe.</p>
<p>With respect to extensibility, it is particularly worrisome that if a library forgets to implement <code>Send</code> or <code>Share</code>, downstream clients are stuck. They cannot, for example, use a newtype wrapper, because it would be illegal to implement <code>Send</code> on the newtype. This implies that all libraries must be vigilant about implementing <code>Send</code> and <code>Share</code> (even more so than with other pervasive traits like <code>Eq</code> or <code>Ord</code>). The current plan is to address this via lints and perhaps some convenient deriving syntax, which may be adequate for <code>Send</code> and <code>Share</code>. But if we wish to add new “classification” traits in the future, these new traits won’t have been around from the start, and hence won’t be implemented by all existing code.</p>
<p>Another concern of mine is that end users cannot define classification traits of their own. For example, one might like to define a trait for “tainted” data, and then test to ensure that tainted data doesn’t pass through some generic routine. There is no particular way to do this today.</p>
<p>More examples of classification traits that have come up recently in various discussions:</p>
<ul>
<li><code>Snapshot</code> (nee <code>Freeze</code>), which defines <em>logical</em> immutability rather than <em>physical</em> immutability. <code>Rc&lt;int&gt;</code>, for example, would be considered <code>Snapshot</code>. <code>Snapshot</code> could be useful because <code>Snapshot+Clone</code> indicates a type whose value can be safely “preserved” by cloning it.</li>
<li><code>NoManaged</code>, a type which does not contain managed data. This might be useful for integrating garbage collection with custom allocators which do not wish to serve as potential roots.</li>
<li><code>NoDrop</code>, a type which does not contain an explicit destructor. This can be used to avoid nasty GC quandries.</li>
</ul>
<p>All three of these (<code>Snapshot</code>, <code>NoManaged</code>, <code>NoDrop</code>) can be easily defined using traits with default impls.</p>
<p>A final, somewhat weaker, motivator is aesthetics. Ownership has allowed us to move threading almost entirely into libraries. The one exception is that the <code>Send</code> and <code>Share</code> types remain built-in. Opt-in traits makes them <em>less</em> built-in, but still requires custom logic in the “impl matching” code as well as special safety checks when <code>Safe</code> or <code>Share</code> are implemented.</p>
<p>After the changes I propose, the only traits which would be specifically understood by the compiler are <code>Copy</code> and <code>Sized</code>. I consider this acceptable, since those two traits are intimately tied to the core Rust type system, unlike <code>Send</code> and <code>Share</code>.</p>
<h2 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h2>
<h3 id="unsafe-traits"><a class="header" href="#unsafe-traits">Unsafe traits</a></h3>
<p>Certain traits like <code>Send</code> and <code>Share</code> are critical to memory safety. Nonetheless, it is not feasible to check the thread-safety of all types that implement <code>Send</code> and <code>Share</code>. Therefore, we introduce a notion of an <em>unsafe trait</em> – this is a trait that is unsafe to implement, because implementing it carries semantic guarantees that, if compromised, threaten memory safety in a deep way.</p>
<p>An unsafe trait is declared like so:</p>
<pre><code>unsafe trait Foo { ... }
</code></pre>
<p>To implement an unsafe trait, one must mark the impl as unsafe:</p>
<pre><code>unsafe impl Foo for Bar { ... }
</code></pre>
<p>Designating an impl as unsafe does not automatically mean that the body of the methods is an unsafe block. Each method in the trait must also be declared as unsafe if it to be considered unsafe.</p>
<p>Unsafe traits are only unsafe to <em>implement</em>. It is always safe to reference an unsafe trait. For example, the following function is safe:</p>
<pre><code>fn foo&lt;T:Send&gt;(x: T) { ... }
</code></pre>
<p>It is also safe to <em>opt out</em> of an unsafe trait (as discussed in the next section).</p>
<h3 id="default-and-negative-impls"><a class="header" href="#default-and-negative-impls">Default and negative impls</a></h3>
<p>We add a notion of a <em>default impl</em>, written:</p>
<pre><code>impl Trait for .. { }
</code></pre>
<p>Default impls are subject to various limitations:</p>
<ol>
<li>The default impl must appear in the same module as <code>Trait</code> (or a submodule).</li>
<li><code>Trait</code> must not define any methods.</li>
</ol>
<p>We further add the notion of a <em>negative impl</em>, written:</p>
<pre><code>impl !Trait for Foo { }
</code></pre>
<p>Negative impls are only permitted if <code>Trait</code> has a default impl. Negative impls are subject to the usual orphan rules, but they are permitting to be overlapping. This makes sense because negative impls are not providing an implementation and hence we are not forced to select between them. For similar reasons, negative impls never need to be marked unsafe, even if they reference an unsafe trait.</p>
<p>Intuitively, to check whether a trait <code>Foo</code> that contains a default impl is implemented for some type <code>T</code>, we first check for explicit (positive) impls that apply to <code>T</code>. If any are found, then <code>T</code> implements <code>Foo</code>. Otherwise, we check for negative impls. If any are found, then <code>T</code> does not implement <code>Foo</code>. If neither positive nor negative impls were found, we proceed to check the component types of <code>T</code> (i.e., the types of a struct’s fields) to determine whether all of them implement <code>Foo</code>. If so, then <code>Foo</code> is considered implemented by <code>T</code>.</p>
<p>Oe non-obvious part of the procedure is that, as we recursively examine the component types of <code>T</code>, we add to our list of assumptions that <code>T</code> implements <code>Foo</code>. This allows recursive types like</p>
<pre><code>struct List&lt;T&gt; { data: T, next: Option&lt;List&lt;T&gt;&gt; }
</code></pre>
<p>to be checked successfully. Otherwise, we would recursive infinitely. (This procedure is directly analogous to what the existing <code>TypeContents</code> code does.)</p>
<p>Note that there exist types that expand to an infinite tree of types. Such types cannot be successfully checked with a recursive impl; they will simply overflow the builtin depth checking. However, such types also break code generation under monomorphization (we cannot create a finite set of LLVM types that correspond to them) and are in general not supported. Here is an example of such a type:</p>
<pre><code>struct Foo&lt;A&gt; {
    data: Option&lt;Foo&lt;Vec&lt;A&gt;&gt;&gt;
}
</code></pre>
<p>The difference between <code>Foo</code> and <code>List</code> above is that <code>Foo&lt;A&gt;</code> references <code>Foo&lt;Vec&lt;A&gt;&gt;</code>, which will then in turn reference <code>Foo&lt;Vec&lt;Vec&lt;A&gt;&gt;&gt;</code> and so on.</p>
<h3 id="modeling-send-and-share-using-default-traits"><a class="header" href="#modeling-send-and-share-using-default-traits">Modeling Send and Share using default traits</a></h3>
<p>The <code>Send</code> and <code>Share</code> traits will be modeled entirely in the library as follows. First, we declare the two traits as follows:</p>
<pre><code>unsafe trait Send { }
unsafe impl Send for .. { }

unsafe trait Share { }
unsafe impl Share for .. { }
</code></pre>
<p>Both traits are declared as unsafe because declaring that a type if <code>Send</code> and <code>Share</code> has ramifications for memory safety (and data-race freedom) that the compiler cannot, itself, check.</p>
<p>Next, we will add <em>opt out</em> impls of <code>Send</code> and <code>Share</code> for the various unsafe types:</p>
<pre><code>impl&lt;T&gt; !Send for *T { }
impl&lt;T&gt; !Share for *T { }

impl&lt;T&gt; !Send for *mut T { }
impl&lt;T&gt; !Share for *mut T { }

impl&lt;T&gt; !Share for Unsafe&lt;T&gt; { }
</code></pre>
<p>Note that it is not necessary to write unsafe to <em>opt out</em> of an unsafe trait, as that is the default state.</p>
<p>Finally, we will add <em>opt in</em> impls of <code>Send</code> and <code>Share</code> for the various safe wrapper types as needed. Here I give one example, which is <code>Mutex</code>. <code>Mutex</code> is interesting because it has the property that it converts a type <code>T</code> from being <code>Sendable</code> to something <code>Sharable</code>:</p>
<pre><code>unsafe impl&lt;T:Send&gt; Send for Mutex&lt;T&gt; { }
unsafe impl&lt;T:Send&gt; Share for Mutex&lt;T&gt; { }
</code></pre>
<h3 id="the-copy-and-sized-traits"><a class="header" href="#the-copy-and-sized-traits">The <code>Copy</code> and <code>Sized</code> traits</a></h3>
<p>The final two builtin traits are <code>Copy</code> and <code>Share</code>. This RFC does not propose any changes to those two traits but rather relies on the specification from <a href="0003-opt-in-builtin-traits.html">the original opt-in RFC</a>.</p>
<h4 id="controlling-copy-vs-move-with-the-copy-trait"><a class="header" href="#controlling-copy-vs-move-with-the-copy-trait">Controlling copy vs move with the <code>Copy</code> trait</a></h4>
<p>The <code>Copy</code> trait is “opt-in” for user-declared structs and enums. A struct or enum type is considered to implement the <code>Copy</code> trait only if it implements the <code>Copy</code> trait.  This means that structs and enums would <em>move by default</em> unless their type is explicitly declared to be <code>Copy</code>. So, for example, the following code would be in error:</p>
<pre><code>struct Point { x: int, y: int }
...
let p = Point { x: 1, y: 2 };
let q = p;  // moves p
print(p.x); // ERROR
</code></pre>
<p>To allow that example, one would have to impl <code>Copy</code> for <code>Point</code>:</p>
<pre><code>struct Point { x: int, y: int }
impl Copy for Point { }
...
let p = Point { x: 1, y: 2 };
let q = p;  // copies p, because Point is Pod
print(p.x); // OK
</code></pre>
<p>Effectively, there is a three step ladder for types:</p>
<ol>
<li>If you do nothing, your type is <em>linear</em>, meaning that it moves from place to place and can never be copied in any way. (We need a better name for that.)</li>
<li>If you implement <code>Clone</code>, your type is <em>cloneable</em>, meaning that it moves from place to place, but it can be explicitly cloned. This is suitable for cases where copying is expensive.</li>
<li>If you implement <code>Copy</code>, your type is <em>copyable</em>, meaning that it is just copied by default without the need for an explicit clone.  This is suitable for small bits of data like ints or points.</li>
</ol>
<p>What is nice about this change is that when a type is defined, the user makes an <em>explicit choice</em> between these three options.</p>
<h4 id="determining-whether-a-type-is-sized"><a class="header" href="#determining-whether-a-type-is-sized">Determining whether a type is <code>Sized</code></a></h4>
<p>Per the DST specification, the array types <code>[T]</code> and object types like <code>Trait</code> are unsized, as are any structs that embed one of those types. The <code>Sized</code> trait can never be explicitly implemented and membership in the trait is always automatically determined.</p>
<h4 id="matching-and-coherence-for-the-builtin-types-copy-and-sized"><a class="header" href="#matching-and-coherence-for-the-builtin-types-copy-and-sized">Matching and coherence for the builtin types <code>Copy</code> and <code>Sized</code></a></h4>
<p>In general, determining whether a type implements a builtin trait can follow the existing trait matching algorithm, but it will have to be somewhat specialized. The problem is that we are somewhat limited in the kinds of impls that we can write, so some of the implementations we would want must be “hard-coded”.</p>
<p>Specifically we are limited around tuples, fixed-length array types, proc types, closure types, and trait types:</p>
<ul>
<li><em>Fixed-length arrays:</em> A fixed-length array <code>[T, ..n]</code> is <code>Copy</code> if <code>T</code> is <code>Copy</code>. It is always <code>Sized</code> as <code>T</code> is required to be <code>Sized</code>.</li>
<li><em>Tuples</em>: A tuple <code>(T_0, ..., T_n)</code> is <code>Copy/Sized</code> depending if, for all <code>i</code>, <code>T_i</code> is <code>Copy/Sized</code>.</li>
<li><em>Trait objects</em> (including procs and closures): A trait object type <code>Trait:K</code> (assuming DST here ;) is never <code>Copy</code> nor <code>Sized</code>.</li>
</ul>
<p>We cannot currently express the above conditions using impls. We may at some point in the future grow the ability to express some of them. For now, though, these “impls” will be hardcoded into the algorithm as if they were written in libstd.</p>
<p>Per the usual coherence rules, since we will have the above impls in <code>libstd</code>, and we will have impls for types like tuples and fixed-length arrays baked in, the only impls that end users are permitted to write are impls for struct and enum types that they define themselves. Although this rule is in the general spirit of the coherence checks, it will have to be written specially.</p>
<h2 id="design-discussion"><a class="header" href="#design-discussion">Design discussion</a></h2>
<h3 id="why-unsafe-traits"><a class="header" href="#why-unsafe-traits">Why unsafe traits</a></h3>
<p>Without unsafe traits, it would be possible to create data races without using the <code>unsafe</code> keyword:</p>
<pre><code>struct MyStruct { foo: Cell&lt;int&gt; }
impl Share for MyStruct { }
</code></pre>
<h3 id="balancing-abstraction-safety-and-convenience"><a class="header" href="#balancing-abstraction-safety-and-convenience">Balancing abstraction, safety, and convenience.</a></h3>
<p>In general, the existence of default traits is <em>anti-abstraction</em>, in the sense that it exposes implementation details a library might prefer to hide. Specifically, adding new private fields can cause your types to become non-sendable or non-sharable, which may break downstream clients without your knowing. This is a known challenge with parallelism: knowing whether it is safe to parallelize relies on implementation details we have traditionally tried to keep secret from clients (often it is said that parallelism is “anti-modular” or “anti-compositional” for this reason).</p>
<p>I think this risk must be weighed against the limitations of requiring total opt in. Requiring total opt in not only means that some types will accidentally fail to implement send or share when they could, but it also means that libraries which wish to employ marker traits cannot be composed with other libraries that are not aware of those marker traits. In effect, opt-in is anti-modular in its own way.</p>
<p>To be more specific, imagine that library A wishes to define a <code>Untainted</code> trait, and it specifically opts out of <code>Untainted</code> for some base set of types. It then wishes to have routines that only operate on <code>Untainted</code> data. Now imagine that there is some other library B that defines a nifty replacement for <code>Vector</code>, <code>NiftyVector</code>. Finally, some library C wishes to use a <code>NiftyVector&lt;uint&gt;</code>, which should not be considered tainted, because it doesn’t reference any tainted strings. However, <code>NiftyVector&lt;uint&gt;</code> does not implement <code>Untainted</code> (nor can it, without either library A or library B knowing about one another). Similar problems arise for any trait, of course, due to our coherence rules, but often they can be overcome with new types. Not so with <code>Send</code> and <code>Share</code>.</p>
<h3 id="other-use-cases"><a class="header" href="#other-use-cases">Other use cases</a></h3>
<p>Part of the design involves making space for other use cases. I’d like to sketch out how some of those use cases can be implemented briefly. This is not included in the <em>Detailed design</em> section of the RFC because these traits generally concern other features and would be added under RFCs of their own.</p>
<p><strong>Isolating snapshot types.</strong> It is useful to be able to identify types which, when cloned, result in a logical <em>snapshot</em>. That is, a value which can never be mutated.  Note that there may in fact be mutation under the covers, but this mutation is not visible to the user. An example of such a type is <code>Rc&lt;T&gt;</code> – although the ref count on the <code>Rc</code> may change, the user has no direct access and so <code>Rc&lt;T&gt;</code> is still logically snapshotable.  However, not all <code>Rc</code> instances are snapshottable – in particular, something like <code>Rc&lt;Cell&lt;int&gt;&gt;</code> is not.</p>
<pre><code>trait Snapshot { }
impl Snapshot for .. { }

// In general, anything that can reach interior mutability is not
// snapshotable.
impl&lt;T&gt; !Snapshot for Unsafe&lt;T&gt; { }

// But it's ok for Rc&lt;T&gt;.
impl&lt;T:Snapshot&gt; Snapshot for Rc&lt;T&gt; { }
</code></pre>
<p>Note that these definitions could all occur in a library. That is, the <code>Rc</code> type itself doesn’t need to know about the <code>Snapshot</code> trait.</p>
<p><strong>Preventing access to managed data.</strong> As part of the GC design, we expect it will be useful to write specialized allocators or smart pointers that explicitly do <em>not</em> support tracing, so as to avoid any kind of GC overhead. The general idea is that there should be a bound, let’s call it <code>NoManaged</code>, that indicates that a type cannot reach managed data and hence does not need to be part of the GC’s root set. This trait could be implemented as follows:</p>
<pre><code>unsafe trait NoManaged { }
unsafe impl NoManaged for .. { }
impl&lt;T&gt; !NoManaged for Gc&lt;T&gt; { }
</code></pre>
<p><strong>Preventing access to destructors.</strong> It is generally recognized that allowing destructors to escape into managed data – frequently referred to as finalizers – is a bad idea.  Therefore, we would generally like to ensure that anything is placed into a managed box does not implement the drop trait. Instead, we would prefer to regular the use of drop through a guardian-like API, which basically means that destructors are not asynchronously executed by the GC, as they would be in Java, but rather enqueued for the mutator thread to run synchronously at its leisure. In order to handle this, though, we presumably need some sort of guardian wrapper types that can take a value which has a destructor and allow it to be embedded within managed data. We can summarize this in a trait <code>GcSafe</code> as follows:</p>
<pre><code>unsafe trait GcSafe { }
unsafe impl GcSafe for .. { }

// By default, anything which has drop trait is not GcSafe.
impl&lt;T:Drop&gt; !GcSafe for T { }

// But guardians are, even if `T` has drop.
impl&lt;T&gt; GcSafe for Guardian&lt;T&gt; { }
</code></pre>
<h3 id="why-are-copy-and-sized-different"><a class="header" href="#why-are-copy-and-sized-different">Why are <code>Copy</code> and <code>Sized</code> different?</a></h3>
<p>The <code>Copy</code> and <code>Sized</code> traits remain builtin to the compiler. This makes sense because they are intimately tied to analyses the compiler performs. For example, the running of destructors and tracking of moves requires knowing which types are <code>Copy</code>. Similarly, the allocation of stack frames need to know whether types are fully <code>Sized</code>. In contrast, sendability and sharability has been fully exported to libraries at this point.</p>
<p>In addition, opting in to <code>Copy</code> makes sense for several reasons:</p>
<ul>
<li>Experience has shown that “data-like structs”, for which <code>Copy</code> is most appropriate, are a very small percentage of the total.</li>
<li>Changing a public API from being copyable to being only movable has a outsized impact on users of the API. It is common however that as APIs evolve they will come to require owned data (like a <code>Vec</code>), even if they do not initially, and hence will change from being copyable to only movable. Opting in to <code>Copy</code> is a way of saying that you never foresee this coming to pass.</li>
<li>Often it is useful to create linear “tokens” that do not themselves have data but represent permissions. This can be done today using markers but it is awkward. It becomes much more natural under this proposal.</li>
</ul>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<p><strong>API stability.</strong> The main drawback of this approach over the existing opt-in approach seems to be that a type may be “accidentally” sendable or sharable. I discuss this above under the heading of “balancing abstraction, safety, and convenience”. One point I would like to add here, as it specifically pertains to API stability, is that a library may, if they choose, opt out of <code>Send</code> and <code>Share</code> pre-emptively, in order to “reserve the right” to add non-sendable things in the future.</p>
<h2 id="alternatives"><a class="header" href="#alternatives">Alternatives</a></h2>
<ul>
<li>
<p>The existing opt-in design is of course an alternative.</p>
</li>
<li>
<p>We could also simply add the notion of <code>unsafe</code> traits and <em>not</em> default impls and then allow types to unsafely implement <code>Send</code> or <code>Share</code>, bypassing the normal safety guidelines. This gives an escape valve for a downstream client to assert that something is sendable which was not declared as sendable. However, such a solution is deeply unsatisfactory, because it rests on the downstream client making an assertion about the implementation of the library it uses. If that library should be updated, the client’s assumptions could be invalidated, but no compilation errors will result (the impl was already declared as unsafe, after all).</p>
</li>
</ul>
<h2 id="phasing"><a class="header" href="#phasing">Phasing</a></h2>
<p>Many of the mechanisms described in this RFC are not needed immediately.  Therefore, we would like to implement a minimal “forwards compatible” set of changes now and then leave the remaining work for after the 1.0 release. The builtin rules that the compiler currently implements for send and share are quite close to what is proposed in this RFC. The major change is that unsafe pointers and the <code>UnsafeCell</code> type are currently considered sendable.</p>
<p>Therefore, to be forwards compatible in the short term, we can use the same hybrid of builtin and explicit impls for <code>Send</code> and <code>Share</code> that we use for <code>Copy</code>, with the rule that unsafe pointers and <code>UnsafeCell</code> are not considered sendable. We must also implement the <code>unsafe trait</code> and <code>unsafe impl</code> concept.</p>
<p>What this means in practice is that using <code>*const T</code>, <code>*mut T</code>, and <code>UnsafeCell</code> will make a type <code>T</code> non-sendable and non-sharable, and <code>T</code> must then explicitly implement <code>Send</code> or <code>Share</code>.</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved questions</a></h2>
<ul>
<li>The terminology of “unsafe trait” seems somewhat misleading, since it seems to suggest that “using” the trait is unsafe, rather than implementing it. One suggestion for an alternate keyword was <code>trusted trait</code>, which might dovetail with the use of <code>trusted</code> to specify a trusted block of code. If we did use <code>trusted trait</code>, it seems that all impls would also have to be <code>trusted impl</code>.</li>
<li>Perhaps we should declare a trait as a “default trait” directly, rather than using the <code>impl Drop for ..</code> syntax. I don’t know precisely what syntax to use, though.</li>
<li>Currently, there are special rules relating to object types and the builtin traits. If the “builtin” traits are no longer builtin, we will have to generalize object types to be simply a set of trait references. This is already planned but merits a second RFC. Note that no changes here are required for the 1.0, since the phasing plan dictates that builtin traits remain special until after 1.0.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="0016-more-attributes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="0026-remove-priv.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="0016-more-attributes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="0026-remove-priv.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
