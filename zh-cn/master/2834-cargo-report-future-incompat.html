<!DOCTYPE HTML>
<html lang="zh_CN" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2834-cargo-report-future-incompat - The Rust RFC Book</title>


        <!-- Custom HTML head -->
        <script type="text/javascript" src="ltd-provenance.js"></script>
        <script type="text/javascript" src="ltd-current.js"></script>
        <script type="text/javascript" src="../../ltd-config.js"></script>
        <script type="text/javascript" src="../../ltd-flyout.js"></script>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-b61d75f0.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-5025baa3.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust RFC Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/rust-lang/rfcs" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <ul>
<li>Feature Name: N/A</li>
<li>Start Date: 2019-12-10</li>
<li>RFC PR: <a href="https://github.com/rust-lang/rfcs/pull/2834">rust-lang/rfcs#2834</a></li>
<li>Rust Issue: <a href="https://github.com/rust-lang/rust/issues/71249">rust-lang/rust#71249</a></li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Cargo should alert developers to upstream dependencies that trigger future-incompatibility warnings. Cargo should list such dependencies even when these warnings have been suppressed (e.g. via cap-lints or <code>#[allow(..)]</code> attributes.)</p>
<p>Cargo could additionally provide feedback for tactics a maintainer of the downstream crate could use to address the problem (the details of such tactics is not specified nor mandated by this RFC).</p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>From <a href="https://github.com/rust-lang/rust/issues/34596">rust-lang/rust#34596</a>:</p>
<blockquote>
<p>if you author a library that is widely used, but which you are not actively using at the moment, you might not notice that it will break in the future – moreover, your users won’t either, since cargo will cap lints when it builds your library as a dependency.</p>
</blockquote>
<p>Today, cargo will cap lints when it builds libraries as dependencies. This behavior includes future-incompatibility lints.</p>
<p>As a running example, assume we have a crate <code>unwary</code> with an upstream crate dependency <code>brash</code>, and <code>brash</code> has code that triggers a future-incompatibility lint, in this case a borrow <code>&amp;x.data.0</code> of a packed field (see <a href="https://github.com/rust-lang/rust/issues/46043">rust-lang/rust#46043</a>, “safe packed borrows”).</p>
<p>If <code>brash</code> is a non-path dependency of <code>unwary</code>, then building <code>unwary</code> will suppress the warning associated with <code>brash</code> in its diagnostic output, because the build of <code>brash</code> will pass <code>--cap-lints=allow</code> to its <code>rustc</code> invocation. This means that a future version of Rust is going to fail to compile the <code>unwary</code> project, with no warning to the developer of <code>unwary</code>.</p>
<p>Example of today’s behavior (where in this case, <code>brash</code> is non-path dependency of <code>unwary</code>):</p>
<pre><code>crates % cd unwary
unwary % cargo build                                                # no warning issued about problem in the `brash` dependency.
   Compiling brash v0.1.0
   Compiling unwary v0.1.0 (/tmp/unwary)
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s
unwary % cd ../brash
brash % cargo build                                                 # (but a `brash` developer will see it when they build.)
   Compiling brash v0.1.0 (/tmp/brash)
warning: borrow of packed field is unsafe and requires unsafe function or block (error E0133)
  --&gt; src/lib.rs:13:9
   |
13 | let y = &amp;x.data.0;
   |         ^^^^^^^^^
   |
   = note: `#[warn(safe_packed_borrows)]` on by default
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!
   = note: for more information, see issue #46043 &lt;https://github.com/rust-lang/rust/issues/46043&gt;
   = note: fields of packed structs might be misaligned: dereferencing a misaligned pointer or even just creating a misaligned reference is undefined behavior
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s
brash %
</code></pre>
<p>Cargo passes <code>--cap-lints=allow</code> on upstream dependencies for good reason, as discussed in <a href="https://github.com/rust-lang/rfcs/blob/master/text/1193-cap-lints.md">Rust RFC 1193</a> and the comment thread from <a href="https://github.com/rust-lang/rust/issues/59658">rust-lang/rust#59658</a>. For cases like future-incompatibility lints, which are more severe warnings for the long-term viability of a crate, we need to provide some feedback to the <code>unwary</code> maintainer.</p>
<p>But this feedback should not be <em>just</em> the raw diagnostic output for <code>brash</code>! The developer of a crate like <code>unwary</code> typically cannot do anything in the short term about warnings emitted by upstream crates,</p>
<ul>
<li>(The <code>unwary</code> developer <em>can</em> file issues against <code>brash</code> or even contribute code to fix <code>brash</code>, but that does not resolve the immediate problem until a new version of <code>brash</code> is released by its maintainer.)</li>
</ul>
<p>Therefore the diagnostics associated with building upstream <code>brash</code> are usually just noise from the viewpoint of <code>unwary</code>’s maintainer.</p>
<p>Therefore, we want to continue passing <code>--cap-lints=allow</code> for upstream dependencies. But we also want <code>rustc</code> to tell <code>cargo</code> (via some channel) about when future-incompatibility lints are triggered, and we want <code>cargo</code> to provide a succinct report of the triggers.</p>
<p>This RFC suggests the provided feedback take the form of a summary at the end of cargo’s build of <code>unwary</code>, as illustrated in the explanation below.</p>
<p>Furthermore, we want the feedback to provide guidance as to how the <code>unwary</code> maintainer can address the issue. Here are some potential forms this additional guidance could take.</p>
<ul>
<li>
<p>cargo could respond to the future-incompatibilty signaling by querying the local index to find out if a newer version of the upstream crate is available. If a newer version is available, then it could suggest to the user they might upgrade to it. If such an upgrade could be done via <code>cargo update</code>, then the output could obviously suggest that as well.</p>
<p>(This is just a heuristic measure, as it would not attempt to check ahead of time if the newer version actually resolves the problem in question.)</p>
<p>A further refinement on this idea would be to query <code>crates.io</code> itself If cargo is not running in “offline mode”. But querying the index may well suffice in practice.</p>
</li>
<li>
<p>Cargo could suggest to the <code>unwary</code> maintainer that they file a bug (or search for previously-filed bugs) in the source repository for the upstream crate that is issuing the future-incompatibility warning. (That is, the <code>brash</code> author might not be aware of the issue; for example, if they last updated their crate before the lint in question was deployed on the Rust compiler.)</p>
</li>
<li>
<p><code>rustc</code> itself could embed, for each future-incompatibility lint, how soon the Rust developers will turn the lint to a hard error. This would give the <code>unwary</code> maintainer an idea of how much time they have before they will be forced to address the issue (by posting a PR upstream, or switching to a fork of <code>brash</code>, et cetera).</p>
</li>
</ul>
<h2 id="guide-level-explanation"><a class="header" href="#guide-level-explanation">Guide-level explanation</a></h2>
<p>After cargo finishes compiling a crate and its upstream dependencies, it may include a final warning about <em>future incompatibilties</em>.</p>
<p>A future incompatibility is a pattern of code that is scheduled to be removed from the Rust language in some future release. Such code patterns are usually instances of constructs that can exhibit undefined behavior (i.e. they are unsound) or do not have a well-defined semantics, but are nonetheless in widespread use and thus need a grace period before they are removed.</p>
<p>If any crate or any of its upstream dependencies has code that triggers a future incompatibility warning, but the overall compilation is otherwise without error, then cargo will report all instances of crates with future incompatibilities at the end of the compilation. When possible, this report includes the future date or release version where we expect Rust to stop compiling the code in question.</p>
<p>Example:</p>
<pre><code>crates % cd unwary
unwary % cargo build
   Compiling brash v0.1.0
   Compiling bold v0.1.0
   Compiling rash v0.1.0
   Compiling unwary v0.1.0
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s

    warning: the crates brash, bold, and rash contain code that will be rejected by a future version of Rust.
    note: the crate rash will stop compiling in Rust 1.50 (scheduled for February 2021).
    note: to see what the problems were, invoke `cargo describe-future-incompatibilities`
unwary %
</code></pre>
<p>If the dependency graph for the current crate contains multiple versions of a crate listed by the end report, then the end report should include which version (or versions) of that crate are causing the lint to fire.</p>
<p>Invoking the command <code>cargo describe-future-incompatibilities</code> will make cargo query information cached from the previous build and print out a more informative diagnostic message:</p>
<pre><code>unary % cargo describe-future-incompatibilities
The `brash` crate currently triggers a future incompatibility warning with Rust,
with the following diagnostic:

&gt; warning: borrow of packed field is unsafe and requires unsafe function or block (error E0133)
&gt;   --&gt; src/lib.rs:12:9
&gt;    |
&gt; 12 | let y = &amp;x.data.0; // UB, also future-compatibility warning
&gt;    |         ^^^^^^^^^
&gt;    |
&gt;    = note: `#[warn(safe_packed_borrows)]` on by default
&gt;    = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!
&gt;    = note: for more information, see issue #46043 &lt;https://github.com/rust-lang/rust/issues/46043&gt;
&gt;    = note: fields of packed structs might be misaligned: dereferencing a misaligned pointer or even just creating a misaligned reference is undefined behavior


The `bold` crate currently triggers a future incompatibility warning with Rust,
with the following diagnostic:

&gt; warning: private type `foo::m::S` in public interface (error E0446)
&gt;  --&gt; src/lib.rs:5:5
&gt;   |
&gt; 5 |     pub fn f() -&gt; S { S }
&gt;   |     ^^^^^^^^^^^^^^^^^^^^^
&gt;   |
&gt;   = note: `#[warn(private_in_public)]` on by default
&gt;   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!
&gt;   = note: for more information, see issue #34537 &lt;https://github.com/rust-lang/rust/issues/34537&gt;


The `rash` crate currently triggers a future incompatibility warning with Rust,
with the following diagnostic:

&gt; error: defaults for type parameters are only allowed in `struct`, `enum`, `type`, or `trait` definitions.
&gt;  --&gt; src/lib.rs:4:8
&gt;   |
&gt; 4 | fn bar&lt;T=i32&gt;(x: T) { }
&gt;   |        ^
&gt;   |
&gt;   = note: `#[deny(invalid_type_param_default)]` on by default
&gt;   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!
&gt;   = note: for more information, see issue #36887 &lt;https://github.com/rust-lang/rust/issues/36887&gt;
</code></pre>
<p>This way, developers who want to understand the problem have a way to find out more, without flooding everyone’s diagnostics with information they cannot use with their own local development.</p>
<p>Rebuilding <code>unwary</code> continues to emit the report even if the upstream dependencies are not rebuilt.</p>
<p>Example:</p>
<pre><code>unwary % touch src/main.rs
unwary % cargo build
   Compiling unwary v0.1.0
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s

    warning: the crates brash, bold, and rash contain code that will be rejected by a future version of Rust.
    note: the crate rash will stop compiling in Rust 1.50 (scheduled for February 2021).
unwary %
    note: to see what the problems were, invoke `cargo describe-future-incompatibilities`
</code></pre>
<p>To keep the user experience consistent, we should probably emit the same warning at the end even when the root crate is the sole trigger of incompatibility lints.</p>
<pre><code>crates % cd brash
brash % cargo build
   Compiling brash v0.1.0 (/tmp/brash)
warning: borrow of packed field is unsafe and requires unsafe function or block (error E0133)
  --&gt; src/lib.rs:13:9
   |
13 | let y = &amp;x.data.0;
   |         ^^^^^^^^^
   |
   = note: `#[warn(safe_packed_borrows)]` on by default
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!
   = note: for more information, see issue #46043 &lt;https://github.com/rust-lang/rust/issues/46043&gt;
   = note: fields of packed structs might be misaligned: dereferencing a misaligned pointer or even just creating a misaligned reference is undefined behavior
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s

    warning: the crate brash contains code that will be rejected by a future version of Rust.
brash % cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.00s

    warning: the crate brash contains code that will be rejected by a future version of Rust.
    note: to see what the problems were, invoke `cargo describe-future-incompatibilities`
brash %
</code></pre>
<p>And as you might expect, if there are no future-incompatibilty warnings issused, then the output of <code>cargo</code> is unchanged from today. Example:</p>
<pre><code>crates % cd unwary
unwary % cargo build
   Compiling brash v0.2.0
   Compiling bold2 v0.1.0
   Compiling unwary v0.2.0
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s
unwary %
</code></pre>
<p>Here, the unwary (sic) crate has updated its version of <code>brash</code>, switched to <code>bold2</code> (a fork of <code>bold</code>), and replaced its internal usage of <code>rash</code> with some local code, thus completely eliminating all current future-incompatibility lint triggers.</p>
<h2 id="reference-level-explanation"><a class="header" href="#reference-level-explanation">Reference-level explanation</a></h2>
<p>As noted above, we want to continue to suppress normal lint checks for upstream dependencies. Therefore, Cargo will continue to pass <code>--cap-lints=allow</code> for non-path upstream dependencies.</p>
<p>At the same time, we want to minimize disruption to existing users of Rust.</p>
<p>Therefore, the behavior of flags that directly interact with lints, like <code>-Dwarnings</code>, will remain unchanged by this RFC.</p>
<p>For example, in our running example of <code>unwary</code>:</p>
<ul>
<li>running either <code>cargo rustc -- -Dwarnings</code> or <code>RUSTFLAGS=-Dwarnings cargo build</code> will invoke <code>rustc</code> itself the same way, and each <code>rustc</code> invocation will emit the same set of diagnostics that it does today for each of those cases.</li>
<li>Thus, the warning lints in the downstream <code>brash</code> non-path dependency will be capped, and the future-incompatibility warnings associated with that <code>rustc</code> invocation will be hidden.</li>
<li>When <code>cargo</code> emits a future-incompatibility report at the end of the build, and reports that <code>brash</code> contains code that will be rejected by a future version of Rust, this report is <em>not</em> a lint, and does <em>not</em> interact with <code>-Dwarnings</code>.</li>
<li>In summary: getting a future-incompatibility report when you have passed <code>-Dwarnings</code> to <code>rustc</code> will <em>not</em> fail the build.</li>
</ul>
<p>However, the Rust compiler’s behavior <em>will</em> change slightly. Even when <code>--cap-lints=allow</code> is turned on, we need Cargo to know when a future-incompatibilty lint is triggered.</p>
<p>The division of responsbiilties between Cargo and the Rust compiler may be a little subtle:</p>
<p>The responsibilities of the Rust compiler (<code>rustc</code>):</p>
<ul>
<li>
<p><code>rustc</code> must differentiate future-incompatibility lints (c.f. <a href="https://github.com/rust-lang/rust/issues/59658">PR #59658: “Minimum Lint Levels”</a>) from other lints that are expected to remain as mere warnings forever.</p>
</li>
<li>
<p><code>rustc</code> will need to have some new mode of operation, which this RFC will call the where it will check for instances of future-incompatibility lints, <em>regardless</em> of whether <code>--cap-lints=allow</code> is also set. This RFC calls this the <em>future-incompatibility checking mode</em>.</p>
<ul>
<li>
<p>In the future-incompatibility checking mode of invocation, <code>rustc</code> will also need to check for such lints <em>regardless</em> of whether the code appears in the scope of an <code>#[allow(..)]</code> attribute for the lint.</p>
</li>
<li>
<p>In the future-incompatibility checking mode of invocation, <em>emission</em> of the diagnostics themselves may still be silenced as specified by <code>--cap-lints=allow</code> or <code>#[allow(..)]</code> attributes.</p>
</li>
<li>
<p>That is, those flags and annotations should be interpreted by <code>rustc</code> as silencing the diagnostic report, but <em>not</em> as silencing the feedback about there existing some instance of the lint triggering somewhere in the crate’s source code.</p>
</li>
<li>
<p>The future-incompatibility checking mode is meant as a way to address the bulk of issue <a href="https://github.com/rust-lang/rust/issues/34596">rust-lang/rust#34596</a>.</p>
</li>
</ul>
</li>
</ul>
<p>The responsibilities of Cargo:</p>
<ul>
<li>
<p>Cargo is responsible for invoking <code>rustc</code> in a way that enables the future-incompatibility checking mode. This mode of invocation occurs <em>regardless</em> of whether <code>--cap-lints=allow</code> is also being passed when the crate is compiled.</p>
</li>
<li>
<p>Cargo is responsible for capturing any output from the future-incompatibility checking mode and summarizing it at the end of the whole build.</p>
</li>
<li>
<p>Cargo is responsible for storing a record of any future-incompatibility for a crate somewhere in the <code>target/</code> directory, so that it can emit the same report without having to rebuild the crate on subsequent rebuilds of the root crate.</p>
</li>
<li>
<p>Cargo is responsible for suggesting ways to address the problem to the user. The specific tactics for constructing such suggestions are not mandated by this RFC, but some ideas are presented as <a href="#future-possibilities">Future possibiilties</a>.</p>
</li>
</ul>
<h3 id="implementation-strategy-leverage-json-error-format"><a class="header" href="#implementation-strategy-leverage-json-error-format">Implementation strategy: Leverage JSON error-format</a></h3>
<p>The cleanest way to implement the above division of responsbilities without perturbing <em>non-cargo</em> uses of <code>rustc</code> is probably to make the following change:</p>
<ul>
<li><code>rustc</code> should treat <code>--error-format=json</code> as signal that it should emit a future-incompatibility summary report for the crate.</li>
</ul>
<p>It is relatively easy to extend the JSON output of <code>rustc</code> to include a new record of any future-incompatibility lints that were triggered when compiling a given crate.</p>
<ul>
<li>However, this RFC does not <em>dictate</em> this choice of implementation strategy. (Other options include using some environment variable to opt-in to a change to <code>rustc</code>’s output, or having <code>rustc</code> emit future-incompatibility metadata to the filesystem.)</li>
</ul>
<p>Some (but not all) future-incompatibility lints will have a concrete schedule established for when they are meant to become hard errors. (This RFC does not specify the details about how such schedules are established or what constraints they will have to meet; it just posits that they <em>will</em> be established by some means.) The metadata for every future-incompatibility lint should include the anticipated version of Rust, if known, where it will become a hard error.</p>
<ul>
<li>This adds motivation for using JSON formatted diagnostics: JSON records are more readily extensible, and thus can support adding this sort of feedback in a robust fashion.</li>
</ul>
<p>Since <code>cargo</code> is expected to continue to emit the report even when the upstream dependencies are not rebuilt, Cargo will store the future-incompatibility status for each crate somewhere in the <code>target/</code> directory on the file-system. (This should be a trivial constraint today: Cargo on the nightly channel is already locally caching warnings emitted while building upstream path-dependencies.)</p>
<h3 id="annoyance-modulation"><a class="header" href="#annoyance-modulation">Annoyance modulation</a></h3>
<p>Emitting a warning on all subsequent cargo invocations until the problem is resolved may be overkill for some users.</p>
<p>In particular, it may not be reasonable for someone to resolve the flagged problem in the short term.</p>
<p>In order to allow users to opt-out of being warned about future incompatibility issues on every build, this RFC proposes extending the <code>.cargo/config</code> file with keys that allow the user to fine-tune the frequency of how often cargo will print the report. For example:</p>
<pre><code>[future_incompatibility_report]
# This setting can be used to reduce the frequency with which Cargo will report
# future incompatibility issues.
#
# The possible values are:
# * "always" (default): always emit the report if any future incompatibility 
#                       lint fires,
# * "never": never emit the report,
# * "post-cargo-update": emit the report the first time we encounter a given
#                         future incompatibility lint after the most recent
#                         `cargo update` run for a crate,
# * "daily": emit the report the first time any particular lint fires each day,
# * "weekly": emit the report the first time any particular lint fires
#             each week (starting from Monday, following ISO 8601),
# * "lunar": emit the report the first time any particular lint fires every
#            four weeks. (We recommend using this value in tandem with
#            an IDE that presents the current phase of the moon in its UI.)
frequency = "always"

# This allows a further fine-tuning for lints that have been given an
# explicit schedule for when they will be turned into hard errors.
#
# If false, such scheduled lints are treated the same as unscheduled ones.
#
# If true, such scheduled lints issue their report more frequently
# as time marches towards the release date when the warning becomes an error.
#
# Specifically,
# * 6 weeks before that release, the report is emitted at least once per week,
# * 2 weeks before that release, the report is emitted on every build.
#
# (Note that a consequence of the above definition, this value of this setting
# has no effect if the `future_incompat_report_frequency` is "always".)
telescoping_schedule = true
</code></pre>
<p>(This RFC does not actually prescribe the precise set of keys and values laid out above. We trust the Cargo team to determine an appropriate set of knobs to expose to the user.)</p>
<h3 id="policy-issues"><a class="header" href="#policy-issues">Policy issues</a></h3>
<p>We probably do not want to blindly convert all lints to use this system. The mechanism suggested here may not be appropriate for every single lint currently categorized as <code>C-future-incompatility</code> on the Rust repo. That decision is a policy matter for the relevant teams, and the form of such policy is out of scope for this RFC.</p>
<p>Whatever form that policy takes, it is worth noting: Users who encounter upstream future-incompatibility issues may have neither free time nor external development resources to draw upon. The rustc developers need to take some care in deciding <em>when</em> a future-incompatibility lint should start being reported via this mechanism.</p>
<ul>
<li>If our primary goal is to minimize user frustration with our tools and ecosystem, then future-incompatibility reporting for a given lint should be turned only after much of the crate ecosystem have new fixed versions. In other words, we should strive for a steady-state where the typical user response to a future-incompatibility report is that user then runs <code>cargo update</code>, or they ask for a (pre-existing) PR to be merged.</li>
</ul>
<h2 id="drawbacks"><a class="header" href="#drawbacks">Drawbacks</a></h2>
<p>The change as described requires revisions to both <code>rustc</code> and <code>cargo</code>, which can be tricky to coordinate.</p>
<p>This RFC suggests an approach where the changes are somewhat loosely coupled: Use of <code>--error-format=json</code> will enable the future-compatibility checking mode. This avoids the need to add a new stable command line flag to <code>rustc</code>; but it also may be a confusing change in compiler semantics for any non-cargo client of <code>rustc</code> that is using <code>--error-format=json</code>.</p>
<h2 id="rationale-and-alternatives"><a class="header" href="#rationale-and-alternatives">Rationale and alternatives</a></h2>
<h3 id="no-change-needed"><a class="header" href="#no-change-needed">No change needed?</a></h3>
<p>Some claim that “our current approach” has been working, and therefore no change is needed here. However, my counterargument is that the only reason we haven’t had to resolve this before is that compiler and language teams have been forced to be very conservative in changing existing future-incompatibility lints into hard errors, because it takes a lot of effort to make such transitions, (in no small part <strong>because</strong> of the issue described here).</p>
<p>In the cases where the compiler and language teams have turned such lints into hard errors, the teams spent significant time evaluating breakage via crater and then addressing such breakage. The changes suggested here would hopefully encourage more Rust users <em>outside</em> of the compiler and language teams to address future-compatibility breakage.</p>
<h3 id="is-there-something-simpler"><a class="header" href="#is-there-something-simpler">Is there something simpler?</a></h3>
<p>One might well ask: Is this RFC overkill? Is there not a simpler way to address this problem?</p>
<p>The following is my attempt to enumerate the simple solutions that were obvious to me. As we will see, these approaches would have serious drawbacks.</p>
<h4 id="can-we-do-this-in-cargo-alone"><a class="header" href="#can-we-do-this-in-cargo-alone">Can we do this in Cargo alone?</a></h4>
<p>With regards to implementation, we could avoid attempt making changes to <code>rustc</code> itself, and isolate the implementation to <code>cargo</code> alone. The main way I can imagine doing this is to stop passing <code>--cap-lints=allow</code>, and then having Cargo capture all diagnostic output from the compiler and post-processing it to determine which lints are future-incompatible warnings. However, this has a number of problems:</p>
<ul>
<li>
<p>It is fragile, since it relies on Cargo post-processing the compiler diagnostic output.</p>
</li>
<li>
<p>It is inefficient, since the compiler will now always run all the lints checks for all dependencies of a crate but we only care about a small subset of the lints.</p>
</li>
<li>
<p>It is insufficient, because it only handles instances of <code>--cap-lints</code>; it would fail to catch instances where an upstream dependency is using an <code>#[allow(..)]</code> attribute in the source to sidestep warnings.</p>
<ul>
<li>
<p>If we addressed that insufficiency by unconditionally changing <code>rustc</code> to always emit feedback about future-incompatibilities regardless of <code>--cap-lints=allow</code> or <code>#[allow(..)]</code>, then that would probably upset people who expect those flags/annotations to keep the diagnostic output quiet.</p>
</li>
<li>
<p>(In other words, it would be an instance of “the compiler is not listening to me!”)</p>
</li>
<li>
<p>That is why this RFC proposes that <code>--cap-lints=allow</code> and <code>#[allow(..)]</code> should continue to silence the diagnostic report for lints listed by those flags and annotations, and restrict the feedback solely to a final warning of the form “the crate brash contains code that will be rejected by a future version of Rust.”</p>
</li>
</ul>
</li>
</ul>
<h4 id="can-we-do-this-in-rust-alone"><a class="header" href="#can-we-do-this-in-rust-alone">Can we do this in Rust alone?</a></h4>
<p>PR <a href="https://github.com/rust-lang/rust/issues/59658">rust-lang/rust#59658</a> “Minimum Lint Levels” implemented a solution in the compiler alone, by tagging the future-incompatibility lints as special cases that would not be silenced by <code>--cap-lints</code> nor <code>#[allow(..)]</code>. The discussion on that PR described a number of problems with this; in essence, people were concerned about getting spammed by lints that the downstream developer couldn’t actually do anything about.</p>
<p>The discussion on that PR concluded by saying that it could possibly be reworked to reduce the amount of spam by reporting a single instance of a lint for each dependency (rather than having a separate diagnostic for each <em>expression</em> that triggered the lint within that dependency).</p>
<ul>
<li>
<p>The latter would indeed be an improvement on <a href="https://github.com/rust-lang/rust/issues/59658">PR 59658</a>, but it still would not be an ideal user-experience. The change suggested by this RFC deliberately treats occurrences of future-incompatibility lints as separate from normal diagnostics: serious events worthy of being treated specially by Cargo, to the extent that it might e.g. do an online query to see if a newer version of the given crate exists. We want to make the process of fixing these issues as easy as we can for the developer, and doing that requires help from Cargo.</p>
</li>
<li>
<p>It is entirely possible that we will want to move forward with minimum-lint levels, independently of this RFC. The machinery proposed there is not in conflict with what I am proposing here; I am just saying that it would not be sufficient for resolving the problem at hand.</p>
</li>
</ul>
<h3 id="would-extending-cap-lints-be-preferable"><a class="header" href="#would-extending-cap-lints-be-preferable">Would extending cap-lints be preferable?</a></h3>
<p>One goal of the RFC as written was to try to minimize the impact on the Rust ecosystem. Thus it does not change the behavior of the default output error-format, and instead leverages <code>--error-format=json</code>. But this might be too subtle an approach.</p>
<p>One other way to still minimize impact would be to extend the <code>--cap-lints</code> hierarchy so that it looks like this:</p>
<pre><code>allow
warn-future-incompat
warn
deny-future-incompat
deny
</code></pre>
<p>Now, passing <code>--cap-lints=warn-future-incompat</code> would mean that we allow (with no warning) all non-future-incompat lints, and warn on future-incompat ones.</p>
<p>Likewise, <code>--cap-lints=deny-future-incompat</code> would mean that we warn on all non-future-incompat lints, and error on future-incompat ones.</p>
<p>Finally (and crucially), we would change the default for <code>cargo build</code> to be <code>cap-lints=warn-future-incompat</code>. Then by default, developers would be more directly informed about future incompatibilities in their dependencies.</p>
<p>I opted not to take this approach in the design proposed of this RFC because I suspect it would suffer from the same problems exhibited by <a href="https://github.com/rust-lang/rust/issues/59658">“minimum lint levels”</a>: it would present a bunch of diagnostics that developers cannot immediately resolve locally. (However, it may still be a reasonable feature to add to <code>rustc</code> and <code>cargo</code>!)</p>
<h2 id="prior-art"><a class="header" href="#prior-art">Prior art</a></h2>
<p>None I know of, but I’m happy to be educated.</p>
<p>(Has Python done anything here with the migration from Python 2 to Python 3? I briefly did some web searches but failed to find much of use.)</p>
<h2 id="unresolved-questions"><a class="header" href="#unresolved-questions">Unresolved questions</a></h2>
<p>There are future-incompatibility warnings emitted by cargo itself, such as discussed on <a href="https://github.com/rust-lang/cargo/issues/6313#issuecomment-505626509">rust-lang/cargo#6313 (comment)</a>. I imagine it shouldn’t require much effort to incorporate support for such lints, but I have not explicitly addressed nor seriously investigated this.</p>
<h3 id="implementation-questions"><a class="header" href="#implementation-questions">Implementation questions</a></h3>
<ul>
<li>
<p>Is using <code>--error-format=json</code> as the way to switch <code>rustc</code> into the future-incompatibility checking mode reasonable?</p>
<ul>
<li>An variant on the strategy: we could use the <code>--json CONFIG</code> option to <code>rustrc</code> as a way for <code>cargo</code> to opt into the feature. This way, clients already using <code>--error-format=json</code> would not need to know abot this change.</li>
</ul>
</li>
</ul>
<h2 id="future-possibilities"><a class="header" href="#future-possibilities">Future possibilities</a></h2>
<p>The main form of follow-up work I envisage for this RFC is what feedback that Cargo gives regarding the issues.</p>
<p>Cargo is responsible for suggesting to the user how they might address an instance of a future-incompatibility lint.</p>
<p>Some ideas for suggestions follow.</p>
<h3 id="query-for-neweralternate-versions-of-the-crate"><a class="header" href="#query-for-neweralternate-versions-of-the-crate">Query for newer/alternate versions of the crate</a></h3>
<p>When crates trigger future-incompatibility warnings, Cargo could look for newer versions of the dependency on crates.io.</p>
<p>Example:</p>
<pre><code>crates % cd unwary
unwary % cargo build
   Compiling brash v0.1.0
   Compiling bold v0.1.0
   Compiling rash v0.1.0
   Compiling unwary v0.1.0
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s

    warning: the crates brash, bold, and rash contain code that will be rejected by a future version of Rust.
    note: the crate rash will stop compiling in Rust 1.50 (scheduled for February 2021).
    note: newer versions of bold and rash are available; upgrading to them via `cargo update` may resolve their problems.
unwary %
</code></pre>
<p>This suggestion as written only covers upgrading to newer versions. But with more help from crates.io itself, we could go even further here: We could suggest potential <em>forks</em> of the upstream crate that one might switch to using. This could be useful in dealing with abandonware.</p>
<h3 id="suggest-a-bug-report"><a class="header" href="#suggest-a-bug-report">Suggest a bug report</a></h3>
<p>If no newer version of the triggering crate is available, Cargo could emit a template for a bug report the user could file with the upstream crate.</p>
<p>Example:</p>
<pre><code>crates % cd unwary
unwary % cargo build
   Compiling brash v0.1.0
   Compiling unwary v0.1.0
    Finished dev [unoptimized + debuginfo] target(s) in 0.30s

    warning: the crate brash contains code that will be rejected by a future version of Rust.
    note: the following gist contains a bug report you might consider filing with the maintainer of brash.
          https://gist.github.com/pnkfelix/ae03d3ea95160fb71a797b15e05f8d49
unwary %
</code></pre>
<p>In this example, the template is posted to a <code>gist</code> (The gist is using my own github account here; to be honest I am not sure whether we would be able to anonymously gist things from cargo in this manner, but we should be able to find <em>some</em> pastebin service to use for this purpose).</p>
<p>For ease of reference, here is the text located at the gist url above:</p>
<blockquote>
<p>This crate currently triggers a future incompatibility warning with Rust.</p>
<p>In src/lib.rs:13:9, there is the following code:</p>
<pre><code class="language-rust">let y = &amp;x.data.0;</code></pre>
<p>This causes <code>rustc</code> to issue the following diagnostic, from https://github.com/rust-lang/rust/issues/46043</p>
<pre><code>warning: borrow of packed field is unsafe and requires unsafe function or block (error E0133)
  --&gt; src/lib.rs:13:9
   |
13 | let y = &amp;x.data.0;
   |         ^^^^^^^^^
   |
   = note: `#[warn(safe_packed_borrows)]` on by default
   = warning: this was previously accepted by the compiler but is being phased out; it will become a hard error in a future release!
   = note: for more information, see issue #46043 &lt;https://github.com/rust-lang/rust/issues/46043&gt;
   = note: fields of packed structs might be misaligned: dereferencing a misaligned pointer or even just creating a misaligned reference is undefined behavior
</code></pre>
<p>Since this construct is going to become a hard error in the future, we should eliminate occurrences of it.</p>
</blockquote>
<p>Further refinement of this idea: If we did start suggesting bug report templates, then Cargo might also be able to <em>search</em> for issues with descriptions that match the template on that crate’s repostory, and advise the user to inspect that bug report to see its current status, rather than file a new bug with the upstream crate, which might be otherwise annoying for those maintainers.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="2832-core-net-types.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="2835-project-safe-transmute.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="2832-core-net-types.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="2835-project-safe-transmute.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
