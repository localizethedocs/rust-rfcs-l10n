msgid ""
msgstr ""
"Project-Id-Version: The Rust RFC Book\n"
"POT-Creation-Date: 2025-12-01T05:53:05Z\n"
"PO-Revision-Date: \n"
"Last-Translator: \n"
"Language-Team: \n"
"Language: zh_TW\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"

#: src/3185-static-async-fn-in-trait.md:1
msgid "Static async fn in traits"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:3
msgid "Feature Name: `async_fn_in_trait`"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:4
msgid "Start Date: 2021-10-13"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:5
msgid ""
"RFC PR: [rust-lang/rfcs#3185](https://github.com/rust-lang/rfcs/pull/3185)"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:6
msgid ""
"Rust Issue: [rust-lang/rust#91611](https://github.com/rust-lang/rust/"
"issues/91611)"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:8
msgid "Summary"
msgstr "摘要"

#: src/3185-static-async-fn-in-trait.md:11
msgid ""
"Support `async fn` in traits that can be called via static dispatch. These "
"will desugar to an anonymous associated type."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:13
msgid "Motivation"
msgstr "動機"

#: src/3185-static-async-fn-in-trait.md:16
msgid ""
"Async/await allows users to write asynchronous code much easier than they "
"could before. However, it doesn't play nice with other core language "
"features that make Rust the great language it is, like traits."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:18
msgid ""
"In this RFC we will begin the process of integrating these two features and "
"smoothing over a wrinkle that async Rust users have been working around "
"since async/await stabilized nearly 3 years ago."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:20
msgid "Guide-level explanation"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:23
msgid "You can write `async fn` in traits and trait impls. For example:"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:43
msgid "This is useful for writing generic async code."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:45
msgid ""
"Currently, if you use an `async fn` in a trait, that trait is not `dyn` "
"safe. If you need to use dynamic dispatch combined with async functions, you "
"can use the [`async-trait`](https://crates.io/crates/async-trait) crate. We "
"expect to extend the language to support this use case in the future."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:47
msgid ""
"Note that if a function in a trait is written as an `async fn`, it must also "
"be written as an `async fn` in your implementation of that trait. With the "
"above trait, you could not write this:"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:59
msgid ""
"Doing so will give you an \"expected async fn\" error. If you need to do "
"this for some reason, you can use an associated type in the trait:"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:79
msgid ""
"Note that in the impl we are setting the value of the associated type to "
"`impl Future`, because async blocks produce unnameable opaque types. The "
"associated type is also generic over a lifetime `'a`, which allows it to "
"capture the `&'a self` reference passed by the caller."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:81
msgid "Reference-level explanation"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:84
msgid "New syntax"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:86
msgid ""
"We introduce the `async fn` sugar into traits and impls. No changes to the "
"grammar are needed because the Rust grammar already support this "
"construction, but async functions result in compilation errors in later "
"phases of the compiler."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:98
msgid "Semantic rules"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:100
msgid "When an async function is present in a trait or trait impl..."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:102
msgid "The trait is not considered dyn safe"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:104
msgid "This limitation is expected to be lifted in future RFCs."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:106
msgid "Both the trait and its impls must use `async` syntax"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:108
msgid ""
"It is not legal to use an async function in a trait and a \"desugared\" "
"function in an impl."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:110
msgid "Equivalent desugaring"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:112
msgid "Trait"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:114
msgid ""
"Async functions in a trait desugar to an associated function that returns a "
"generic associated type (GAT):"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:116
msgid ""
"Just as with [ordinary async functions](https://rust-lang.github.io/"
"rfcs/2394-async_await.html#lifetime-capture-in-the-anonymous-future), the "
"GAT has a generic parameter for every generic parameter that appears on the "
"fn, along with implicit lifetime parameters."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:117
msgid ""
"The GAT has the complete set of where clauses that appear on the `fn`, "
"including any implied bounds."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:118
msgid ""
"The GAT is \"anonymous\", meaning that its name is an internal symbol that "
"cannot be referred to directly. (In the examples, we will use `$` to "
"represent this name.)"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:127
msgid "// Becomes:\n"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:133
#: src/3185-static-async-fn-in-trait.md:159
msgid "// Explicit where clauses\n"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:134
#: src/3185-static-async-fn-in-trait.md:160
msgid "// Implied bound from `&self` parameter\n"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:142
msgid ""
"`async fn` that appear in impls are desugared in the same general way as an "
"[existing async function](https://doc.rust-lang.org/reference/items/"
"functions.html#async-functions), but with some slight differences:"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:144
msgid ""
"The value of the associated type `$` is equal to an `impl Future` type, "
"rather than the `impl Future` being the return type of the function"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:145
msgid ""
"The function returns `Self::$<...>` with all the appropriate generic "
"parameters"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:147
msgid ""
"Otherwise, the desugaring is the same. The body of the function becomes an "
"`async move { ... }` block that both (a) captures all parameters and (b) "
"contains the body expression."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:168
msgid "Rationale and alternatives"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:171
msgid "Why are we adding this RFC now?"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:173
msgid ""
"This RFC represents the least controversial addition to async/await that we "
"could add right now. It was not added before due to limitations in the "
"compiler that have now been lifted – namely, support for [Generic Associated "
"Types](https://github.com/rust-lang/generic-associated-types-initiative) and "
"[Type Alias Impl Trait](https://github.com/rust-lang/rust/issues/63063)."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:178
msgid "Why are the result traits not dyn safe?"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:180
msgid ""
"Supporting async fn and dyn is a complex topic -- you can read the details "
"on the [dyn traits](https://rust-lang.github.io/async-fundamentals-"
"initiative/evaluation/challenges/dyn_traits.html) page of the async "
"fundamentals evaluation doc."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:182
msgid "Can we add support for dyn later?"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:184
msgid ""
"Yes, nothing in this RFC precludes us from making traits containing async "
"functions dyn safe, presuming that we can overcome the obstacles inherent in "
"the design space."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:186
msgid "What are users using today and why don't we just do that?"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:188
msgid ""
"Users in the ecosystem have worked around the lack of support for this "
"feature with the [async-trait](https://github.com/dtolnay/async-trait) proc "
"macro, which desugars into `Box<dyn Future>`s instead of anonymous "
"associated types. This has the disadvantage of requiring users to use "
"`Box<dyn>` along with all the [performance implications](https://rust-lang."
"github.io/wg-async-foundations/vision/submitted_stories/status_quo/"
"barbara_benchmarks_async_trait.html) of that, which prevent some use cases. "
"It is also not suitable for users like [embassy](https://github.com/embassy-"
"rs/embassy), which aim to support the \"no-std\" ecosystem."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:193
msgid "Will anyone use async-trait crate once this RFC lands?"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:195
msgid ""
"The async-trait crate will continue to be useful after this RFC, because it "
"allows traits to remain `dyn`\\-safe. This is a limitation in the current "
"design that we plan to address in the future."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:197
msgid "Prior art"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:200
msgid "The `async-trait` crate"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:202
msgid ""
"The most common way to use `async fn` in traits is to use the [`async-trait`]"
"(https://crates.io/crates/async-trait) crate. This crate takes a different "
"approach to the one described in this RFC. Async functions are converted "
"into ordinary trait functions that return `Box<dyn Future>` rather than "
"using an associated type. This means that the resulting traits are dyn safe "
"and avoids a dependency on generic associated types, but it also has two "
"downsides:"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:204
msgid ""
"Requires a box allocation on every trait function call; while this is often "
"no big deal, it can be prohibitive for some applications."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:205
msgid ""
"Requires the trait to state up front whether the resulting futures are "
"`Send` or not. The [`async-trait`](https://crates.io/crates/async-trait) "
"crate defaults to `Send` and users write `#[async_trait(?Send)]` to disable "
"this default."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:207
msgid ""
"Since the async function support in this RFC means that traits are not dyn "
"safe, we do not expect it to completely displace uses of the "
"`#[async_trait]` crate."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:211
msgid "The real-async-trait crate"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:213
msgid ""
"The [`real-async-trait`](https://crates.io/crates/real-async-trait) lowers "
"`async fn` to use GATs and impl Trait, roughly as described in this RFC."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:217
msgid "Unresolved questions"
msgstr "未解決的問題"

#: src/3185-static-async-fn-in-trait.md:220
msgid "None."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:222
msgid "Future possibilities"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:225
msgid "Dyn compatibility"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:227
msgid ""
"It is not a breaking change for traits to become dyn safe. We expect to make "
"traits with async functions dyn safe, but doing so requires overcoming a "
"number of interesting challenges, as described in the [async fundamentals "
"evaluation doc](https://rust-lang.github.io/async-fundamentals-initiative/"
"evaluation.html)."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:229
msgid "Impl trait in traits"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:231
msgid ""
"The [impl trait initiative](https://rust-lang.github.io/impl-trait-"
"initiative/) is expecting to propose \"impl trait in traits\" (see the "
"[explainer](https://rust-lang.github.io/impl-trait-initiative/explainer/"
"rpit_trait.html) for a brief summary). This RFC is compatible with the "
"proposed design."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:233
msgid "Allowing sugared and desugared forms"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:235
msgid ""
"In the current proposal, `async fn`s in traits must be implemented using "
"`async fn`. Using a desugared form is not allowed, which can preclude "
"implementations from doing things like doing some work at call time before "
"returning a future. It would also be backwards-incompatible for library "
"authors to move between the sugared and desugared form."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:237
msgid ""
"Once impl trait in traits is supported, we can redefine the desugaring of "
"`async fn` in traits in terms of that feature (similar to how `async fn` is "
"desugared for free functions). That provides a clear path to allowing the "
"desugared form to be used interchangeably with the `async fn` form. In other "
"words, you should be able to write the following:"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:249
msgid ""
"It could also be made backward-compatible for the trait to change between "
"the sugared and desugared form."
msgstr ""

#: src/3185-static-async-fn-in-trait.md:251
msgid "Ability to name the type of the returned future"
msgstr ""

#: src/3185-static-async-fn-in-trait.md:253
msgid ""
"This RFC does not propose any means to name the future that results from an "
"`async fn`. That is expected to be covered in a future RFC from the [impl "
"trait initiative](https://rust-lang.github.io/impl-trait-initiative/); you "
"can read more about the [proposed design](https://rust-lang.github.io/impl-"
"trait-initiative/explainer/rpit_names.html) in the explainer."
msgstr ""
