msgid ""
msgstr ""
"Project-Id-Version: The Rust RFC Book\n"
"POT-Creation-Date: 2025-12-01T05:53:02Z\n"
"PO-Revision-Date: \n"
"Last-Translator: \n"
"Language-Team: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Language: en\n"
"Plural-Forms: nplurals=1; plural=0;\n"

#: src/0526-fmt-text-writer.md:1
msgid "Start Date: 2014-12-30"
msgstr ""

#: src/0526-fmt-text-writer.md:2
msgid ""
"RFC PR: [rust-lang/rfcs#526](https://github.com/rust-lang/rfcs/pull/526)"
msgstr ""

#: src/0526-fmt-text-writer.md:3
msgid ""
"Rust Issue: [rust-lang/rust#20352](https://github.com/rust-lang/rust/"
"issues/20352)"
msgstr ""

#: src/0526-fmt-text-writer.md:5
msgid "Summary"
msgstr ""

#: src/0526-fmt-text-writer.md:7
msgid ""
"Statically enforce that the `std::fmt` module can only create valid UTF-8 "
"data by removing the arbitrary `write` method in favor of a `write_str` "
"method."
msgstr ""

#: src/0526-fmt-text-writer.md:10
msgid "Motivation"
msgstr ""

#: src/0526-fmt-text-writer.md:12
msgid ""
"Today it is conventionally true that the output from macros like `format!` "
"and well as implementations of `Show` only create valid UTF-8 data. This is "
"not statically enforced, however. As a consequence the `.to_string()` method "
"must perform a `str::is_utf8` check before returning a `String`."
msgstr ""

#: src/0526-fmt-text-writer.md:17
msgid ""
"This `str::is_utf8` check is currently [one of the most costly parts]"
"(https://gist.github.com/alexcrichton/162a5f8f93062800c914) of the "
"formatting subsystem while normally just being a redundant check."
msgstr ""

#: src/0526-fmt-text-writer.md:22
msgid ""
"Additionally, it is possible to statically enforce the convention that "
"`Show` only deals with valid unicode, and as such the possibility of doing "
"so should be explored."
msgstr ""

#: src/0526-fmt-text-writer.md:26
msgid "Detailed design"
msgstr ""

#: src/0526-fmt-text-writer.md:28
msgid "The `std::fmt::FormatWriter` trait will be redefined as:"
msgstr ""

#: src/0526-fmt-text-writer.md:34
msgid "// default method calling write_str\n"
msgstr ""

#: src/0526-fmt-text-writer.md:37
msgid "// default method calling fmt::write\n"
msgstr ""

#: src/0526-fmt-text-writer.md:42
msgid "There are a few major differences with today's trait:"
msgstr ""

#: src/0526-fmt-text-writer.md:44
msgid ""
"The name has changed to `Writer` in accordance with [RFC 356](https://github."
"com/rust-lang/rfcs/blob/master/text/0356-no-module-prefixes.md)"
msgstr ""

#: src/0526-fmt-text-writer.md:45
msgid ""
"The `write` method has moved from taking `&[u8]` to taking `&str` instead."
msgstr ""

#: src/0526-fmt-text-writer.md:46
msgid "A `write_char` method has been added."
msgstr ""

#: src/0526-fmt-text-writer.md:50
msgid ""
"The corresponding methods on the `Formatter` structure will also be altered "
"to respect these signatures."
msgstr ""

#: src/0526-fmt-text-writer.md:53
msgid ""
"The key idea behind this API is that the `Writer` trait only operates on "
"unicode data. The `write_str` method is a static enforcement of UTF-8-ness, "
"and using `write_char` follows suit as a `char` can only be a valid unicode "
"codepoint."
msgstr ""

#: src/0526-fmt-text-writer.md:57
msgid ""
"With this trait definition, the implementation of `Writer` for `Vec<u8>` "
"will be removed (note this is _not_ the `io::Writer` implementation) in "
"favor of an implementation directly on `String`. The `.to_string()` method "
"will change accordingly (as well as `format!`) to write directly into a "
"`String`, bypassing all UTF-8 validity checks afterwards."
msgstr ""

#: src/0526-fmt-text-writer.md:63
msgid ""
"This change [has been implemented](https://github.com/alexcrichton/rust/tree/"
"fmt-text) in a branch of mine, and as expected the [benchmark numbers have "
"improved](https://gist.github.com/alexcrichton/182ccef5d8c2583a2423) for the "
"much larger texts."
msgstr ""

#: src/0526-fmt-text-writer.md:69
msgid ""
"Note that a key point of the changes implemented is that a call to `write!` "
"into an arbitrary `io::Writer` is _still valid_ as it's still just a sink "
"for bytes. The changes outlined in this RFC will only affect `Show` and "
"other formatting trait implementations. As can be seen from the sample "
"implementation, the fallout is quite minimal with respect to the rest of the "
"standard library."
msgstr ""

#: src/0526-fmt-text-writer.md:75
msgid "Drawbacks"
msgstr ""

#: src/0526-fmt-text-writer.md:77
msgid ""
"A version of this RFC has been [previously postponed](https://github.com/"
"rust-lang/rfcs/pull/57), but this variant is much less ambitious in terms of "
"generic `TextWriter` support. At this time the design of `fmt::Writer` is "
"purposely conservative."
msgstr ""

#: src/0526-fmt-text-writer.md:83
msgid ""
"There are currently some use cases today where a `&mut Formatter` is "
"interpreted as a `&mut Writer`, e.g. for the `Show` impl of `Json`. This is "
"undoubtedly used outside this repository, and it would break all of these "
"users relying on the binary functionality of the old `FormatWriter`."
msgstr ""

#: src/0526-fmt-text-writer.md:88
msgid "Alternatives"
msgstr ""

#: src/0526-fmt-text-writer.md:90
msgid ""
"Another possible solution to specifically the performance problem is to have "
"an `unsafe` flag on a `Formatter` indicating that only valid utf-8 data was "
"written, and if all sub-parts of formatting set this flag then the data can "
"be assumed utf-8. In general relying on `unsafe` apis is less \"pure\" than "
"relying on the type system instead."
msgstr ""

#: src/0526-fmt-text-writer.md:96
msgid ""
"The `fmt::Writer` trait can also be located as `io::TextWriter` instead to "
"emphasize its possible future connection with I/O, although there are not "
"concrete plans today to develop these connections."
msgstr ""

#: src/0526-fmt-text-writer.md:100
msgid "Unresolved questions"
msgstr ""

#: src/0526-fmt-text-writer.md:102
msgid ""
"It is unclear to what degree a `fmt::Writer` needs to interact with `io::"
"Writer` and the various adaptors/buffers. For example one would have to "
"implement their own `BufferedWriter` for a `fmt::Writer`."
msgstr ""
