msgid ""
msgstr ""
"Project-Id-Version: The Rust RFC Book\n"
"POT-Creation-Date: 2025-12-01T05:53:03Z\n"
"PO-Revision-Date: \n"
"Last-Translator: \n"
"Language-Team: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Language: en\n"
"Plural-Forms: nplurals=1; plural=0;\n"

#: src/1359-process-ext-unix.md:1
msgid "Feature Name: `process_exec`"
msgstr ""

#: src/1359-process-ext-unix.md:2
msgid "Start Date: 2015-11-09"
msgstr ""

#: src/1359-process-ext-unix.md:3
msgid ""
"RFC PR: [rust-lang/rfcs#1359](https://github.com/rust-lang/rfcs/pull/1359)"
msgstr ""

#: src/1359-process-ext-unix.md:4
msgid ""
"Rust Issue: [rust-lang/rust#31398](https://github.com/rust-lang/rust/"
"issues/31398)"
msgstr ""

#: src/1359-process-ext-unix.md:6
msgid "Summary"
msgstr ""

#: src/1359-process-ext-unix.md:9
msgid ""
"Add two methods to the `std::os::unix::process::CommandExt` trait to provide "
"more control over how processes are spawned on Unix, specifically:"
msgstr ""

#: src/1359-process-ext-unix.md:18
msgid "Motivation"
msgstr ""

#: src/1359-process-ext-unix.md:21
msgid ""
"Although the standard library's implementation of spawning processes on Unix "
"is relatively complex, it unfortunately doesn't provide the same flexibility "
"as calling `fork` and `exec` manually. For example, these sorts of use cases "
"are not possible with the `Command` API:"
msgstr ""

#: src/1359-process-ext-unix.md:26
msgid ""
"The `exec` function cannot be called without `fork`. It's often useful on "
"Unix in doing this to avoid spawning processes or improve debuggability if "
"the pre-`exec` code was some form of shim."
msgstr ""

#: src/1359-process-ext-unix.md:29
msgid ""
"Execute other flavorful functions between the fork/exec if necessary. For "
"example some proposed extensions to the standard library are [dealing with "
"the controlling tty](https://github.com/rust-lang/rust/pull/28982) or "
"dealing with [session leaders](https://github.com/rust-lang/rust/"
"pull/26470). In theory any sort of arbitrary code can be run between these "
"two syscalls, and it may not always be the case the standard library can "
"provide a suitable abstraction."
msgstr ""

#: src/1359-process-ext-unix.md:39
msgid ""
"Note that neither of these pieces of functionality are possible on Windows "
"as there is no equivalent of the `fork` or `exec` syscalls in the standard "
"APIs, so these are specifically proposed as methods on the Unix extension "
"trait."
msgstr ""

#: src/1359-process-ext-unix.md:43
msgid "Detailed design"
msgstr ""

#: src/1359-process-ext-unix.md:46
msgid ""
"The following two methods will be added to the `std::os::unix::process::"
"CommandExt` trait:"
msgstr ""

#: src/1359-process-ext-unix.md:50
msgid ""
"/// Performs all the required setup by this `Command`, followed by calling "
"the\n"
"/// `execvp` syscall.\n"
"///\n"
"/// On success this function will not return, and otherwise it will return "
"an\n"
"/// error indicating why the exec (or another part of the setup of the\n"
"/// `Command`) failed.\n"
"///\n"
"/// Note that the process may be in a \"broken state\" if this function "
"returns in\n"
"/// error. For example the working directory, environment variables, signal\n"
"/// handling settings, various user/group information, or aspects of stdio\n"
"/// file descriptors may have changed. If a \"transactional spawn\" is "
"required to\n"
"/// gracefully handle errors it is recommended to use the cross-platform "
"`spawn`\n"
"/// instead.\n"
msgstr ""

#: src/1359-process-ext-unix.md:64
msgid ""
"/// Schedules a closure to be run just before the `exec` function is "
"invoked.\n"
"///\n"
"/// This closure will be run in the context of the child process after the\n"
"/// `fork` and other aspects such as the stdio file descriptors and working\n"
"/// directory have successfully been changed. Note that this is often a "
"very\n"
"/// constrained environment where normal operations like `malloc` or "
"acquiring a\n"
"/// mutex are not guaranteed to work (due to other threads perhaps still "
"running\n"
"/// when the `fork` was run).\n"
"///\n"
"/// The closure is allowed to return an I/O error whose OS error code will "
"be\n"
"/// communicated back to the parent and returned as an error from when the "
"spawn\n"
"/// was requested.\n"
"///\n"
"/// Multiple closures can be registered and they will be called in order of\n"
"/// their registration. If a closure returns `Err` then no further closures "
"will\n"
"/// be called and the spawn operation will immediately return with a "
"failure.\n"
msgstr ""

#: src/1359-process-ext-unix.md:85
msgid ""
"The `exec` function is relatively straightforward as basically the entire "
"spawn operation minus the `fork`. The stdio handles will be inherited by "
"default if not otherwise configured. Note that a configuration of `piped` "
"will likely just end up with a broken half of a pipe on one of the file "
"descriptors."
msgstr ""

#: src/1359-process-ext-unix.md:90
msgid ""
"The `before_exec` function has extra-restrictive bounds to preserve the same "
"qualities that the `Command` type has (notably `Send`, `Sync`, and "
"`'static`). This also happens after all other configuration has happened to "
"ensure that libraries can take advantage of the other operations on "
"`Command` without having to reimplement them manually in some circumstances."
msgstr ""

#: src/1359-process-ext-unix.md:96
msgid "Drawbacks"
msgstr ""

#: src/1359-process-ext-unix.md:99
msgid ""
"This change is possible to be a breaking change to `Command` as it will no "
"longer implement all marker traits by default (due to it containing closure "
"trait objects). While the common marker traits are handled here, it's "
"possible that there are some traits in the wild in use which this could "
"break."
msgstr ""

#: src/1359-process-ext-unix.md:104
msgid ""
"Much of the functionality which may initially get funneled through "
"`before_exec` may actually be best implemented as functions in the standard "
"library itself. It's likely that many operations are well known across "
"unixes and aren't niche enough to stay outside the standard library."
msgstr ""

#: src/1359-process-ext-unix.md:109
msgid "Alternatives"
msgstr ""

#: src/1359-process-ext-unix.md:112
msgid ""
"Instead of souping up `Command` the type could instead provide accessors to "
"all of the configuration that it contains. This would enable this sort of "
"functionality to be built on crates.io first instead of requiring it to be "
"built into the standard library to start out with. Note that this may want "
"to end up in the standard library regardless, however."
msgstr ""

#: src/1359-process-ext-unix.md:118
msgid "Unresolved questions"
msgstr ""

#: src/1359-process-ext-unix.md:121
msgid ""
"Is it appropriate to run callbacks just before the `exec`? Should they "
"instead be run before any standard configuration like stdio has run?"
msgstr ""

#: src/1359-process-ext-unix.md:123
msgid ""
"Is it possible to provide \"transactional semantics\" to the `exec` function "
"such that it is safe to recover from? Perhaps it's worthwhile to provide "
"partial transactional semantics in the form of \"this can be recovered from "
"so long as all stdio is inherited\"."
msgstr ""
